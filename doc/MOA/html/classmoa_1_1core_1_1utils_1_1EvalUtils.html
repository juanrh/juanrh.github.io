<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>MOA: moa.core.utils.EvalUtils Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
      <li><a href="classes.html"><span>Class&nbsp;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="namespacemoa.html">moa</a>.<a class="el" href="namespacemoa_1_1core.html">core</a>.<a class="el" href="namespacemoa_1_1core_1_1utils.html">utils</a>.<a class="el" href="classmoa_1_1core_1_1utils_1_1EvalUtils.html">EvalUtils</a>
  </div>
</div>
<div class="contents">
<h1>moa.core.utils.EvalUtils Class Reference</h1><!-- doxytag: class="moa::core::utils::EvalUtils" -->
<p>Evaluation Utilities.  
<a href="#_details">More...</a></p>

<p><a href="classmoa_1_1core_1_1utils_1_1EvalUtils-members.html">List of all members.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Static Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static final int[]&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmoa_1_1core_1_1utils_1_1EvalUtils.html#a53642037b62c7504a4a3690630f3fa43">toIntArray</a> (Instance x, int L)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Convert Instance to bit array.  <a href="#a53642037b62c7504a4a3690630f3fa43"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmoa_1_1core_1_1utils_1_1EvalUtils.html#acb79a34f45c8f9c26c8b248c41c3311a">calibrateThreshold</a> (ArrayList&lt; double[]&gt; Y, double LC_train)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Calibrate a threshold.  <a href="#acb79a34f45c8f9c26c8b248c41c3311a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static double[]&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmoa_1_1core_1_1utils_1_1EvalUtils.html#aa85987a4e511943f75623f84301e12d6">calibrateThresholds</a> (ArrayList&lt; double[]&gt; Y, double LC_train[])</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Calibrate thresholds.  <a href="#aa85987a4e511943f75623f84301e12d6"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static HashMap&lt; String, Double &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmoa_1_1core_1_1utils_1_1EvalUtils.html#a592435db214404cd3bf0add80a330704">evaluateMultiLabel</a> (ArrayList&lt; double[]&gt; Distributions, ArrayList&lt; int[]&gt; TrueRelevances, double t)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Calculate Performance Measures.  <a href="#a592435db214404cd3bf0add80a330704"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmoa_1_1core_1_1utils_1_1EvalUtils.html#a182ee3db6f8ad7d312070ec0ff039f72">calcLogLoss</a> (double R, double P, double C)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Calculate Log Loss.  <a href="#a182ee3db6f8ad7d312070ec0ff039f72"></a><br/></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Evaluation Utilities. </p>
<dl class="author"><dt><b>Author:</b></dt><dd>Jesse Read (<a href="mailto:jesse@tsc.uc3m.es">jesse@tsc.uc3m.es</a>) </dd></dl>
<dl class="version"><dt><b>Version:</b></dt><dd></dd></dl>
<dl class="rcs"><dt><b>Revision</b></dt><dd>1 </dd></dl>

<p>Definition at line <a class="el" href="EvalUtils_8java_source.html#l00034">34</a> of file <a class="el" href="EvalUtils_8java_source.html">EvalUtils.java</a>.</p>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a182ee3db6f8ad7d312070ec0ff039f72"></a><!-- doxytag: member="moa::core::utils::EvalUtils::calcLogLoss" ref="a182ee3db6f8ad7d312070ec0ff039f72" args="(double R, double P, double C)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static double moa.core.utils.EvalUtils.calcLogLoss </td>
          <td>(</td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>R</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>P</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>C</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Calculate Log Loss. </p>
<p>See Jesse Read. <em>Scalable Multi-label Classification</em>. PhD thesis, University of Waikato, 2010. </p>

<p>Definition at line <a class="el" href="EvalUtils_8java_source.html#l00253">253</a> of file <a class="el" href="EvalUtils_8java_source.html">EvalUtils.java</a>.</p>

<p>Referenced by <a class="el" href="EvalUtils_8java_source.html#l00090">moa.core.utils.EvalUtils.evaluateMultiLabel()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00253"></a>00253                                                                    {
<a name="l00254"></a>00254         <span class="keywordtype">double</span> ans = Math.min(Utils.eq(R, P) ? 0.0 : -((R * Math.log(P)) + ((1.0 - R) * Math.log(1.0 - P))), C);
<a name="l00255"></a>00255         <span class="keywordflow">return</span> (Double.isNaN(ans) ? 0.0 : ans);
<a name="l00256"></a>00256     }
</pre></div></p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="classmoa_1_1core_1_1utils_1_1EvalUtils_a182ee3db6f8ad7d312070ec0ff039f72_icgraph.png" border="0" usemap="#classmoa_1_1core_1_1utils_1_1EvalUtils_a182ee3db6f8ad7d312070ec0ff039f72_icgraph_map" alt=""></div>
<map name="classmoa_1_1core_1_1utils_1_1EvalUtils_a182ee3db6f8ad7d312070ec0ff039f72_icgraph_map" id="classmoa_1_1core_1_1utils_1_1EvalUtils_a182ee3db6f8ad7d312070ec0ff039f72_icgraph">
<area shape="rect" id="node3" href="classmoa_1_1core_1_1utils_1_1EvalUtils.html#a592435db214404cd3bf0add80a330704" title="Calculate Performance Measures." alt="" coords="295,5,567,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="acb79a34f45c8f9c26c8b248c41c3311a"></a><!-- doxytag: member="moa::core::utils::EvalUtils::calibrateThreshold" ref="acb79a34f45c8f9c26c8b248c41c3311a" args="(ArrayList&lt; double[]&gt; Y, double LC_train)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static double moa.core.utils.EvalUtils.calibrateThreshold </td>
          <td>(</td>
          <td class="paramtype">ArrayList&lt; double[]&gt;&nbsp;</td>
          <td class="paramname"> <em>Y</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>LC_train</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Calibrate a threshold. </p>
<p>Based upon a supplied label cardinality from the training set. </p>

<p>Definition at line <a class="el" href="EvalUtils_8java_source.html#l00052">52</a> of file <a class="el" href="EvalUtils_8java_source.html">EvalUtils.java</a>.</p>

<p>Referenced by <a class="el" href="EvalUtils_8java_source.html#l00070">moa.core.utils.EvalUtils.calibrateThresholds()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00052"></a>00052                                                                                     {
<a name="l00053"></a>00053         <span class="keywordtype">int</span> N = Y.size();
<a name="l00054"></a>00054         ArrayList&lt;Double&gt; big = <span class="keyword">new</span> ArrayList&lt;Double&gt;();
<a name="l00055"></a>00055         <span class="keywordflow">for</span> (<span class="keywordtype">double</span> y[] : Y) {
<a name="l00056"></a>00056             <span class="keywordflow">for</span> (<span class="keywordtype">double</span> y_ : y) {
<a name="l00057"></a>00057                 big.add(y_);
<a name="l00058"></a>00058             }
<a name="l00059"></a>00059         }
<a name="l00060"></a>00060         Collections.sort(big);
<a name="l00061"></a>00061         <span class="keywordtype">int</span> i = big.size() - (int) Math.round(LC_train * (<span class="keywordtype">double</span>) N);
<a name="l00062"></a>00062         <span class="keywordflow">return</span> Math.max(((<span class="keywordtype">double</span>) (big.get(i) + big.get(Math.max(i + 1, N - 1)))) / 2.0, 0.00001);
<a name="l00063"></a>00063     }
</pre></div></p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="classmoa_1_1core_1_1utils_1_1EvalUtils_acb79a34f45c8f9c26c8b248c41c3311a_icgraph.png" border="0" usemap="#classmoa_1_1core_1_1utils_1_1EvalUtils_acb79a34f45c8f9c26c8b248c41c3311a_icgraph_map" alt=""></div>
<map name="classmoa_1_1core_1_1utils_1_1EvalUtils_acb79a34f45c8f9c26c8b248c41c3311a_icgraph_map" id="classmoa_1_1core_1_1utils_1_1EvalUtils_acb79a34f45c8f9c26c8b248c41c3311a_icgraph">
<area shape="rect" id="node3" href="classmoa_1_1core_1_1utils_1_1EvalUtils.html#aa85987a4e511943f75623f84301e12d6" title="Calibrate thresholds." alt="" coords="327,5,604,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aa85987a4e511943f75623f84301e12d6"></a><!-- doxytag: member="moa::core::utils::EvalUtils::calibrateThresholds" ref="aa85987a4e511943f75623f84301e12d6" args="(ArrayList&lt; double[]&gt; Y, double LC_train[])" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static double [] moa.core.utils.EvalUtils.calibrateThresholds </td>
          <td>(</td>
          <td class="paramtype">ArrayList&lt; double[]&gt;&nbsp;</td>
          <td class="paramname"> <em>Y</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>LC_train</em>[]</td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Calibrate thresholds. </p>
<p>One threshold for each label, based on training-set label cardinality. Assumes that each double[] in Y is of length LC_train.length; </p>

<p>Definition at line <a class="el" href="EvalUtils_8java_source.html#l00070">70</a> of file <a class="el" href="EvalUtils_8java_source.html">EvalUtils.java</a>.</p>

<p>References <a class="el" href="EvalUtils_8java_source.html#l00052">moa.core.utils.EvalUtils.calibrateThreshold()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00070"></a>00070                                                                                          {
<a name="l00071"></a>00071         <span class="keywordtype">int</span> L = LC_train.length;
<a name="l00072"></a>00072         <span class="keywordtype">double</span> t[] = <span class="keyword">new</span> <span class="keywordtype">double</span>[L];
<a name="l00073"></a>00073         ArrayList&lt;double[]&gt; Y_[] = <span class="keyword">new</span> ArrayList[Y.size()];
<a name="l00074"></a>00074         <span class="keywordflow">for</span> (<span class="keywordtype">double</span> y[] : Y) {
<a name="l00075"></a>00075             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; y.length; j++) {
<a name="l00076"></a>00076                 Y_[j].add(y);
<a name="l00077"></a>00077             }
<a name="l00078"></a>00078         }
<a name="l00079"></a>00079         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; L; j++) {
<a name="l00080"></a>00080             t[j] = <a class="code" href="classmoa_1_1core_1_1utils_1_1EvalUtils.html#acb79a34f45c8f9c26c8b248c41c3311a" title="Calibrate a threshold.">calibrateThreshold</a>(Y_[j], LC_train[j]);
<a name="l00081"></a>00081         }
<a name="l00082"></a>00082         <span class="keywordflow">return</span> t;
<a name="l00083"></a>00083     }
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="classmoa_1_1core_1_1utils_1_1EvalUtils_aa85987a4e511943f75623f84301e12d6_cgraph.png" border="0" usemap="#classmoa_1_1core_1_1utils_1_1EvalUtils_aa85987a4e511943f75623f84301e12d6_cgraph_map" alt=""></div>
<map name="classmoa_1_1core_1_1utils_1_1EvalUtils_aa85987a4e511943f75623f84301e12d6_cgraph_map" id="classmoa_1_1core_1_1utils_1_1EvalUtils_aa85987a4e511943f75623f84301e12d6_cgraph">
<area shape="rect" id="node3" href="classmoa_1_1core_1_1utils_1_1EvalUtils.html#acb79a34f45c8f9c26c8b248c41c3311a" title="Calibrate a threshold." alt="" coords="335,5,604,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a592435db214404cd3bf0add80a330704"></a><!-- doxytag: member="moa::core::utils::EvalUtils::evaluateMultiLabel" ref="a592435db214404cd3bf0add80a330704" args="(ArrayList&lt; double[]&gt; Distributions, ArrayList&lt; int[]&gt; TrueRelevances, double t)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static HashMap&lt;String, Double&gt; moa.core.utils.EvalUtils.evaluateMultiLabel </td>
          <td>(</td>
          <td class="paramtype">ArrayList&lt; double[]&gt;&nbsp;</td>
          <td class="paramname"> <em>Distributions</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ArrayList&lt; int[]&gt;&nbsp;</td>
          <td class="paramname"> <em>TrueRelevances</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>t</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Calculate Performance Measures. </p>
<p>Given a threshold t on a batch of predicted Distributions and their corresponding TrueRelevances. (Rankings.size() must equal Actuals.size()). </p>

<p>Definition at line <a class="el" href="EvalUtils_8java_source.html#l00090">90</a> of file <a class="el" href="EvalUtils_8java_source.html">EvalUtils.java</a>.</p>

<p>References <a class="el" href="EvalUtils_8java_source.html#l00253">moa.core.utils.EvalUtils.calcLogLoss()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00090"></a>00090                                                                                                                                            {
<a name="l00091"></a>00091 
<a name="l00092"></a>00092         <span class="keywordtype">double</span> N = Distributions.size();
<a name="l00093"></a>00093         <span class="keywordtype">int</span> L = Distributions.iterator().next().length;
<a name="l00094"></a>00094         <span class="keywordtype">int</span> fp = 0, tp = 0, tn = 0, fn = 0;
<a name="l00095"></a>00095         <span class="keywordtype">int</span> p_sum_total = 0, r_sum_total = 0;
<a name="l00096"></a>00096         <span class="keywordtype">double</span> log_loss_D = 0.0, log_loss_L = 0.0;
<a name="l00097"></a>00097         <span class="keywordtype">int</span> set_empty_total = 0, set_inter_total = 0;
<a name="l00098"></a>00098         <span class="keywordtype">int</span> exact_match = 0, one_error = 0, coverage = 0;
<a name="l00099"></a>00099         <span class="keywordtype">double</span> accuracy = 0.0, f1_macro_D = 0.0, f1_macro_L = 0.0;
<a name="l00100"></a>00100         <span class="keywordtype">int</span> hloss_total = 0;
<a name="l00101"></a>00101         <span class="keywordtype">int</span>[] o_tp = <span class="keyword">new</span> <span class="keywordtype">int</span>[L], o_fp = <span class="keyword">new</span> <span class="keywordtype">int</span>[L], o_fn = <span class="keyword">new</span> <span class="keywordtype">int</span>[L], o_tn = <span class="keyword">new</span> <span class="keywordtype">int</span>[L];
<a name="l00102"></a>00102         <span class="keywordtype">int</span>[] d_tp = <span class="keyword">new</span> <span class="keywordtype">int</span>[(int) N], d_fp = <span class="keyword">new</span> <span class="keywordtype">int</span>[(<span class="keywordtype">int</span>) N], d_fn = new <span class="keywordtype">int</span>[(<span class="keywordtype">int</span>) N], d_tn = new <span class="keywordtype">int</span>[(<span class="keywordtype">int</span>) N];
<a name="l00103"></a>00103         <span class="comment">//double average_accuracy_online = 0.0;</span>
<a name="l00104"></a>00104 
<a name="l00105"></a>00105 
<a name="l00106"></a>00106         for (<span class="keywordtype">int</span> i = 0; i &lt; N; i++) {
<a name="l00107"></a>00107             <span class="keywordtype">double</span> ranking[] = Distributions.get(i);
<a name="l00108"></a>00108             <span class="keywordtype">int</span> actual[] = TrueRelevances.get(i);
<a name="l00109"></a>00109 
<a name="l00110"></a>00110             <span class="keywordtype">int</span> pred[] = <span class="keyword">new</span> <span class="keywordtype">int</span>[actual.length];
<a name="l00111"></a>00111             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; L; j++) {
<a name="l00112"></a>00112                 pred[j] = (ranking[j] &gt;= t) ? 1 : 0;
<a name="l00113"></a>00113             }
<a name="l00114"></a>00114 
<a name="l00115"></a>00115             <span class="comment">// calculate</span>
<a name="l00116"></a>00116             <span class="keywordtype">int</span> p_sum = 0, r_sum = 0;
<a name="l00117"></a>00117             <span class="keywordtype">int</span> set_union = 0;
<a name="l00118"></a>00118             <span class="keywordtype">int</span> set_inter = 0;
<a name="l00119"></a>00119             <span class="keywordtype">int</span> doc_inter = 0;
<a name="l00120"></a>00120             <span class="keywordtype">int</span> doc_union = 0;
<a name="l00121"></a>00121             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; L; j++) {
<a name="l00122"></a>00122                 <span class="keywordtype">int</span> p = pred[j];
<a name="l00123"></a>00123                 <span class="keywordtype">int</span> R = actual[j];
<a name="l00124"></a>00124                 <span class="keywordflow">if</span> (p == 1) {
<a name="l00125"></a>00125                     p_sum++;
<a name="l00126"></a>00126                     <span class="comment">// predt 1, real 1</span>
<a name="l00127"></a>00127                     <span class="keywordflow">if</span> (R == 1) {
<a name="l00128"></a>00128                         r_sum++;
<a name="l00129"></a>00129                         tp++;
<a name="l00130"></a>00130                         o_tp[j]++;          <span class="comment">// f1 macro (L)</span>
<a name="l00131"></a>00131                         d_tp[i]++;          <span class="comment">// f1 macro (D)</span>
<a name="l00132"></a>00132                         set_inter++;
<a name="l00133"></a>00133                         set_union++;
<a name="l00134"></a>00134                     } <span class="comment">// predt 1, real 0</span>
<a name="l00135"></a>00135                     <span class="keywordflow">else</span> {
<a name="l00136"></a>00136                         fp++;
<a name="l00137"></a>00137                         o_fp[j]++;          <span class="comment">// f1 macro (L)</span>
<a name="l00138"></a>00138                         d_fp[i]++;          <span class="comment">// f1 macro (D)</span>
<a name="l00139"></a>00139                         hloss_total++;
<a name="l00140"></a>00140                         set_union++;
<a name="l00141"></a>00141                     }
<a name="l00142"></a>00142                 } <span class="keywordflow">else</span> {
<a name="l00143"></a>00143                     <span class="comment">// predt 0, real 1</span>
<a name="l00144"></a>00144                     <span class="keywordflow">if</span> (R == 1) {
<a name="l00145"></a>00145                         r_sum++;
<a name="l00146"></a>00146                         fn++;
<a name="l00147"></a>00147                         o_fn[j]++;          <span class="comment">// f1 macro (L)</span>
<a name="l00148"></a>00148                         d_fn[i]++;          <span class="comment">// f1 macro (D)</span>
<a name="l00149"></a>00149                         hloss_total++;
<a name="l00150"></a>00150                         set_union++;
<a name="l00151"></a>00151                     } <span class="comment">// predt 0, real 0</span>
<a name="l00152"></a>00152                     <span class="keywordflow">else</span> {
<a name="l00153"></a>00153                         tn++;
<a name="l00154"></a>00154                         o_tn[j]++;          <span class="comment">// f1 macro (L)</span>
<a name="l00155"></a>00155                         d_tn[i]++;          <span class="comment">// f1 macro (D)</span>
<a name="l00156"></a>00156                     }
<a name="l00157"></a>00157                 }
<a name="l00158"></a>00158 
<a name="l00159"></a>00159                 <span class="comment">// log losses: </span>
<a name="l00160"></a>00160                 log_loss_D += <a class="code" href="classmoa_1_1core_1_1utils_1_1EvalUtils.html#a182ee3db6f8ad7d312070ec0ff039f72" title="Calculate Log Loss.">calcLogLoss</a>((<span class="keywordtype">double</span>) R, ranking[j], Math.log(N));
<a name="l00161"></a>00161                 log_loss_L += <a class="code" href="classmoa_1_1core_1_1utils_1_1EvalUtils.html#a182ee3db6f8ad7d312070ec0ff039f72" title="Calculate Log Loss.">calcLogLoss</a>((<span class="keywordtype">double</span>) R, ranking[j], Math.log(L));
<a name="l00162"></a>00162             }
<a name="l00163"></a>00163 
<a name="l00164"></a>00164             set_inter_total += set_inter;
<a name="l00165"></a>00165 
<a name="l00166"></a>00166             p_sum_total += p_sum;
<a name="l00167"></a>00167             r_sum_total += r_sum;
<a name="l00168"></a>00168 
<a name="l00169"></a>00169             <span class="keywordflow">if</span> (set_union &gt; 0) <span class="comment">//avoid NaN</span>
<a name="l00170"></a>00170             {
<a name="l00171"></a>00171                 accuracy += ((double) set_inter / (<span class="keywordtype">double</span>) set_union);
<a name="l00172"></a>00172             }
<a name="l00173"></a>00173             <span class="comment">//System.out.println(&quot;&quot;+set_inter+&quot;,&quot;+set_union);</span>
<a name="l00174"></a>00174 
<a name="l00175"></a>00175             <span class="keywordflow">if</span> (p_sum &lt;= 0) <span class="comment">//empty set</span>
<a name="l00176"></a>00176             {
<a name="l00177"></a>00177                 set_empty_total++;
<a name="l00178"></a>00178             }
<a name="l00179"></a>00179 
<a name="l00180"></a>00180             <span class="comment">// exact match (eval. by example)</span>
<a name="l00181"></a>00181             <span class="keywordflow">if</span> (set_inter == set_union) {
<a name="l00182"></a>00182                 exact_match++;
<a name="l00183"></a>00183             }
<a name="l00184"></a>00184 
<a name="l00185"></a>00185             <span class="comment">// f1 macro average by example</span>
<a name="l00186"></a>00186             <span class="keywordflow">if</span> (p_sum &gt; 0 &amp;&amp; r_sum &gt; 0 &amp;&amp; set_inter &gt; 0) {
<a name="l00187"></a>00187                 <span class="keywordtype">double</span> prec = (double) set_inter / (<span class="keywordtype">double</span>) p_sum;
<a name="l00188"></a>00188                 <span class="keywordtype">double</span> rec = (double) set_inter / (<span class="keywordtype">double</span>) r_sum;
<a name="l00189"></a>00189                 <span class="keywordflow">if</span> (prec &gt; 0 || rec &gt; 0) {
<a name="l00190"></a>00190                     f1_macro_D += ((2.0 * prec * rec) / (prec + rec));
<a name="l00191"></a>00191                 }
<a name="l00192"></a>00192             }
<a name="l00193"></a>00193 
<a name="l00194"></a>00194             <span class="comment">//one error: how many times the top ranked label is NOT in the label set</span>
<a name="l00195"></a>00195             <span class="keywordflow">if</span> (actual[Utils.maxIndex(ranking)] &lt;= 0) {
<a name="l00196"></a>00196                 one_error++;
<a name="l00197"></a>00197             }
<a name="l00198"></a>00198 
<a name="l00199"></a>00199         }
<a name="l00200"></a>00200 
<a name="l00201"></a>00201         <span class="keywordtype">double</span> fms[] = <span class="keyword">new</span> <span class="keywordtype">double</span>[L];
<a name="l00202"></a>00202         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; L; j++) {
<a name="l00203"></a>00203             <span class="comment">// micro average</span>
<a name="l00204"></a>00204             <span class="keywordflow">if</span> (o_tp[j] &lt;= 0) {
<a name="l00205"></a>00205                 fms[j] = 0.0;
<a name="l00206"></a>00206             } <span class="keywordflow">else</span> {
<a name="l00207"></a>00207                 <span class="keywordtype">double</span> prec = (double) o_tp[j] / ((<span class="keywordtype">double</span>) o_tp[j] + (double) o_fp[j]);
<a name="l00208"></a>00208                 <span class="keywordtype">double</span> recall = (double) o_tp[j] / ((<span class="keywordtype">double</span>) o_tp[j] + (double) o_fn[j]);
<a name="l00209"></a>00209                 fms[j] = 2 * ((prec * recall) / (prec + recall));
<a name="l00210"></a>00210             }
<a name="l00211"></a>00211         }
<a name="l00212"></a>00212 
<a name="l00213"></a>00213         <span class="keywordtype">double</span> precision = (double) set_inter_total / (<span class="keywordtype">double</span>) p_sum_total;
<a name="l00214"></a>00214         <span class="keywordtype">double</span> recall = (double) set_inter_total / (<span class="keywordtype">double</span>) r_sum_total;
<a name="l00215"></a>00215 
<a name="l00216"></a>00216         HashMap&lt;String, Double&gt; results = <span class="keyword">new</span> HashMap&lt;String, Double&gt;();
<a name="l00217"></a>00217         results.put(<span class="stringliteral">&quot;N&quot;</span>, N);
<a name="l00218"></a>00218         results.put(<span class="stringliteral">&quot;L&quot;</span>, (<span class="keywordtype">double</span>) L);
<a name="l00219"></a>00219         results.put(<span class="stringliteral">&quot;Accuracy&quot;</span>, (accuracy / N));
<a name="l00220"></a>00220         results.put(<span class="stringliteral">&quot;F1_micro&quot;</span>, (2.0 * precision * recall) / (precision + recall));
<a name="l00221"></a>00221         results.put(<span class="stringliteral">&quot;F1_macro_D&quot;</span>, (f1_macro_D / N));
<a name="l00222"></a>00222         results.put(<span class="stringliteral">&quot;F1_macro_L&quot;</span>, (Utils.sum(fms) / (double) L));
<a name="l00223"></a>00223         results.put(<span class="stringliteral">&quot;H_loss&quot;</span>, ((<span class="keywordtype">double</span>) hloss_total / ((<span class="keywordtype">double</span>) N * (<span class="keywordtype">double</span>) L)));
<a name="l00224"></a>00224         results.put(<span class="stringliteral">&quot;H_acc&quot;</span>, 1.0 - ((<span class="keywordtype">double</span>) hloss_total / ((<span class="keywordtype">double</span>) N * (<span class="keywordtype">double</span>) L)));
<a name="l00225"></a>00225         results.put(<span class="stringliteral">&quot;LCard_pred&quot;</span>, (<span class="keywordtype">double</span>) p_sum_total / N);
<a name="l00226"></a>00226         results.put(<span class="stringliteral">&quot;LCard_real&quot;</span>, (<span class="keywordtype">double</span>) r_sum_total / N);
<a name="l00227"></a>00227         results.put(<span class="stringliteral">&quot;LCard_diff&quot;</span>, Math.abs((((<span class="keywordtype">double</span>) p_sum_total / N) - (<span class="keywordtype">double</span>) r_sum_total / N)));
<a name="l00228"></a>00228         results.put(<span class="stringliteral">&quot;Coverage&quot;</span>, ((<span class="keywordtype">double</span>) coverage / N));
<a name="l00229"></a>00229         results.put(<span class="stringliteral">&quot;One_error&quot;</span>, ((<span class="keywordtype">double</span>) one_error / N));
<a name="l00230"></a>00230         results.put(<span class="stringliteral">&quot;Exact_match&quot;</span>, ((<span class="keywordtype">double</span>) exact_match / N));
<a name="l00231"></a>00231         results.put(<span class="stringliteral">&quot;ZeroOne_loss&quot;</span>, 1.0 - ((<span class="keywordtype">double</span>) exact_match / N));
<a name="l00232"></a>00232         results.put(<span class="stringliteral">&quot;LogLossD&quot;</span>, (log_loss_D / N));
<a name="l00233"></a>00233         results.put(<span class="stringliteral">&quot;LogLossL&quot;</span>, (log_loss_L / N));
<a name="l00234"></a>00234         results.put(<span class="stringliteral">&quot;Empty&quot;</span>, (<span class="keywordtype">double</span>) set_empty_total / (<span class="keywordtype">double</span>) N);
<a name="l00235"></a>00235         results.put(<span class="stringliteral">&quot;EmptyAccuracy&quot;</span>, (accuracy / (N - set_empty_total)));
<a name="l00236"></a>00236         results.put(<span class="stringliteral">&quot;EmptyMacroF1&quot;</span>, f1_macro_D / (N - (<span class="keywordtype">double</span>) set_empty_total));
<a name="l00237"></a>00237         <span class="comment">//results.put(&quot;Build_time&quot;      ,s.vals.get(&quot;Build_time&quot;));</span>
<a name="l00238"></a>00238         <span class="comment">//results.put(&quot;Test_time&quot;       ,s.vals.get(&quot;Test_time&quot;));</span>
<a name="l00239"></a>00239         <span class="comment">//results.put(&quot;Total_time&quot;      ,s.vals.get(&quot;Build_time&quot;) + s.vals.get(&quot;Test_time&quot;));</span>
<a name="l00240"></a>00240         results.put(<span class="stringliteral">&quot;TPR&quot;</span>, (<span class="keywordtype">double</span>) tp / (<span class="keywordtype">double</span>) (tp + fn));
<a name="l00241"></a>00241         results.put(<span class="stringliteral">&quot;FPR&quot;</span>, (<span class="keywordtype">double</span>) fp / (<span class="keywordtype">double</span>) (fp + tn));
<a name="l00242"></a>00242         results.put(<span class="stringliteral">&quot;Precision&quot;</span>, precision);
<a name="l00243"></a>00243         results.put(<span class="stringliteral">&quot;Recall&quot;</span>, recall);
<a name="l00244"></a>00244         results.put(<span class="stringliteral">&quot;Threshold&quot;</span>, t);
<a name="l00245"></a>00245 
<a name="l00246"></a>00246         <span class="keywordflow">return</span> results;
<a name="l00247"></a>00247     }
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="classmoa_1_1core_1_1utils_1_1EvalUtils_a592435db214404cd3bf0add80a330704_cgraph.png" border="0" usemap="#classmoa_1_1core_1_1utils_1_1EvalUtils_a592435db214404cd3bf0add80a330704_cgraph_map" alt=""></div>
<map name="classmoa_1_1core_1_1utils_1_1EvalUtils_a592435db214404cd3bf0add80a330704_cgraph_map" id="classmoa_1_1core_1_1utils_1_1EvalUtils_a592435db214404cd3bf0add80a330704_cgraph">
<area shape="rect" id="node3" href="classmoa_1_1core_1_1utils_1_1EvalUtils.html#a182ee3db6f8ad7d312070ec0ff039f72" title="Calculate Log Loss." alt="" coords="329,5,567,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a53642037b62c7504a4a3690630f3fa43"></a><!-- doxytag: member="moa::core::utils::EvalUtils::toIntArray" ref="a53642037b62c7504a4a3690630f3fa43" args="(Instance x, int L)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static final int [] moa.core.utils.EvalUtils.toIntArray </td>
          <td>(</td>
          <td class="paramtype">Instance&nbsp;</td>
          <td class="paramname"> <em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>L</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Convert Instance to bit array. </p>
<p>Returns the labels of this instance as an int array relevance representation. </p>

<p>Definition at line <a class="el" href="EvalUtils_8java_source.html#l00040">40</a> of file <a class="el" href="EvalUtils_8java_source.html">EvalUtils.java</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00040"></a>00040                                                             {
<a name="l00041"></a>00041         <span class="keywordtype">int</span> y[] = <span class="keyword">new</span> <span class="keywordtype">int</span>[L];
<a name="l00042"></a>00042         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; L; j++) {
<a name="l00043"></a>00043             y[j] = (int) Math.round(x.value(j));
<a name="l00044"></a>00044         }
<a name="l00045"></a>00045         <span class="keywordflow">return</span> y;
<a name="l00046"></a>00046     }
</pre></div></p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>main/java/moa/core/utils/<a class="el" href="EvalUtils_8java_source.html">EvalUtils.java</a></li>
</ul>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Enumerations</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr size="1"/><address style="text-align: right;"><small>Generated on 26 Nov 2014 for MOA by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
