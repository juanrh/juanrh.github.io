<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>MOA: main/java/moa/classifiers/lazy/neighboursearch/KDTree.java Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    </ul>
  </div>
<h1>main/java/moa/classifiers/lazy/neighboursearch/KDTree.java</h1><a href="KDTree_8java.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> *   This program is free software: you can redistribute it and/or modify</span>
<a name="l00003"></a>00003 <span class="comment"> *   it under the terms of the GNU General Public License as published by</span>
<a name="l00004"></a>00004 <span class="comment"> *   the Free Software Foundation, either version 3 of the License, or</span>
<a name="l00005"></a>00005 <span class="comment"> *   (at your option) any later version.</span>
<a name="l00006"></a>00006 <span class="comment"> *</span>
<a name="l00007"></a>00007 <span class="comment"> *   This program is distributed in the hope that it will be useful,</span>
<a name="l00008"></a>00008 <span class="comment"> *   but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00009"></a>00009 <span class="comment"> *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00010"></a>00010 <span class="comment"> *   GNU General Public License for more details.</span>
<a name="l00011"></a>00011 <span class="comment"> *</span>
<a name="l00012"></a>00012 <span class="comment"> *   You should have received a copy of the GNU General Public License</span>
<a name="l00013"></a>00013 <span class="comment"> *   along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="l00014"></a>00014 <span class="comment"> */</span>
<a name="l00015"></a>00015 
<a name="l00016"></a>00016 <span class="comment">/*</span>
<a name="l00017"></a>00017 <span class="comment"> *    KDTree.java</span>
<a name="l00018"></a>00018 <span class="comment"> *    Copyright (C) 2000-2012 University of Waikato</span>
<a name="l00019"></a>00019 <span class="comment"> *    </span>
<a name="l00020"></a>00020 <span class="comment"> */</span>
<a name="l00021"></a>00021 
<a name="l00022"></a>00022 <span class="keyword">package </span>moa.classifiers.lazy.neighboursearch;
<a name="l00023"></a>00023 
<a name="l00024"></a>00024 <span class="keyword">import</span> java.util.Enumeration;
<a name="l00025"></a>00025 <span class="keyword">import</span> java.util.Vector;
<a name="l00026"></a>00026 <span class="keyword">import</span> moa.classifiers.lazy.neighboursearch.kdtrees.KDTreeNode;
<a name="l00027"></a>00027 <span class="keyword">import</span> moa.classifiers.lazy.neighboursearch.kdtrees.KDTreeNodeSplitter;
<a name="l00028"></a>00028 <span class="keyword">import</span> moa.classifiers.lazy.neighboursearch.kdtrees.SlidingMidPointOfWidestSide;
<a name="l00029"></a>00029 <span class="keyword">import</span> weka.core.Instance;
<a name="l00030"></a>00030 <span class="keyword">import</span> weka.core.Instances;
<a name="l00031"></a>00031 
<a name="l00032"></a>00032 
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 
<a name="l00103"></a><a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html">00103</a> <span class="keyword">public</span> <span class="keyword">class </span><a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html" title="Class implementing the KDTree search algorithm for nearest neighbour search.">KDTree</a>
<a name="l00104"></a>00104   <span class="keyword">extends</span> <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1NearestNeighbourSearch.html" title="Abstract class for nearest neighbour search.">NearestNeighbourSearch</a> {
<a name="l00105"></a>00105 
<a name="l00107"></a><a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a84c8cd17f2ea861a37e29b36747d3e4e">00107</a>   <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keywordtype">long</span> <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a84c8cd17f2ea861a37e29b36747d3e4e" title="For serialization.">serialVersionUID</a> = 1505717283763272533L;
<a name="l00108"></a>00108 
<a name="l00113"></a><a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#ad12273a7e1ab755f586ee3473c165608">00113</a>   <span class="keyword">protected</span> <span class="keywordtype">double</span>[] <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#ad12273a7e1ab755f586ee3473c165608" title="Array holding the distances of the nearest neighbours.">m_DistanceList</a>;
<a name="l00114"></a>00114 
<a name="l00120"></a><a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#aff1654f72eb0eaf64895076126199cbc">00120</a>   <span class="keyword">protected</span> <span class="keywordtype">int</span>[] <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#aff1654f72eb0eaf64895076126199cbc" title="Indexlist of the instances of this kdtree.">m_InstList</a>;
<a name="l00121"></a>00121 
<a name="l00123"></a><a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a921f2c9e744d5f24d22db68810daa04c">00123</a>   <span class="keyword">protected</span> <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1kdtrees_1_1KDTreeNode.html" title="A class representing a KDTree node.">KDTreeNode</a> <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a921f2c9e744d5f24d22db68810daa04c" title="The root node of the tree.">m_Root</a>;
<a name="l00124"></a>00124 
<a name="l00126"></a><a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a84352fc3a7de173b099ffa088ff35902">00126</a>   <span class="keyword">protected</span> <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1kdtrees_1_1KDTreeNodeSplitter.html" title="Class that splits up a KDTreeNode.">KDTreeNodeSplitter</a> <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a84352fc3a7de173b099ffa088ff35902" title="The node splitter.">m_Splitter</a> = <span class="keyword">new</span> <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1kdtrees_1_1SlidingMidPointOfWidestSide.html" title="The class that splits a node into two based on the midpoint value of the dimension...">SlidingMidPointOfWidestSide</a>();
<a name="l00127"></a>00127 
<a name="l00129"></a><a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#ab5dff8dab9291cd5fccbc9d1bf2cbbc0">00129</a>   <span class="keyword">protected</span> <span class="keywordtype">int</span> <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#ab5dff8dab9291cd5fccbc9d1bf2cbbc0" title="Tree stats.">m_NumNodes</a>, <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a79e084f56f8b95b05aab351207f7f212">m_NumLeaves</a>, <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#ab5f60fee51561b0854f3dcb2ab324272">m_MaxDepth</a>;
<a name="l00130"></a>00130 
<a name="l00131"></a>00131   <span class="comment">// Constants</span>
<a name="l00133"></a><a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#af460f25ea4d5dcc189b16fb48c7c34a7">00133</a> <span class="comment"></span>  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keywordtype">int</span> <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#af460f25ea4d5dcc189b16fb48c7c34a7" title="The index of MIN value in attributes&amp;#39; range array.">MIN</a> = <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1EuclideanDistance.html" title="Implementing Euclidean distance (or similarity) function.">EuclideanDistance</a>.R_MIN;
<a name="l00134"></a>00134   
<a name="l00136"></a><a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#ad99f94f4ba1a22f7753047b2bce12c80">00136</a>   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keywordtype">int</span> <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#ad99f94f4ba1a22f7753047b2bce12c80" title="The index of MAX value in attributes&amp;#39; range array.">MAX</a> = <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1EuclideanDistance.html" title="Implementing Euclidean distance (or similarity) function.">EuclideanDistance</a>.R_MAX; 
<a name="l00137"></a>00137   
<a name="l00139"></a><a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#abb2d568b66a1b9e91b79ecc398b8a061">00139</a>   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keywordtype">int</span> <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#abb2d568b66a1b9e91b79ecc398b8a061" title="The index of WIDTH (MAX-MIN) value in attributes&amp;#39; range array.">WIDTH</a> = <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1EuclideanDistance.html" title="Implementing Euclidean distance (or similarity) function.">EuclideanDistance</a>.R_WIDTH;
<a name="l00140"></a>00140 
<a name="l00144"></a><a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a584124c830fe4881dacbd4137c31de7a">00144</a>   <span class="keyword">public</span> <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a584124c830fe4881dacbd4137c31de7a" title="Creates a new instance of KDTree.">KDTree</a>() {
<a name="l00145"></a>00145     super();
<a name="l00146"></a>00146   }
<a name="l00147"></a>00147 
<a name="l00154"></a><a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a9b21f6d34e54ec901ac27f1fe33a3e80">00154</a>   <span class="keyword">public</span> <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a9b21f6d34e54ec901ac27f1fe33a3e80" title="Creates a new instance of KDTree.">KDTree</a>(Instances insts) {
<a name="l00155"></a>00155     super(insts);
<a name="l00156"></a>00156   }
<a name="l00157"></a>00157 
<a name="l00169"></a><a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#add9af014556f5230ca5f038c9f8ca4bb">00169</a>   <span class="keyword">protected</span> <span class="keywordtype">void</span> <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#add9af014556f5230ca5f038c9f8ca4bb" title="Builds the KDTree on the supplied set of instances/points.">buildKDTree</a>(Instances instances) <span class="keywordflow">throws</span> Exception {
<a name="l00170"></a>00170 
<a name="l00171"></a>00171     <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a02e9febff8b2afe9501f2ad51e6d7d2b" title="Checks if there is any instance with missing values.">checkMissing</a>(instances);
<a name="l00172"></a>00172     <span class="keywordflow">if</span> (<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#aef887089a7250b9c5d3f79cfb2755730" title="The euclidean distance function to use.">m_EuclideanDistance</a> == null)
<a name="l00173"></a>00173       <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1NearestNeighbourSearch.html#a2dac7a5d55e15226b854449c9804d274" title="the distance function used.">m_DistanceFunction</a> = <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#aef887089a7250b9c5d3f79cfb2755730" title="The euclidean distance function to use.">m_EuclideanDistance</a> = <span class="keyword">new</span> <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1EuclideanDistance.html" title="Implementing Euclidean distance (or similarity) function.">EuclideanDistance</a>(
<a name="l00174"></a>00174           instances);
<a name="l00175"></a>00175     <span class="keywordflow">else</span>
<a name="l00176"></a>00176       <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#aef887089a7250b9c5d3f79cfb2755730" title="The euclidean distance function to use.">m_EuclideanDistance</a>.<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1NormalizableDistance.html#a2e2c65fc03cd2331dae1ee3c30cf3153" title="Sets the instances.">setInstances</a>(instances);
<a name="l00177"></a>00177 
<a name="l00178"></a>00178     <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1NearestNeighbourSearch.html#a4c51e812fad51b3fe3c71d95f54d34a4" title="The neighbourhood of instances to find neighbours in.">m_Instances</a> = instances;
<a name="l00179"></a>00179     <span class="keywordtype">int</span> numInst = <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1NearestNeighbourSearch.html#a4c51e812fad51b3fe3c71d95f54d34a4" title="The neighbourhood of instances to find neighbours in.">m_Instances</a>.numInstances();
<a name="l00180"></a>00180 
<a name="l00181"></a>00181     <span class="comment">// Make the global index list</span>
<a name="l00182"></a>00182     <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#aff1654f72eb0eaf64895076126199cbc" title="Indexlist of the instances of this kdtree.">m_InstList</a> = <span class="keyword">new</span> <span class="keywordtype">int</span>[numInst];
<a name="l00183"></a>00183 
<a name="l00184"></a>00184     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; numInst; i++) {
<a name="l00185"></a>00185       <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#aff1654f72eb0eaf64895076126199cbc" title="Indexlist of the instances of this kdtree.">m_InstList</a>[i] = i;
<a name="l00186"></a>00186     }
<a name="l00187"></a>00187 
<a name="l00188"></a>00188     <span class="keywordtype">double</span>[][] universe = <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#aef887089a7250b9c5d3f79cfb2755730" title="The euclidean distance function to use.">m_EuclideanDistance</a>.<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1NormalizableDistance.html#a696f146c8dfbf0149f2eee8cab6855f6" title="Method to get the ranges.">getRanges</a>();
<a name="l00189"></a>00189 
<a name="l00190"></a>00190     <span class="comment">// initializing internal fields of KDTreeSplitter</span>
<a name="l00191"></a>00191     <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a84352fc3a7de173b099ffa088ff35902" title="The node splitter.">m_Splitter</a>.<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1kdtrees_1_1KDTreeNodeSplitter.html#a0c18ed54a7b4d7f922fc7703d8f9d964" title="Sets the training instances on which the tree is (or is to be) built.">setInstances</a>(<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1NearestNeighbourSearch.html#a4c51e812fad51b3fe3c71d95f54d34a4" title="The neighbourhood of instances to find neighbours in.">m_Instances</a>);
<a name="l00192"></a>00192     <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a84352fc3a7de173b099ffa088ff35902" title="The node splitter.">m_Splitter</a>.<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1kdtrees_1_1KDTreeNodeSplitter.html#a5f1b3f5ff3039e24765d9a63439a40a5" title="Sets the master index array containing indices of the training instances.">setInstanceList</a>(<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#aff1654f72eb0eaf64895076126199cbc" title="Indexlist of the instances of this kdtree.">m_InstList</a>);
<a name="l00193"></a>00193     <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a84352fc3a7de173b099ffa088ff35902" title="The node splitter.">m_Splitter</a>.<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1kdtrees_1_1KDTreeNodeSplitter.html#a7eb3bbf6b900b24a03d0c3f69710cd64" title="Sets the EuclideanDistance object to use for splitting nodes.">setEuclideanDistanceFunction</a>(<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#aef887089a7250b9c5d3f79cfb2755730" title="The euclidean distance function to use.">m_EuclideanDistance</a>);
<a name="l00194"></a>00194     <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a84352fc3a7de173b099ffa088ff35902" title="The node splitter.">m_Splitter</a>.<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1kdtrees_1_1KDTreeNodeSplitter.html#a64adfbfa25bce909b99fa7c98eb153dd" title="Sets whether if a nodes region is normalized or not.">setNodeWidthNormalization</a>(<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#ae996feaa47a38087caa95ba387099c32" title="Properties&amp;#39; variables =====================================================.">m_NormalizeNodeWidth</a>);
<a name="l00195"></a>00195 
<a name="l00196"></a>00196     <span class="comment">// building tree</span>
<a name="l00197"></a>00197     <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#ab5dff8dab9291cd5fccbc9d1bf2cbbc0" title="Tree stats.">m_NumNodes</a> = <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a79e084f56f8b95b05aab351207f7f212">m_NumLeaves</a> = 1;
<a name="l00198"></a>00198     <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#ab5f60fee51561b0854f3dcb2ab324272">m_MaxDepth</a> = 0;
<a name="l00199"></a>00199     <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a921f2c9e744d5f24d22db68810daa04c" title="The root node of the tree.">m_Root</a> = <span class="keyword">new</span> <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1kdtrees_1_1KDTreeNode.html" title="A class representing a KDTree node.">KDTreeNode</a>(<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#ab5dff8dab9291cd5fccbc9d1bf2cbbc0" title="Tree stats.">m_NumNodes</a>, 0, <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1NearestNeighbourSearch.html#a4c51e812fad51b3fe3c71d95f54d34a4" title="The neighbourhood of instances to find neighbours in.">m_Instances</a>.numInstances() - 1,
<a name="l00200"></a>00200         universe);
<a name="l00201"></a>00201 
<a name="l00202"></a>00202     <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a4b17a18f7ed788e286e8eb61d77877e6" title="Recursively splits nodes of a tree starting from the supplied node.">splitNodes</a>(<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a921f2c9e744d5f24d22db68810daa04c" title="The root node of the tree.">m_Root</a>, universe, <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#ab5f60fee51561b0854f3dcb2ab324272">m_MaxDepth</a> + 1);
<a name="l00203"></a>00203   }
<a name="l00204"></a>00204 
<a name="l00219"></a><a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a4b17a18f7ed788e286e8eb61d77877e6">00219</a>   <span class="keyword">protected</span> <span class="keywordtype">void</span> <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a4b17a18f7ed788e286e8eb61d77877e6" title="Recursively splits nodes of a tree starting from the supplied node.">splitNodes</a>(<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1kdtrees_1_1KDTreeNode.html" title="A class representing a KDTree node.">KDTreeNode</a> node, <span class="keywordtype">double</span>[][] universe,
<a name="l00220"></a>00220       <span class="keywordtype">int</span> depth) <span class="keywordflow">throws</span> Exception {
<a name="l00221"></a>00221     <span class="keywordtype">double</span>[][] nodeRanges = <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#aef887089a7250b9c5d3f79cfb2755730" title="The euclidean distance function to use.">m_EuclideanDistance</a>.<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1NormalizableDistance.html#a35975f221e5126583f1aa0177c7c5e5c" title="Initializes the ranges using all instances of the dataset.">initializeRanges</a>(<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#aff1654f72eb0eaf64895076126199cbc" title="Indexlist of the instances of this kdtree.">m_InstList</a>,
<a name="l00222"></a>00222                                                  node.m_Start, node.m_End);
<a name="l00223"></a>00223     <span class="keywordflow">if</span> (node.numInstances() &lt;= <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a166100c63bf7e886033a9a1505c94875" title="maximal number of instances in a leaf.">m_MaxInstInLeaf</a>
<a name="l00224"></a>00224         || <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a634297dd4f45eccd5d5b06216d2ec2cb" title="Returns the maximum attribute width of instances/points in a KDTreeNode relative...">getMaxRelativeNodeWidth</a>(nodeRanges, universe) &lt;= <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a06957b5efa3ea76050e0e3d86d2127bc" title="minimal relative width of a KDTree rectangle.">m_MinBoxRelWidth</a>)
<a name="l00225"></a>00225       <span class="keywordflow">return</span>;
<a name="l00226"></a>00226 
<a name="l00227"></a>00227     <span class="comment">// splitting a node so it is no longer a leaf</span>
<a name="l00228"></a>00228     <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a79e084f56f8b95b05aab351207f7f212">m_NumLeaves</a>--;
<a name="l00229"></a>00229 
<a name="l00230"></a>00230     <span class="keywordflow">if</span> (depth &gt; <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#ab5f60fee51561b0854f3dcb2ab324272">m_MaxDepth</a>)
<a name="l00231"></a>00231       <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#ab5f60fee51561b0854f3dcb2ab324272">m_MaxDepth</a> = depth;
<a name="l00232"></a>00232 
<a name="l00233"></a>00233     <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a84352fc3a7de173b099ffa088ff35902" title="The node splitter.">m_Splitter</a>.<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1kdtrees_1_1KDTreeNodeSplitter.html#aaa4e38cc22d39f0fb5ab16c150ffff43" title="Splits a node into two.">splitNode</a>(node, <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#ab5dff8dab9291cd5fccbc9d1bf2cbbc0" title="Tree stats.">m_NumNodes</a>, nodeRanges, universe);
<a name="l00234"></a>00234     <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#ab5dff8dab9291cd5fccbc9d1bf2cbbc0" title="Tree stats.">m_NumNodes</a> += 2;
<a name="l00235"></a>00235     <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a79e084f56f8b95b05aab351207f7f212">m_NumLeaves</a> += 2;
<a name="l00236"></a>00236 
<a name="l00237"></a>00237     <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a4b17a18f7ed788e286e8eb61d77877e6" title="Recursively splits nodes of a tree starting from the supplied node.">splitNodes</a>(node.m_Left, universe, depth + 1);
<a name="l00238"></a>00238     <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a4b17a18f7ed788e286e8eb61d77877e6" title="Recursively splits nodes of a tree starting from the supplied node.">splitNodes</a>(node.m_Right, universe, depth + 1);
<a name="l00239"></a>00239   }
<a name="l00240"></a>00240 
<a name="l00258"></a><a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a61aad22ad6a1bc0f0cdbdfa2cb8c5144">00258</a>   <span class="keyword">protected</span> <span class="keywordtype">void</span> <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a61aad22ad6a1bc0f0cdbdfa2cb8c5144" title="Returns (in the supplied heap object) the k nearest neighbours of the given instance...">findNearestNeighbours</a>(Instance target, <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1kdtrees_1_1KDTreeNode.html" title="A class representing a KDTree node.">KDTreeNode</a> node, <span class="keywordtype">int</span> k,
<a name="l00259"></a>00259       <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1NearestNeighbourSearch_1_1MyHeap.html" title="A class for a heap to store the nearest k neighbours to an instance.">MyHeap</a> heap, <span class="keywordtype">double</span> distanceToParents) <span class="keywordflow">throws</span> Exception {
<a name="l00260"></a>00260     <span class="keywordflow">if</span> (node.isALeaf()) {
<a name="l00261"></a>00261       <span class="keywordtype">double</span> distance;
<a name="l00262"></a>00262       <span class="comment">// look at all the instances in this leaf</span>
<a name="l00263"></a>00263       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> idx = node.m_Start; idx &lt;= node.m_End; idx++) {
<a name="l00264"></a>00264         <span class="keywordflow">if</span> (target == <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1NearestNeighbourSearch.html#a4c51e812fad51b3fe3c71d95f54d34a4" title="The neighbourhood of instances to find neighbours in.">m_Instances</a>.instance(<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#aff1654f72eb0eaf64895076126199cbc" title="Indexlist of the instances of this kdtree.">m_InstList</a>[idx])) <span class="comment">// for</span>
<a name="l00265"></a>00265                                                               <span class="comment">// hold-one-out</span>
<a name="l00266"></a>00266                                                               <span class="comment">// cross-validation</span>
<a name="l00267"></a>00267           <span class="keywordflow">continue</span>;
<a name="l00268"></a>00268         <span class="keywordflow">if</span> (heap.size() &lt; k) {
<a name="l00269"></a>00269           distance = <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#aef887089a7250b9c5d3f79cfb2755730" title="The euclidean distance function to use.">m_EuclideanDistance</a>.<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1EuclideanDistance.html#ad2ccd44d1a04e5e705396bf3746cb020" title="Calculates the distance between two instances.">distance</a>(target, <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1NearestNeighbourSearch.html#a4c51e812fad51b3fe3c71d95f54d34a4" title="The neighbourhood of instances to find neighbours in.">m_Instances</a>
<a name="l00270"></a>00270               .instance(<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#aff1654f72eb0eaf64895076126199cbc" title="Indexlist of the instances of this kdtree.">m_InstList</a>[idx]), Double.POSITIVE_INFINITY);
<a name="l00271"></a>00271           heap.put(<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#aff1654f72eb0eaf64895076126199cbc" title="Indexlist of the instances of this kdtree.">m_InstList</a>[idx], distance);
<a name="l00272"></a>00272         } <span class="keywordflow">else</span> {
<a name="l00273"></a>00273           <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1NearestNeighbourSearch_1_1MyHeapElement.html" title="A class for storing data about a neighboring instance.">MyHeapElement</a> temp = heap.peek();
<a name="l00274"></a>00274           distance = <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#aef887089a7250b9c5d3f79cfb2755730" title="The euclidean distance function to use.">m_EuclideanDistance</a>.<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1EuclideanDistance.html#ad2ccd44d1a04e5e705396bf3746cb020" title="Calculates the distance between two instances.">distance</a>(target, <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1NearestNeighbourSearch.html#a4c51e812fad51b3fe3c71d95f54d34a4" title="The neighbourhood of instances to find neighbours in.">m_Instances</a>
<a name="l00275"></a>00275               .instance(<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#aff1654f72eb0eaf64895076126199cbc" title="Indexlist of the instances of this kdtree.">m_InstList</a>[idx]), temp.<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1NearestNeighbourSearch_1_1MyHeapElement.html#a2e40c568e1c33b4427c36545aab28cf5" title="the distance of this element.">distance</a>);
<a name="l00276"></a>00276           <span class="keywordflow">if</span> (distance &lt; temp.<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1NearestNeighbourSearch_1_1MyHeapElement.html#a2e40c568e1c33b4427c36545aab28cf5" title="the distance of this element.">distance</a>) {
<a name="l00277"></a>00277             heap.putBySubstitute(<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#aff1654f72eb0eaf64895076126199cbc" title="Indexlist of the instances of this kdtree.">m_InstList</a>[idx], distance);
<a name="l00278"></a>00278           } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (distance == temp.<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1NearestNeighbourSearch_1_1MyHeapElement.html#a2e40c568e1c33b4427c36545aab28cf5" title="the distance of this element.">distance</a>) {
<a name="l00279"></a>00279             heap.putKthNearest(<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#aff1654f72eb0eaf64895076126199cbc" title="Indexlist of the instances of this kdtree.">m_InstList</a>[idx], distance);
<a name="l00280"></a>00280           }
<a name="l00281"></a>00281         }<span class="comment">// end else heap.size==k</span>
<a name="l00282"></a>00282       }<span class="comment">// end for</span>
<a name="l00283"></a>00283 
<a name="l00284"></a>00284     } <span class="keywordflow">else</span> {
<a name="l00285"></a>00285       <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1kdtrees_1_1KDTreeNode.html" title="A class representing a KDTree node.">KDTreeNode</a> nearer, further;
<a name="l00286"></a>00286       <span class="keywordtype">boolean</span> targetInLeft = <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#aef887089a7250b9c5d3f79cfb2755730" title="The euclidean distance function to use.">m_EuclideanDistance</a>.<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1EuclideanDistance.html#a24669e69b32d7edf8c965ccc2358de9c" title="Returns true if the value of the given dimension is smaller or equal the value to...">valueIsSmallerEqual</a>(target,
<a name="l00287"></a>00287           node.m_SplitDim, node.m_SplitValue);
<a name="l00288"></a>00288 
<a name="l00289"></a>00289       <span class="keywordflow">if</span> (targetInLeft) {
<a name="l00290"></a>00290         nearer = node.<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1kdtrees_1_1KDTreeNode.html#a7f5fd55018de878ac9321f0964463549" title="left subtree; contains instances with smaller or equal to split value.">m_Left</a>;
<a name="l00291"></a>00291         further = node.<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1kdtrees_1_1KDTreeNode.html#a6872ac11dd64caeb3865ba7fed614289" title="right subtree; contains instances with larger than split value.">m_Right</a>;
<a name="l00292"></a>00292       } <span class="keywordflow">else</span> {
<a name="l00293"></a>00293         nearer = node.<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1kdtrees_1_1KDTreeNode.html#a6872ac11dd64caeb3865ba7fed614289" title="right subtree; contains instances with larger than split value.">m_Right</a>;
<a name="l00294"></a>00294         further = node.<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1kdtrees_1_1KDTreeNode.html#a7f5fd55018de878ac9321f0964463549" title="left subtree; contains instances with smaller or equal to split value.">m_Left</a>;
<a name="l00295"></a>00295       }
<a name="l00296"></a>00296       <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a61aad22ad6a1bc0f0cdbdfa2cb8c5144" title="Returns (in the supplied heap object) the k nearest neighbours of the given instance...">findNearestNeighbours</a>(target, nearer, k, heap, distanceToParents);
<a name="l00297"></a>00297 
<a name="l00298"></a>00298       <span class="comment">// ... now look in further half if maxDist reaches into it</span>
<a name="l00299"></a>00299       <span class="keywordflow">if</span> (heap.size() &lt; k) { <span class="comment">// if haven&apos;t found the first k</span>
<a name="l00300"></a>00300         <span class="keywordtype">double</span> distanceToSplitPlane = distanceToParents
<a name="l00301"></a>00301             + <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#aef887089a7250b9c5d3f79cfb2755730" title="The euclidean distance function to use.">m_EuclideanDistance</a>.<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1EuclideanDistance.html#ad2902424de6444a7cec02c1500adad21" title="Returns the squared difference of two values of an attribute.">sqDifference</a>(node.m_SplitDim, target
<a name="l00302"></a>00302                 .value(node.m_SplitDim), node.m_SplitValue);
<a name="l00303"></a>00303         <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a61aad22ad6a1bc0f0cdbdfa2cb8c5144" title="Returns (in the supplied heap object) the k nearest neighbours of the given instance...">findNearestNeighbours</a>(target, further, k, heap, distanceToSplitPlane);
<a name="l00304"></a>00304         <span class="keywordflow">return</span>;
<a name="l00305"></a>00305       } <span class="keywordflow">else</span> { <span class="comment">// else see if ball centered at query intersects with the other</span>
<a name="l00306"></a>00306                 <span class="comment">// side.</span>
<a name="l00307"></a>00307         <span class="keywordtype">double</span> distanceToSplitPlane = distanceToParents
<a name="l00308"></a>00308             + <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#aef887089a7250b9c5d3f79cfb2755730" title="The euclidean distance function to use.">m_EuclideanDistance</a>.<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1EuclideanDistance.html#ad2902424de6444a7cec02c1500adad21" title="Returns the squared difference of two values of an attribute.">sqDifference</a>(node.m_SplitDim, target
<a name="l00309"></a>00309                 .value(node.m_SplitDim), node.m_SplitValue);
<a name="l00310"></a>00310         <span class="keywordflow">if</span> (heap.peek().distance &gt;= distanceToSplitPlane) {
<a name="l00311"></a>00311           <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a61aad22ad6a1bc0f0cdbdfa2cb8c5144" title="Returns (in the supplied heap object) the k nearest neighbours of the given instance...">findNearestNeighbours</a>(target, further, k, heap, distanceToSplitPlane);
<a name="l00312"></a>00312         }
<a name="l00313"></a>00313       }<span class="comment">// end else</span>
<a name="l00314"></a>00314     }<span class="comment">// end else_if an internal node</span>
<a name="l00315"></a>00315   }
<a name="l00316"></a>00316 
<a name="l00328"></a><a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a5549700af886cbd717ec953ef6917dc6">00328</a>   <span class="keyword">public</span> Instances <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a5549700af886cbd717ec953ef6917dc6" title="Returns the k nearest neighbours of the supplied instance.">kNearestNeighbours</a>(Instance target, <span class="keywordtype">int</span> k) <span class="keywordflow">throws</span> Exception {
<a name="l00329"></a>00329     <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a02e9febff8b2afe9501f2ad51e6d7d2b" title="Checks if there is any instance with missing values.">checkMissing</a>(target);
<a name="l00330"></a>00330     
<a name="l00331"></a>00331     <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1NearestNeighbourSearch_1_1MyHeap.html" title="A class for a heap to store the nearest k neighbours to an instance.">MyHeap</a> heap = <span class="keyword">new</span> <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1NearestNeighbourSearch_1_1MyHeap.html" title="A class for a heap to store the nearest k neighbours to an instance.">MyHeap</a>(k);
<a name="l00332"></a>00332     <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a61aad22ad6a1bc0f0cdbdfa2cb8c5144" title="Returns (in the supplied heap object) the k nearest neighbours of the given instance...">findNearestNeighbours</a>(target, <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a921f2c9e744d5f24d22db68810daa04c" title="The root node of the tree.">m_Root</a>, k, heap, 0.0);
<a name="l00333"></a>00333 
<a name="l00334"></a>00334     Instances neighbours = <span class="keyword">new</span> Instances(<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1NearestNeighbourSearch.html#a4c51e812fad51b3fe3c71d95f54d34a4" title="The neighbourhood of instances to find neighbours in.">m_Instances</a>, (heap.<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1NearestNeighbourSearch_1_1MyHeap.html#ac9e877c56727dda18be2021c4c99df44" title="returns the size of the heap.">size</a>() + heap
<a name="l00335"></a>00335         .<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1NearestNeighbourSearch_1_1MyHeap.html#a34366c6deedbe3a9a54b6635757eb3dd" title="returns the number of k nearest.">noOfKthNearest</a>()));
<a name="l00336"></a>00336     <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#ad12273a7e1ab755f586ee3473c165608" title="Array holding the distances of the nearest neighbours.">m_DistanceList</a> = <span class="keyword">new</span> <span class="keywordtype">double</span>[heap.<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1NearestNeighbourSearch_1_1MyHeap.html#ac9e877c56727dda18be2021c4c99df44" title="returns the size of the heap.">size</a>() + heap.<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1NearestNeighbourSearch_1_1MyHeap.html#a34366c6deedbe3a9a54b6635757eb3dd" title="returns the number of k nearest.">noOfKthNearest</a>()];
<a name="l00337"></a>00337     <span class="keywordtype">int</span>[] indices = <span class="keyword">new</span> <span class="keywordtype">int</span>[heap.<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1NearestNeighbourSearch_1_1MyHeap.html#ac9e877c56727dda18be2021c4c99df44" title="returns the size of the heap.">size</a>() + heap.<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1NearestNeighbourSearch_1_1MyHeap.html#a34366c6deedbe3a9a54b6635757eb3dd" title="returns the number of k nearest.">noOfKthNearest</a>()];
<a name="l00338"></a>00338     <span class="keywordtype">int</span> i = indices.length - 1;
<a name="l00339"></a>00339     <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1NearestNeighbourSearch_1_1MyHeapElement.html" title="A class for storing data about a neighboring instance.">MyHeapElement</a> h;
<a name="l00340"></a>00340     <span class="keywordflow">while</span> (heap.<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1NearestNeighbourSearch_1_1MyHeap.html#a34366c6deedbe3a9a54b6635757eb3dd" title="returns the number of k nearest.">noOfKthNearest</a>() &gt; 0) {
<a name="l00341"></a>00341       h = heap.<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1NearestNeighbourSearch_1_1MyHeap.html#a5923f7607c4a6fb5d756dd503d51eab9" title="returns the kth nearest element or null if none there.">getKthNearest</a>();
<a name="l00342"></a>00342       indices[i] = h.<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1NearestNeighbourSearch_1_1MyHeapElement.html#adec73e64405f537aaaf8264deb0ba30f" title="the index of this element.">index</a>;
<a name="l00343"></a>00343       <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#ad12273a7e1ab755f586ee3473c165608" title="Array holding the distances of the nearest neighbours.">m_DistanceList</a>[i] = h.<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1NearestNeighbourSearch_1_1MyHeapElement.html#a2e40c568e1c33b4427c36545aab28cf5" title="the distance of this element.">distance</a>;
<a name="l00344"></a>00344       i--;
<a name="l00345"></a>00345     }
<a name="l00346"></a>00346     <span class="keywordflow">while</span> (heap.<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1NearestNeighbourSearch_1_1MyHeap.html#ac9e877c56727dda18be2021c4c99df44" title="returns the size of the heap.">size</a>() &gt; 0) {
<a name="l00347"></a>00347       h = heap.<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1NearestNeighbourSearch_1_1MyHeap.html#a19758f98f6ae1f6144884dcdbfbe10d9" title="returns the first element and removes it from the heap.">get</a>();
<a name="l00348"></a>00348       indices[i] = h.<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1NearestNeighbourSearch_1_1MyHeapElement.html#adec73e64405f537aaaf8264deb0ba30f" title="the index of this element.">index</a>;
<a name="l00349"></a>00349       <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#ad12273a7e1ab755f586ee3473c165608" title="Array holding the distances of the nearest neighbours.">m_DistanceList</a>[i] = h.<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1NearestNeighbourSearch_1_1MyHeapElement.html#a2e40c568e1c33b4427c36545aab28cf5" title="the distance of this element.">distance</a>;
<a name="l00350"></a>00350       i--;
<a name="l00351"></a>00351     }
<a name="l00352"></a>00352     <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1NearestNeighbourSearch.html#a2dac7a5d55e15226b854449c9804d274" title="the distance function used.">m_DistanceFunction</a>.<a class="code" href="interfacemoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1DistanceFunction.html#a4214e297cf5a570a098018d628ff9ec5" title="Does post processing of the distances (if necessary) returned by distance(distance(Instance...">postProcessDistances</a>(<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#ad12273a7e1ab755f586ee3473c165608" title="Array holding the distances of the nearest neighbours.">m_DistanceList</a>);
<a name="l00353"></a>00353 
<a name="l00354"></a>00354     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> idx = 0; idx &lt; indices.length; idx++) {
<a name="l00355"></a>00355       neighbours.add(<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1NearestNeighbourSearch.html#a4c51e812fad51b3fe3c71d95f54d34a4" title="The neighbourhood of instances to find neighbours in.">m_Instances</a>.instance(indices[idx]));
<a name="l00356"></a>00356     }
<a name="l00357"></a>00357 
<a name="l00358"></a>00358     <span class="keywordflow">return</span> neighbours;
<a name="l00359"></a>00359   }
<a name="l00360"></a>00360   
<a name="l00361"></a>00361 
<a name="l00371"></a><a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a59d618cbc6693a845ad8cc9709064b32">00371</a>   <span class="keyword">public</span> Instance <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a59d618cbc6693a845ad8cc9709064b32" title="Returns the nearest neighbour of the supplied target instance.">nearestNeighbour</a>(Instance target) <span class="keywordflow">throws</span> Exception {
<a name="l00372"></a>00372     <span class="keywordflow">return</span> (<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a5549700af886cbd717ec953ef6917dc6" title="Returns the k nearest neighbours of the supplied instance.">kNearestNeighbours</a>(target, 1)).instance(0);
<a name="l00373"></a>00373   }
<a name="l00374"></a>00374   
<a name="l00386"></a><a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a46ca7a80f92b5e4f4bca40f6505272ca">00386</a>   <span class="keyword">public</span> <span class="keywordtype">double</span>[] <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a46ca7a80f92b5e4f4bca40f6505272ca" title="Returns the distances to the kNearest or 1 nearest neighbour currently found with...">getDistances</a>() throws Exception {
<a name="l00387"></a>00387     <span class="keywordflow">if</span> (<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1NearestNeighbourSearch.html#a4c51e812fad51b3fe3c71d95f54d34a4" title="The neighbourhood of instances to find neighbours in.">m_Instances</a> == null || <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#ad12273a7e1ab755f586ee3473c165608" title="Array holding the distances of the nearest neighbours.">m_DistanceList</a> == null)
<a name="l00388"></a>00388       <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&quot;The tree has not been supplied with a set of &quot;</span>
<a name="l00389"></a>00389           + <span class="stringliteral">&quot;instances or getDistances() has been called &quot;</span>
<a name="l00390"></a>00390           + <span class="stringliteral">&quot;before calling kNearestNeighbours().&quot;</span>);
<a name="l00391"></a>00391     <span class="keywordflow">return</span> <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#ad12273a7e1ab755f586ee3473c165608" title="Array holding the distances of the nearest neighbours.">m_DistanceList</a>;
<a name="l00392"></a>00392   }
<a name="l00393"></a>00393   
<a name="l00394"></a>00394 
<a name="l00402"></a><a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#af220a59e6c7342d42b7e36da82d00af4">00402</a>   <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#af220a59e6c7342d42b7e36da82d00af4" title="Builds the KDTree on the given set of instances.">setInstances</a>(Instances instances) <span class="keywordflow">throws</span> Exception {
<a name="l00403"></a>00403     super.setInstances(instances);
<a name="l00404"></a>00404     <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#add9af014556f5230ca5f038c9f8ca4bb" title="Builds the KDTree on the supplied set of instances/points.">buildKDTree</a>(instances);
<a name="l00405"></a>00405   }
<a name="l00406"></a>00406   
<a name="l00407"></a>00407 
<a name="l00416"></a><a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a18df0a0c0a1c1c62947feddb0aebe811">00416</a>   <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a18df0a0c0a1c1c62947feddb0aebe811" title="Adds one instance to the KDTree.">update</a>(Instance instance) <span class="keywordflow">throws</span> Exception { <span class="comment">// better to change</span>
<a name="l00417"></a>00417                                                             <span class="comment">// to addInstance</span>
<a name="l00418"></a>00418     <span class="keywordflow">if</span> (<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1NearestNeighbourSearch.html#a4c51e812fad51b3fe3c71d95f54d34a4" title="The neighbourhood of instances to find neighbours in.">m_Instances</a> == null)
<a name="l00419"></a>00419       <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&quot;No instances supplied yet. Have to call &quot;</span>
<a name="l00420"></a>00420           + <span class="stringliteral">&quot;setInstances(instances) with a set of Instances &quot;</span> + <span class="stringliteral">&quot;first.&quot;</span>);
<a name="l00421"></a>00421 
<a name="l00422"></a>00422     <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#ab29174bc96ed7de9cfbc4a6fcc6b3220" title="Adds one instance to KDTree loosly.">addInstanceInfo</a>(instance);
<a name="l00423"></a>00423     <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a6641f4b3339242c2f9a6312c6358496c" title="Recursively adds an instance to the tree starting from the supplied KDTreeNode.">addInstanceToTree</a>(instance, <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a921f2c9e744d5f24d22db68810daa04c" title="The root node of the tree.">m_Root</a>);
<a name="l00424"></a>00424   }
<a name="l00425"></a>00425 
<a name="l00440"></a><a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a6641f4b3339242c2f9a6312c6358496c">00440</a>   <span class="keyword">protected</span> <span class="keywordtype">void</span> <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a6641f4b3339242c2f9a6312c6358496c" title="Recursively adds an instance to the tree starting from the supplied KDTreeNode.">addInstanceToTree</a>(Instance inst, <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1kdtrees_1_1KDTreeNode.html" title="A class representing a KDTree node.">KDTreeNode</a> node)
<a name="l00441"></a>00441       <span class="keywordflow">throws</span> Exception {
<a name="l00442"></a>00442     <span class="keywordflow">if</span> (node.isALeaf()) {
<a name="l00443"></a>00443       <span class="keywordtype">int</span> instList[] = <span class="keyword">new</span> <span class="keywordtype">int</span>[<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1NearestNeighbourSearch.html#a4c51e812fad51b3fe3c71d95f54d34a4" title="The neighbourhood of instances to find neighbours in.">m_Instances</a>.numInstances()];
<a name="l00444"></a>00444       <span class="keywordflow">try</span> {
<a name="l00445"></a>00445         System.arraycopy(<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#aff1654f72eb0eaf64895076126199cbc" title="Indexlist of the instances of this kdtree.">m_InstList</a>, 0, instList, 0, node.m_End + 1); <span class="comment">// m_InstList.squeezeIn(m_End,</span>
<a name="l00446"></a>00446                                                                       <span class="comment">// index);</span>
<a name="l00447"></a>00447         <span class="keywordflow">if</span> (node.m_End &lt; <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#aff1654f72eb0eaf64895076126199cbc" title="Indexlist of the instances of this kdtree.">m_InstList</a>.length - 1)
<a name="l00448"></a>00448           System.arraycopy(<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#aff1654f72eb0eaf64895076126199cbc" title="Indexlist of the instances of this kdtree.">m_InstList</a>, node.m_End + 1, instList,
<a name="l00449"></a>00449               node.m_End + 2, <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#aff1654f72eb0eaf64895076126199cbc" title="Indexlist of the instances of this kdtree.">m_InstList</a>.length - node.m_End - 1);
<a name="l00450"></a>00450         instList[node.m_End + 1] = <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1NearestNeighbourSearch.html#a4c51e812fad51b3fe3c71d95f54d34a4" title="The neighbourhood of instances to find neighbours in.">m_Instances</a>.numInstances() - 1;
<a name="l00451"></a>00451       } <span class="keywordflow">catch</span> (ArrayIndexOutOfBoundsException ex) {
<a name="l00452"></a>00452         System.err.println(<span class="stringliteral">&quot;m_InstList.length: &quot;</span> + <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#aff1654f72eb0eaf64895076126199cbc" title="Indexlist of the instances of this kdtree.">m_InstList</a>.length
<a name="l00453"></a>00453             + <span class="stringliteral">&quot; instList.length: &quot;</span> + instList.length + <span class="stringliteral">&quot;node.m_End+1: &quot;</span>
<a name="l00454"></a>00454             + (node.m_End + 1) + <span class="stringliteral">&quot;m_InstList.length-node.m_End+1: &quot;</span>
<a name="l00455"></a>00455             + (<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#aff1654f72eb0eaf64895076126199cbc" title="Indexlist of the instances of this kdtree.">m_InstList</a>.length - node.m_End - 1));
<a name="l00456"></a>00456         <span class="keywordflow">throw</span> ex;
<a name="l00457"></a>00457       }
<a name="l00458"></a>00458       <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#aff1654f72eb0eaf64895076126199cbc" title="Indexlist of the instances of this kdtree.">m_InstList</a> = instList;
<a name="l00459"></a>00459 
<a name="l00460"></a>00460       node.m_End++;
<a name="l00461"></a>00461       node.m_NodeRanges = <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#aef887089a7250b9c5d3f79cfb2755730" title="The euclidean distance function to use.">m_EuclideanDistance</a>.<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1NormalizableDistance.html#af5cc0c85cf75c842c97620ca3fb1dfc6" title="Updates the minimum and maximum and width values for all the attributes based on...">updateRanges</a>(inst,
<a name="l00462"></a>00462           node.m_NodeRanges);
<a name="l00463"></a>00463 
<a name="l00464"></a>00464       <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a84352fc3a7de173b099ffa088ff35902" title="The node splitter.">m_Splitter</a>.<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1kdtrees_1_1KDTreeNodeSplitter.html#a5f1b3f5ff3039e24765d9a63439a40a5" title="Sets the master index array containing indices of the training instances.">setInstanceList</a>(<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#aff1654f72eb0eaf64895076126199cbc" title="Indexlist of the instances of this kdtree.">m_InstList</a>);
<a name="l00465"></a>00465 
<a name="l00466"></a>00466       <span class="comment">// split this leaf node if necessary</span>
<a name="l00467"></a>00467       <span class="keywordtype">double</span>[][] universe = <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#aef887089a7250b9c5d3f79cfb2755730" title="The euclidean distance function to use.">m_EuclideanDistance</a>.<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1NormalizableDistance.html#a696f146c8dfbf0149f2eee8cab6855f6" title="Method to get the ranges.">getRanges</a>();
<a name="l00468"></a>00468       <span class="keywordflow">if</span> (node.numInstances() &gt; <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a166100c63bf7e886033a9a1505c94875" title="maximal number of instances in a leaf.">m_MaxInstInLeaf</a>
<a name="l00469"></a>00469           &amp;&amp; <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a634297dd4f45eccd5d5b06216d2ec2cb" title="Returns the maximum attribute width of instances/points in a KDTreeNode relative...">getMaxRelativeNodeWidth</a>(node.m_NodeRanges, universe) &gt; <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a06957b5efa3ea76050e0e3d86d2127bc" title="minimal relative width of a KDTree rectangle.">m_MinBoxRelWidth</a>) {
<a name="l00470"></a>00470         <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a84352fc3a7de173b099ffa088ff35902" title="The node splitter.">m_Splitter</a>.<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1kdtrees_1_1KDTreeNodeSplitter.html#aaa4e38cc22d39f0fb5ab16c150ffff43" title="Splits a node into two.">splitNode</a>(node, <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#ab5dff8dab9291cd5fccbc9d1bf2cbbc0" title="Tree stats.">m_NumNodes</a>, node.m_NodeRanges, universe);
<a name="l00471"></a>00471         <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#ab5dff8dab9291cd5fccbc9d1bf2cbbc0" title="Tree stats.">m_NumNodes</a> += 2;
<a name="l00472"></a>00472       }
<a name="l00473"></a>00473     }<span class="comment">// end if node is a leaf</span>
<a name="l00474"></a>00474     <span class="keywordflow">else</span> {
<a name="l00475"></a>00475       <span class="keywordflow">if</span> (<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#aef887089a7250b9c5d3f79cfb2755730" title="The euclidean distance function to use.">m_EuclideanDistance</a>.<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1EuclideanDistance.html#a24669e69b32d7edf8c965ccc2358de9c" title="Returns true if the value of the given dimension is smaller or equal the value to...">valueIsSmallerEqual</a>(inst, node.m_SplitDim,
<a name="l00476"></a>00476           node.m_SplitValue)) {
<a name="l00477"></a>00477         <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a6641f4b3339242c2f9a6312c6358496c" title="Recursively adds an instance to the tree starting from the supplied KDTreeNode.">addInstanceToTree</a>(inst, node.m_Left);
<a name="l00478"></a>00478         <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a09d5659823040ed41717027fe389e858" title="Corrects the start and end indices of a KDTreeNode after an instance is added to...">afterAddInstance</a>(node.m_Right);
<a name="l00479"></a>00479       } <span class="keywordflow">else</span>
<a name="l00480"></a>00480         <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a6641f4b3339242c2f9a6312c6358496c" title="Recursively adds an instance to the tree starting from the supplied KDTreeNode.">addInstanceToTree</a>(inst, node.m_Right);
<a name="l00481"></a>00481 
<a name="l00482"></a>00482       node.m_End++;
<a name="l00483"></a>00483       node.m_NodeRanges = <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#aef887089a7250b9c5d3f79cfb2755730" title="The euclidean distance function to use.">m_EuclideanDistance</a>.<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1NormalizableDistance.html#af5cc0c85cf75c842c97620ca3fb1dfc6" title="Updates the minimum and maximum and width values for all the attributes based on...">updateRanges</a>(inst,
<a name="l00484"></a>00484           node.m_NodeRanges);
<a name="l00485"></a>00485     }
<a name="l00486"></a>00486   }
<a name="l00487"></a>00487 
<a name="l00503"></a><a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a09d5659823040ed41717027fe389e858">00503</a>   <span class="keyword">protected</span> <span class="keywordtype">void</span> <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a09d5659823040ed41717027fe389e858" title="Corrects the start and end indices of a KDTreeNode after an instance is added to...">afterAddInstance</a>(<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1kdtrees_1_1KDTreeNode.html" title="A class representing a KDTree node.">KDTreeNode</a> node) {
<a name="l00504"></a>00504     node.<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1kdtrees_1_1KDTreeNode.html#a29a03f5dc063c2d1b1112523e9894fb2" title="The start index of the portion of the master index array, which stores the indices...">m_Start</a>++;
<a name="l00505"></a>00505     node.<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1kdtrees_1_1KDTreeNode.html#a02ba33a02623e4fe8a57a771ae37011f" title="The end index of the portion of the master index array, which stores indices of the...">m_End</a>++;
<a name="l00506"></a>00506     <span class="keywordflow">if</span> (!node.<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1kdtrees_1_1KDTreeNode.html#a5e07bf526c0c726e7bcd04e71dd96a87" title="Checks if node is a leaf.">isALeaf</a>()) {
<a name="l00507"></a>00507       <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a09d5659823040ed41717027fe389e858" title="Corrects the start and end indices of a KDTreeNode after an instance is added to...">afterAddInstance</a>(node.<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1kdtrees_1_1KDTreeNode.html#a7f5fd55018de878ac9321f0964463549" title="left subtree; contains instances with smaller or equal to split value.">m_Left</a>);
<a name="l00508"></a>00508       <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a09d5659823040ed41717027fe389e858" title="Corrects the start and end indices of a KDTreeNode after an instance is added to...">afterAddInstance</a>(node.<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1kdtrees_1_1KDTreeNode.html#a6872ac11dd64caeb3865ba7fed614289" title="right subtree; contains instances with larger than split value.">m_Right</a>);
<a name="l00509"></a>00509     }
<a name="l00510"></a>00510   }
<a name="l00511"></a>00511 
<a name="l00519"></a><a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#ab29174bc96ed7de9cfbc4a6fcc6b3220">00519</a>   <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#ab29174bc96ed7de9cfbc4a6fcc6b3220" title="Adds one instance to KDTree loosly.">addInstanceInfo</a>(Instance instance) {
<a name="l00520"></a>00520     <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#aef887089a7250b9c5d3f79cfb2755730" title="The euclidean distance function to use.">m_EuclideanDistance</a>.<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1NormalizableDistance.html#af5cc0c85cf75c842c97620ca3fb1dfc6" title="Updates the minimum and maximum and width values for all the attributes based on...">updateRanges</a>(instance);
<a name="l00521"></a>00521   }
<a name="l00522"></a>00522 
<a name="l00530"></a><a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a02e9febff8b2afe9501f2ad51e6d7d2b">00530</a>   <span class="keyword">protected</span> <span class="keywordtype">void</span> <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a02e9febff8b2afe9501f2ad51e6d7d2b" title="Checks if there is any instance with missing values.">checkMissing</a>(Instances instances) <span class="keywordflow">throws</span> Exception {
<a name="l00531"></a>00531     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; instances.numInstances(); i++) {
<a name="l00532"></a>00532       Instance ins = instances.instance(i);
<a name="l00533"></a>00533       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; ins.numValues(); j++) {
<a name="l00534"></a>00534         <span class="keywordflow">if</span> (ins.index(j) != ins.classIndex())
<a name="l00535"></a>00535           <span class="keywordflow">if</span> (ins.isMissingSparse(j)) {
<a name="l00536"></a>00536             <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&quot;ERROR: KDTree can not deal with missing &quot;</span>
<a name="l00537"></a>00537                 + <span class="stringliteral">&quot;values. Please run ReplaceMissingValues filter &quot;</span>
<a name="l00538"></a>00538                 + <span class="stringliteral">&quot;on the dataset before passing it on to the KDTree.&quot;</span>);
<a name="l00539"></a>00539           }
<a name="l00540"></a>00540       }
<a name="l00541"></a>00541     }
<a name="l00542"></a>00542   }
<a name="l00543"></a>00543 
<a name="l00551"></a><a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a61f290ac078e35d4fa936e1bcb5d621e">00551</a>   <span class="keyword">protected</span> <span class="keywordtype">void</span> <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a61f290ac078e35d4fa936e1bcb5d621e" title="Checks if there is any missing value in the given instance.">checkMissing</a>(Instance ins) <span class="keywordflow">throws</span> Exception {
<a name="l00552"></a>00552     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; ins.numValues(); j++) {
<a name="l00553"></a>00553       <span class="keywordflow">if</span> (ins.index(j) != ins.classIndex())
<a name="l00554"></a>00554         <span class="keywordflow">if</span> (ins.isMissingSparse(j)) {
<a name="l00555"></a>00555           <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&quot;ERROR: KDTree can not deal with missing &quot;</span>
<a name="l00556"></a>00556               + <span class="stringliteral">&quot;values. Please run ReplaceMissingValues filter &quot;</span>
<a name="l00557"></a>00557               + <span class="stringliteral">&quot;on the dataset before passing it on to the KDTree.&quot;</span>);
<a name="l00558"></a>00558         }
<a name="l00559"></a>00559     }
<a name="l00560"></a>00560   }
<a name="l00561"></a>00561   
<a name="l00574"></a><a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a634297dd4f45eccd5d5b06216d2ec2cb">00574</a>   <span class="keyword">protected</span> <span class="keywordtype">double</span> <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a634297dd4f45eccd5d5b06216d2ec2cb" title="Returns the maximum attribute width of instances/points in a KDTreeNode relative...">getMaxRelativeNodeWidth</a>(<span class="keywordtype">double</span>[][] nodeRanges,
<a name="l00575"></a>00575       <span class="keywordtype">double</span>[][] universe) {
<a name="l00576"></a>00576     <span class="keywordtype">int</span> widest = <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a01f1f902eb2b53e0ac6e3aebf8f4c4b4" title="Returns the widest dimension/attribute in a KDTreeNode (widest after normalizing)...">widestDim</a>(nodeRanges, universe);
<a name="l00577"></a>00577     <span class="keywordflow">if</span>(widest &lt; 0)
<a name="l00578"></a>00578         <span class="keywordflow">return</span> 0.0;
<a name="l00579"></a>00579     <span class="keywordflow">else</span>
<a name="l00580"></a>00580         <span class="keywordflow">return</span> nodeRanges[widest][<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#abb2d568b66a1b9e91b79ecc398b8a061" title="The index of WIDTH (MAX-MIN) value in attributes&amp;#39; range array.">WIDTH</a>] / universe[widest][<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#abb2d568b66a1b9e91b79ecc398b8a061" title="The index of WIDTH (MAX-MIN) value in attributes&amp;#39; range array.">WIDTH</a>];
<a name="l00581"></a>00581   }
<a name="l00582"></a>00582 
<a name="l00594"></a><a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a01f1f902eb2b53e0ac6e3aebf8f4c4b4">00594</a>   <span class="keyword">protected</span> <span class="keywordtype">int</span> <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a01f1f902eb2b53e0ac6e3aebf8f4c4b4" title="Returns the widest dimension/attribute in a KDTreeNode (widest after normalizing)...">widestDim</a>(<span class="keywordtype">double</span>[][] nodeRanges, <span class="keywordtype">double</span>[][] universe) {
<a name="l00595"></a>00595     <span class="keyword">final</span> <span class="keywordtype">int</span> classIdx = <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1NearestNeighbourSearch.html#a4c51e812fad51b3fe3c71d95f54d34a4" title="The neighbourhood of instances to find neighbours in.">m_Instances</a>.classIndex();
<a name="l00596"></a>00596     <span class="keywordtype">double</span> widest = 0.0;
<a name="l00597"></a>00597     <span class="keywordtype">int</span> w = -1;
<a name="l00598"></a>00598     <span class="keywordflow">if</span> (<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#ae996feaa47a38087caa95ba387099c32" title="Properties&amp;#39; variables =====================================================.">m_NormalizeNodeWidth</a>) {
<a name="l00599"></a>00599       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nodeRanges.length; i++) {
<a name="l00600"></a>00600         <span class="keywordtype">double</span> newWidest = nodeRanges[i][<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#abb2d568b66a1b9e91b79ecc398b8a061" title="The index of WIDTH (MAX-MIN) value in attributes&amp;#39; range array.">WIDTH</a>] / universe[i][<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#abb2d568b66a1b9e91b79ecc398b8a061" title="The index of WIDTH (MAX-MIN) value in attributes&amp;#39; range array.">WIDTH</a>];
<a name="l00601"></a>00601         <span class="keywordflow">if</span> (newWidest &gt; widest) {
<a name="l00602"></a>00602           <span class="keywordflow">if</span> (i == classIdx)
<a name="l00603"></a>00603             <span class="keywordflow">continue</span>;
<a name="l00604"></a>00604           widest = newWidest;
<a name="l00605"></a>00605           w = i;
<a name="l00606"></a>00606         }
<a name="l00607"></a>00607       }
<a name="l00608"></a>00608     } <span class="keywordflow">else</span> {
<a name="l00609"></a>00609       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nodeRanges.length; i++) {
<a name="l00610"></a>00610         <span class="keywordflow">if</span> (nodeRanges[i][<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#abb2d568b66a1b9e91b79ecc398b8a061" title="The index of WIDTH (MAX-MIN) value in attributes&amp;#39; range array.">WIDTH</a>] &gt; widest) {
<a name="l00611"></a>00611           <span class="keywordflow">if</span> (i == classIdx)
<a name="l00612"></a>00612             <span class="keywordflow">continue</span>;
<a name="l00613"></a>00613           widest = nodeRanges[i][<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#abb2d568b66a1b9e91b79ecc398b8a061" title="The index of WIDTH (MAX-MIN) value in attributes&amp;#39; range array.">WIDTH</a>];
<a name="l00614"></a>00614           w = i;
<a name="l00615"></a>00615         }
<a name="l00616"></a>00616       }
<a name="l00617"></a>00617     }
<a name="l00618"></a>00618     <span class="keywordflow">return</span> w;
<a name="l00619"></a>00619   }
<a name="l00620"></a>00620 
<a name="l00626"></a><a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a4ef0a0615b1b913226963e80d8fc5234">00626</a>   <span class="keyword">public</span> <span class="keywordtype">double</span> <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a4ef0a0615b1b913226963e80d8fc5234" title="Returns the size of the tree.">measureTreeSize</a>() {
<a name="l00627"></a>00627     <span class="keywordflow">return</span> <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#ab5dff8dab9291cd5fccbc9d1bf2cbbc0" title="Tree stats.">m_NumNodes</a>;
<a name="l00628"></a>00628   }
<a name="l00629"></a>00629 
<a name="l00635"></a><a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#acbeb5088e186ea3f8f6a325375c58972">00635</a>   <span class="keyword">public</span> <span class="keywordtype">double</span> <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#acbeb5088e186ea3f8f6a325375c58972" title="Returns the number of leaves.">measureNumLeaves</a>() {
<a name="l00636"></a>00636     <span class="keywordflow">return</span> <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a79e084f56f8b95b05aab351207f7f212">m_NumLeaves</a>;
<a name="l00637"></a>00637   }
<a name="l00638"></a>00638 
<a name="l00644"></a><a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a4e9ad90bfcd256d4ffbd3620cf022a46">00644</a>   <span class="keyword">public</span> <span class="keywordtype">double</span> <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a4e9ad90bfcd256d4ffbd3620cf022a46" title="Returns the depth of the tree.">measureMaxDepth</a>() {
<a name="l00645"></a>00645     <span class="keywordflow">return</span> <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#ab5f60fee51561b0854f3dcb2ab324272">m_MaxDepth</a>;
<a name="l00646"></a>00646   }
<a name="l00647"></a>00647 
<a name="l00653"></a><a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a02e0069431982a5219a13997f5303682">00653</a>   <span class="keyword">public</span> Enumeration <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a02e0069431982a5219a13997f5303682" title="Returns an enumeration of the additional measure names.">enumerateMeasures</a>() {
<a name="l00654"></a>00654     Vector&lt;String&gt; newVector = <span class="keyword">new</span> Vector&lt;String&gt;();
<a name="l00655"></a>00655     newVector.addElement(<span class="stringliteral">&quot;measureTreeSize&quot;</span>);
<a name="l00656"></a>00656     newVector.addElement(<span class="stringliteral">&quot;measureNumLeaves&quot;</span>);
<a name="l00657"></a>00657     newVector.addElement(<span class="stringliteral">&quot;measureMaxDepth&quot;</span>);
<a name="l00658"></a>00658     <span class="keywordflow">return</span> newVector.elements();
<a name="l00659"></a>00659   }
<a name="l00660"></a>00660 
<a name="l00670"></a><a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#ab61070158951d7c24d79aeacedf93d58">00670</a>   <span class="keyword">public</span> <span class="keywordtype">double</span> <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#ab61070158951d7c24d79aeacedf93d58" title="Returns the value of the named measure.">getMeasure</a>(String additionalMeasureName) {
<a name="l00671"></a>00671     <span class="keywordflow">if</span> (additionalMeasureName.compareToIgnoreCase(<span class="stringliteral">&quot;measureMaxDepth&quot;</span>) == 0) {
<a name="l00672"></a>00672       <span class="keywordflow">return</span> <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a4e9ad90bfcd256d4ffbd3620cf022a46" title="Returns the depth of the tree.">measureMaxDepth</a>();
<a name="l00673"></a>00673     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (additionalMeasureName.compareToIgnoreCase(<span class="stringliteral">&quot;measureTreeSize&quot;</span>) == 0) {
<a name="l00674"></a>00674       <span class="keywordflow">return</span> <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a4ef0a0615b1b913226963e80d8fc5234" title="Returns the size of the tree.">measureTreeSize</a>();
<a name="l00675"></a>00675     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (additionalMeasureName.compareToIgnoreCase(<span class="stringliteral">&quot;measureNumLeaves&quot;</span>) == 0) {
<a name="l00676"></a>00676       <span class="keywordflow">return</span> <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#acbeb5088e186ea3f8f6a325375c58972" title="Returns the number of leaves.">measureNumLeaves</a>();
<a name="l00677"></a>00677     }  <span class="keywordflow">else</span> {
<a name="l00678"></a>00678       <span class="keywordflow">throw</span> <span class="keyword">new</span> IllegalArgumentException(additionalMeasureName
<a name="l00679"></a>00679           + <span class="stringliteral">&quot; not supported (KDTree)&quot;</span>);
<a name="l00680"></a>00680     }
<a name="l00681"></a>00681   }
<a name="l00682"></a>00682 
<a name="l00688"></a><a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a570d5dd2d970107c2efc59d8144662fc">00688</a>   <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a570d5dd2d970107c2efc59d8144662fc" title="Sets whether to calculate the performance statistics or not.">setMeasurePerformance</a>(<span class="keywordtype">boolean</span> measurePerformance) {
<a name="l00689"></a>00689     <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1NearestNeighbourSearch.html#a937014d32cb706d1b4020d46f692ea81" title="Should we measure Performance.">m_MeasurePerformance</a> = measurePerformance;
<a name="l00690"></a>00690   }
<a name="l00691"></a>00691 
<a name="l00701"></a><a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#ac00fa079e9081c363b22cac250f2df24">00701</a>   <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#ac00fa079e9081c363b22cac250f2df24" title="Assigns instances to centers using KDTree.">centerInstances</a>(Instances centers, <span class="keywordtype">int</span>[] assignments, <span class="keywordtype">double</span> pc)
<a name="l00702"></a>00702       <span class="keywordflow">throws</span> Exception {
<a name="l00703"></a>00703 
<a name="l00704"></a>00704     <span class="keywordtype">int</span>[] centList = <span class="keyword">new</span> <span class="keywordtype">int</span>[centers.numInstances()];
<a name="l00705"></a>00705     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; centers.numInstances(); i++)
<a name="l00706"></a>00706       centList[i] = i;
<a name="l00707"></a>00707 
<a name="l00708"></a>00708     <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a202d8bd87aa9c3891f5e2d372537a035" title="Assigns instances to the current centers called candidates.">determineAssignments</a>(<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a921f2c9e744d5f24d22db68810daa04c" title="The root node of the tree.">m_Root</a>, centers, centList, assignments, pc);
<a name="l00709"></a>00709   }
<a name="l00710"></a>00710 
<a name="l00722"></a><a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a202d8bd87aa9c3891f5e2d372537a035">00722</a>   <span class="keyword">protected</span> <span class="keywordtype">void</span> <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a202d8bd87aa9c3891f5e2d372537a035" title="Assigns instances to the current centers called candidates.">determineAssignments</a>(<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1kdtrees_1_1KDTreeNode.html" title="A class representing a KDTree node.">KDTreeNode</a> node, Instances centers,
<a name="l00723"></a>00723       <span class="keywordtype">int</span>[] candidates, <span class="keywordtype">int</span>[] assignments, <span class="keywordtype">double</span> pc) <span class="keywordflow">throws</span> Exception {
<a name="l00724"></a>00724 
<a name="l00725"></a>00725     <span class="comment">// reduce number of owners for current hyper rectangle</span>
<a name="l00726"></a>00726     <span class="keywordtype">int</span>[] owners = <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a159cfbded0e10abe08fdf075f36d3429" title="Refines the ownerlist.">refineOwners</a>(node, centers, candidates);
<a name="l00727"></a>00727 
<a name="l00728"></a>00728     <span class="comment">// only one owner</span>
<a name="l00729"></a>00729     <span class="keywordflow">if</span> (owners.length == 1) {
<a name="l00730"></a>00730       <span class="comment">// all instances of this node are owned by one center</span>
<a name="l00731"></a>00731       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = node.m_Start; i &lt;= node.m_End; i++) {
<a name="l00732"></a>00732         assignments[<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#aff1654f72eb0eaf64895076126199cbc" title="Indexlist of the instances of this kdtree.">m_InstList</a>[i]] <span class="comment">// the assignment of this instance</span>
<a name="l00733"></a>00733         = owners[0]; <span class="comment">// is the current owner</span>
<a name="l00734"></a>00734       }
<a name="l00735"></a>00735     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!node.isALeaf()) {
<a name="l00736"></a>00736       <span class="comment">// more than one owner and it is not a leaf</span>
<a name="l00737"></a>00737       <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a202d8bd87aa9c3891f5e2d372537a035" title="Assigns instances to the current centers called candidates.">determineAssignments</a>(node.m_Left, centers, owners, assignments, pc);
<a name="l00738"></a>00738       <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a202d8bd87aa9c3891f5e2d372537a035" title="Assigns instances to the current centers called candidates.">determineAssignments</a>(node.m_Right, centers, owners, assignments, pc);
<a name="l00739"></a>00739     } <span class="keywordflow">else</span> {
<a name="l00740"></a>00740       <span class="comment">// this is a leaf and there are more than 1 owner</span>
<a name="l00741"></a>00741       <span class="comment">// XMeans.</span>
<a name="l00742"></a>00742       <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#abb16f0a6f53c19d87b113236a033937e" title="Assigns instances of this node to center.">assignSubToCenters</a>(node, centers, owners, assignments);
<a name="l00743"></a>00743     }
<a name="l00744"></a>00744   }
<a name="l00745"></a>00745 
<a name="l00755"></a><a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a159cfbded0e10abe08fdf075f36d3429">00755</a>   <span class="keyword">protected</span> <span class="keywordtype">int</span>[] <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a159cfbded0e10abe08fdf075f36d3429" title="Refines the ownerlist.">refineOwners</a>(<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1kdtrees_1_1KDTreeNode.html" title="A class representing a KDTree node.">KDTreeNode</a> node, Instances centers,
<a name="l00756"></a>00756       <span class="keywordtype">int</span>[] candidates) <span class="keywordflow">throws</span> Exception {
<a name="l00757"></a>00757 
<a name="l00758"></a>00758     <span class="keywordtype">int</span>[] owners = <span class="keyword">new</span> <span class="keywordtype">int</span>[candidates.length];
<a name="l00759"></a>00759     <span class="keywordtype">double</span> minDistance = Double.POSITIVE_INFINITY;
<a name="l00760"></a>00760     <span class="keywordtype">int</span> ownerIndex = -1;
<a name="l00761"></a>00761     Instance owner;
<a name="l00762"></a>00762     <span class="keywordtype">int</span> numCand = candidates.length;
<a name="l00763"></a>00763     <span class="keywordtype">double</span>[] distance = <span class="keyword">new</span> <span class="keywordtype">double</span>[numCand];
<a name="l00764"></a>00764     <span class="keywordtype">boolean</span>[] inside = <span class="keyword">new</span> <span class="keywordtype">boolean</span>[numCand];
<a name="l00765"></a>00765     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; numCand; i++) {
<a name="l00766"></a>00766       distance[i] = <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#aa7ffdc8c19de967006ae2ed4022f4f3d" title="Returns the distance between a point and an hyperrectangle.">distanceToHrect</a>(node, centers.instance(candidates[i]));
<a name="l00767"></a>00767       inside[i] = (distance[i] == 0.0);
<a name="l00768"></a>00768       <span class="keywordflow">if</span> (distance[i] &lt; minDistance) {
<a name="l00769"></a>00769         minDistance = distance[i];
<a name="l00770"></a>00770         ownerIndex = i;
<a name="l00771"></a>00771       }
<a name="l00772"></a>00772     }
<a name="l00773"></a>00773     owner = (Instance)centers.instance(candidates[ownerIndex]).copy();
<a name="l00774"></a>00774 
<a name="l00775"></a>00775     <span class="comment">// are there other owners</span>
<a name="l00776"></a>00776     <span class="comment">// loop also goes over already found owner, keeps order</span>
<a name="l00777"></a>00777     <span class="comment">// in owner list</span>
<a name="l00778"></a>00778     <span class="keywordtype">int</span> index = 0;
<a name="l00779"></a>00779     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; numCand; i++) {
<a name="l00780"></a>00780       <span class="comment">// 1. all centers that are points within rectangle are owners</span>
<a name="l00781"></a>00781       <span class="keywordflow">if</span> ((inside[i])
<a name="l00782"></a>00782 
<a name="l00783"></a>00783       <span class="comment">// 2. take all points with same distance to the rect. as the owner</span>
<a name="l00784"></a>00784           || (distance[i] == distance[ownerIndex])) {
<a name="l00785"></a>00785 
<a name="l00786"></a>00786         <span class="comment">// add competitor to owners list</span>
<a name="l00787"></a>00787         owners[index++] = candidates[i];
<a name="l00788"></a>00788       } <span class="keywordflow">else</span> {
<a name="l00789"></a>00789 
<a name="l00790"></a>00790         Instance competitor = (Instance)centers.instance(candidates[i]).copy();
<a name="l00791"></a>00791         <span class="keywordflow">if</span>
<a name="l00792"></a>00792 
<a name="l00793"></a>00793         <span class="comment">// 3. point has larger distance to rectangle but still can compete</span>
<a name="l00794"></a>00794         <span class="comment">// with owner for some points in the rectangle</span>
<a name="l00795"></a>00795         (!<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#abbc9653616653df5e2e22b3b29416da5" title="Returns true if candidate is a full owner in respect to a competitor.">candidateIsFullOwner</a>(node, owner, competitor))
<a name="l00796"></a>00796 
<a name="l00797"></a>00797         {
<a name="l00798"></a>00798           <span class="comment">// also add competitor to owners list</span>
<a name="l00799"></a>00799           owners[index++] = candidates[i];
<a name="l00800"></a>00800         }
<a name="l00801"></a>00801       }
<a name="l00802"></a>00802     }
<a name="l00803"></a>00803     <span class="keywordtype">int</span>[] result = <span class="keyword">new</span> <span class="keywordtype">int</span>[index];
<a name="l00804"></a>00804     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; index; i++)
<a name="l00805"></a>00805       result[i] = owners[i];
<a name="l00806"></a>00806     <span class="keywordflow">return</span> result;
<a name="l00807"></a>00807   }
<a name="l00808"></a>00808 
<a name="l00819"></a><a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#aa7ffdc8c19de967006ae2ed4022f4f3d">00819</a>   <span class="keyword">protected</span> <span class="keywordtype">double</span> <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#aa7ffdc8c19de967006ae2ed4022f4f3d" title="Returns the distance between a point and an hyperrectangle.">distanceToHrect</a>(<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1kdtrees_1_1KDTreeNode.html" title="A class representing a KDTree node.">KDTreeNode</a> node, Instance x) <span class="keywordflow">throws</span> Exception {
<a name="l00820"></a>00820     <span class="keywordtype">double</span> distance = 0.0;
<a name="l00821"></a>00821 
<a name="l00822"></a>00822     Instance closestPoint = (Instance)x.copy();
<a name="l00823"></a>00823     <span class="keywordtype">boolean</span> inside;
<a name="l00824"></a>00824     inside = <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a8ce38fe7d1eb59f6be411b6fb6df7f40" title="Finds the closest point in the hyper rectangle to a given point.">clipToInsideHrect</a>(node, closestPoint);
<a name="l00825"></a>00825     <span class="keywordflow">if</span> (!inside)
<a name="l00826"></a>00826       distance = <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#aef887089a7250b9c5d3f79cfb2755730" title="The euclidean distance function to use.">m_EuclideanDistance</a>.<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1EuclideanDistance.html#ad2ccd44d1a04e5e705396bf3746cb020" title="Calculates the distance between two instances.">distance</a>(closestPoint, x);
<a name="l00827"></a>00827     <span class="keywordflow">return</span> distance;
<a name="l00828"></a>00828   }
<a name="l00829"></a>00829 
<a name="l00842"></a><a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a8ce38fe7d1eb59f6be411b6fb6df7f40">00842</a>   <span class="keyword">protected</span> <span class="keywordtype">boolean</span> <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a8ce38fe7d1eb59f6be411b6fb6df7f40" title="Finds the closest point in the hyper rectangle to a given point.">clipToInsideHrect</a>(<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1kdtrees_1_1KDTreeNode.html" title="A class representing a KDTree node.">KDTreeNode</a> node, Instance x) {
<a name="l00843"></a>00843     <span class="keywordtype">boolean</span> inside = <span class="keyword">true</span>;
<a name="l00844"></a>00844     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1NearestNeighbourSearch.html#a4c51e812fad51b3fe3c71d95f54d34a4" title="The neighbourhood of instances to find neighbours in.">m_Instances</a>.numAttributes(); i++) {
<a name="l00845"></a>00845       <span class="comment">// TODO treat nominals differently!??</span>
<a name="l00846"></a>00846 
<a name="l00847"></a>00847       <span class="keywordflow">if</span> (x.value(i) &lt; node.<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1kdtrees_1_1KDTreeNode.html#a2ecbd2a4b61939b297dbbdf0f956f52f" title="lowest and highest value and width (= high - low) for each dimension.">m_NodeRanges</a>[i][<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#af460f25ea4d5dcc189b16fb48c7c34a7" title="The index of MIN value in attributes&amp;#39; range array.">MIN</a>]) {
<a name="l00848"></a>00848         x.setValue(i, node.<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1kdtrees_1_1KDTreeNode.html#a2ecbd2a4b61939b297dbbdf0f956f52f" title="lowest and highest value and width (= high - low) for each dimension.">m_NodeRanges</a>[i][<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#af460f25ea4d5dcc189b16fb48c7c34a7" title="The index of MIN value in attributes&amp;#39; range array.">MIN</a>]);
<a name="l00849"></a>00849         inside = <span class="keyword">false</span>;
<a name="l00850"></a>00850       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (x.value(i) &gt; node.<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1kdtrees_1_1KDTreeNode.html#a2ecbd2a4b61939b297dbbdf0f956f52f" title="lowest and highest value and width (= high - low) for each dimension.">m_NodeRanges</a>[i][<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#ad99f94f4ba1a22f7753047b2bce12c80" title="The index of MAX value in attributes&amp;#39; range array.">MAX</a>]) {
<a name="l00851"></a>00851         x.setValue(i, node.<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1kdtrees_1_1KDTreeNode.html#a2ecbd2a4b61939b297dbbdf0f956f52f" title="lowest and highest value and width (= high - low) for each dimension.">m_NodeRanges</a>[i][<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#ad99f94f4ba1a22f7753047b2bce12c80" title="The index of MAX value in attributes&amp;#39; range array.">MAX</a>]);
<a name="l00852"></a>00852         inside = <span class="keyword">false</span>;
<a name="l00853"></a>00853       }
<a name="l00854"></a>00854     }
<a name="l00855"></a>00855     <span class="keywordflow">return</span> inside;
<a name="l00856"></a>00856   }
<a name="l00857"></a>00857 
<a name="l00883"></a><a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#abbc9653616653df5e2e22b3b29416da5">00883</a>   <span class="keyword">protected</span> <span class="keywordtype">boolean</span> <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#abbc9653616653df5e2e22b3b29416da5" title="Returns true if candidate is a full owner in respect to a competitor.">candidateIsFullOwner</a>(<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1kdtrees_1_1KDTreeNode.html" title="A class representing a KDTree node.">KDTreeNode</a> node, Instance candidate,
<a name="l00884"></a>00884       Instance competitor) <span class="keywordflow">throws</span> Exception {
<a name="l00885"></a>00885     <span class="comment">// get extreme point</span>
<a name="l00886"></a>00886     Instance extreme = (Instance)candidate.copy();
<a name="l00887"></a>00887     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1NearestNeighbourSearch.html#a4c51e812fad51b3fe3c71d95f54d34a4" title="The neighbourhood of instances to find neighbours in.">m_Instances</a>.numAttributes(); i++) {
<a name="l00888"></a>00888       <span class="keywordflow">if</span> ((competitor.value(i) - candidate.value(i)) &gt; 0) {
<a name="l00889"></a>00889         extreme.setValue(i, node.m_NodeRanges[i][<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#ad99f94f4ba1a22f7753047b2bce12c80" title="The index of MAX value in attributes&amp;#39; range array.">MAX</a>]);
<a name="l00890"></a>00890       } <span class="keywordflow">else</span> {
<a name="l00891"></a>00891         extreme.setValue(i, node.m_NodeRanges[i][<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#af460f25ea4d5dcc189b16fb48c7c34a7" title="The index of MIN value in attributes&amp;#39; range array.">MIN</a>]);
<a name="l00892"></a>00892       }
<a name="l00893"></a>00893     }
<a name="l00894"></a>00894     <span class="keywordtype">boolean</span> isFullOwner = <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#aef887089a7250b9c5d3f79cfb2755730" title="The euclidean distance function to use.">m_EuclideanDistance</a>.<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1EuclideanDistance.html#ad2ccd44d1a04e5e705396bf3746cb020" title="Calculates the distance between two instances.">distance</a>(extreme, candidate) &lt; <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#aef887089a7250b9c5d3f79cfb2755730" title="The euclidean distance function to use.">m_EuclideanDistance</a>
<a name="l00895"></a>00895         .<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1EuclideanDistance.html#ad2ccd44d1a04e5e705396bf3746cb020" title="Calculates the distance between two instances.">distance</a>(extreme, competitor);
<a name="l00896"></a>00896 
<a name="l00897"></a>00897     <span class="keywordflow">return</span> isFullOwner;
<a name="l00898"></a>00898   }
<a name="l00899"></a>00899 
<a name="l00910"></a><a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#abb16f0a6f53c19d87b113236a033937e">00910</a>   <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#abb16f0a6f53c19d87b113236a033937e" title="Assigns instances of this node to center.">assignSubToCenters</a>(<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1kdtrees_1_1KDTreeNode.html" title="A class representing a KDTree node.">KDTreeNode</a> node, Instances centers,
<a name="l00911"></a>00911       <span class="keywordtype">int</span>[] centList, <span class="keywordtype">int</span>[] assignments) <span class="keywordflow">throws</span> Exception {
<a name="l00912"></a>00912     <span class="comment">// todo: undecided situations</span>
<a name="l00913"></a>00913     <span class="keywordtype">int</span> numCent = centList.length;
<a name="l00914"></a>00914 
<a name="l00915"></a>00915     <span class="comment">// WARNING: assignments is &quot;input/output-parameter&quot;</span>
<a name="l00916"></a>00916     <span class="comment">// should not be null and the following should not happen</span>
<a name="l00917"></a>00917     <span class="keywordflow">if</span> (assignments == null) {
<a name="l00918"></a>00918       assignments = <span class="keyword">new</span> <span class="keywordtype">int</span>[<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1NearestNeighbourSearch.html#a4c51e812fad51b3fe3c71d95f54d34a4" title="The neighbourhood of instances to find neighbours in.">m_Instances</a>.numInstances()];
<a name="l00919"></a>00919       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; assignments.length; i++) {
<a name="l00920"></a>00920         assignments[i] = -1;
<a name="l00921"></a>00921       }
<a name="l00922"></a>00922     }
<a name="l00923"></a>00923 
<a name="l00924"></a>00924     <span class="comment">// set assignments for all instances of this node</span>
<a name="l00925"></a>00925     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = node.m_Start; i &lt;= node.m_End; i++) {
<a name="l00926"></a>00926       <span class="keywordtype">int</span> instIndex = <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#aff1654f72eb0eaf64895076126199cbc" title="Indexlist of the instances of this kdtree.">m_InstList</a>[i];
<a name="l00927"></a>00927       Instance inst = <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1NearestNeighbourSearch.html#a4c51e812fad51b3fe3c71d95f54d34a4" title="The neighbourhood of instances to find neighbours in.">m_Instances</a>.instance(instIndex);
<a name="l00928"></a>00928       <span class="comment">// if (instList[i] == 664) System.out.println(&quot;664***&quot;);</span>
<a name="l00929"></a>00929       <span class="keywordtype">int</span> newC = <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#aef887089a7250b9c5d3f79cfb2755730" title="The euclidean distance function to use.">m_EuclideanDistance</a>.<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1EuclideanDistance.html#a7e628744c88c0cae17b32eae109f03c9" title="Returns the index of the closest point to the current instance.">closestPoint</a>(inst, centers, centList);
<a name="l00930"></a>00930       <span class="comment">// int newC = clusterProcessedInstance(inst, centers);</span>
<a name="l00931"></a>00931       assignments[instIndex] = newC;
<a name="l00932"></a>00932     }
<a name="l00933"></a>00933   }
<a name="l00934"></a>00934 
<a name="l00940"></a><a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#ae996feaa47a38087caa95ba387099c32">00940</a>   <span class="keywordtype">boolean</span> <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#ae996feaa47a38087caa95ba387099c32" title="Properties&amp;#39; variables =====================================================.">m_NormalizeNodeWidth</a> = <span class="keyword">true</span>;
<a name="l00941"></a>00941 
<a name="l00943"></a><a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#aef887089a7250b9c5d3f79cfb2755730">00943</a>   <span class="keyword">protected</span> <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1EuclideanDistance.html" title="Implementing Euclidean distance (or similarity) function.">EuclideanDistance</a> <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#aef887089a7250b9c5d3f79cfb2755730" title="The euclidean distance function to use.">m_EuclideanDistance</a>;
<a name="l00944"></a>00944   { <span class="comment">// to make sure we have only one object of EuclideanDistance</span>
<a name="l00945"></a>00945     <span class="keywordflow">if</span> (<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1NearestNeighbourSearch.html#a2dac7a5d55e15226b854449c9804d274" title="the distance function used.">m_DistanceFunction</a> instanceof <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1EuclideanDistance.html" title="Implementing Euclidean distance (or similarity) function.">EuclideanDistance</a>)
<a name="l00946"></a>00946       <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#aef887089a7250b9c5d3f79cfb2755730" title="The euclidean distance function to use.">m_EuclideanDistance</a> = (EuclideanDistance) <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1NearestNeighbourSearch.html#a2dac7a5d55e15226b854449c9804d274" title="the distance function used.">m_DistanceFunction</a>;
<a name="l00947"></a>00947     <span class="keywordflow">else</span>
<a name="l00948"></a>00948       <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1NearestNeighbourSearch.html#a2dac7a5d55e15226b854449c9804d274" title="the distance function used.">m_DistanceFunction</a> = <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#aef887089a7250b9c5d3f79cfb2755730" title="The euclidean distance function to use.">m_EuclideanDistance</a> = <span class="keyword">new</span> EuclideanDistance();
<a name="l00949"></a>00949   }
<a name="l00950"></a>00950 
<a name="l00952"></a><a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a06957b5efa3ea76050e0e3d86d2127bc">00952</a>   <span class="keyword">protected</span> <span class="keywordtype">double</span> <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a06957b5efa3ea76050e0e3d86d2127bc" title="minimal relative width of a KDTree rectangle.">m_MinBoxRelWidth</a> = 1.0E-2;
<a name="l00953"></a>00953 
<a name="l00955"></a><a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a166100c63bf7e886033a9a1505c94875">00955</a>   <span class="keyword">protected</span> <span class="keywordtype">int</span> <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a166100c63bf7e886033a9a1505c94875" title="maximal number of instances in a leaf.">m_MaxInstInLeaf</a> = 40;
<a name="l00956"></a>00956 
<a name="l00966"></a><a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a2abce607a9cb1a13239d209dee917f8a">00966</a>   <span class="keyword">public</span> String <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a2abce607a9cb1a13239d209dee917f8a" title="the GET and SET - functions ===============================================">minBoxRelWidthTipText</a>() {
<a name="l00967"></a>00967     <span class="keywordflow">return</span> <span class="stringliteral">&quot;The minimum relative width of the box. A node is only made a leaf &quot;</span>
<a name="l00968"></a>00968         + <span class="stringliteral">&quot;if the width of the split dimension of the instances in a node &quot;</span>
<a name="l00969"></a>00969         + <span class="stringliteral">&quot;normalized over the width of the split dimension of all the &quot;</span>
<a name="l00970"></a>00970         + <span class="stringliteral">&quot;instances is less than or equal to this minimum relative width.&quot;</span>;
<a name="l00971"></a>00971   }
<a name="l00972"></a>00972 
<a name="l00978"></a><a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a368200f16b6054e926913e66873bf093">00978</a>   <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a368200f16b6054e926913e66873bf093" title="Sets the minimum relative box width.">setMinBoxRelWidth</a>(<span class="keywordtype">double</span> i) {
<a name="l00979"></a>00979     <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a06957b5efa3ea76050e0e3d86d2127bc" title="minimal relative width of a KDTree rectangle.">m_MinBoxRelWidth</a> = i;
<a name="l00980"></a>00980   }
<a name="l00981"></a>00981 
<a name="l00987"></a><a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a7e75f4779e50d0d57f8b9dc353a2459f">00987</a>   <span class="keyword">public</span> <span class="keywordtype">double</span> <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a7e75f4779e50d0d57f8b9dc353a2459f" title="Gets the minimum relative box width.">getMinBoxRelWidth</a>() {
<a name="l00988"></a>00988     <span class="keywordflow">return</span> <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a06957b5efa3ea76050e0e3d86d2127bc" title="minimal relative width of a KDTree rectangle.">m_MinBoxRelWidth</a>;
<a name="l00989"></a>00989   }
<a name="l00990"></a>00990 
<a name="l00996"></a><a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a87685a479f3395f6e2676821e93fdd21">00996</a>   <span class="keyword">public</span> String <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a87685a479f3395f6e2676821e93fdd21" title="Tip text for this property.">maxInstInLeafTipText</a>() {
<a name="l00997"></a>00997     <span class="keywordflow">return</span> <span class="stringliteral">&quot;The max number of instances in a leaf.&quot;</span>;
<a name="l00998"></a>00998   }
<a name="l00999"></a>00999 
<a name="l01005"></a><a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#abde3f885c26a374bc739fea7c88bea6f">01005</a>   <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#abde3f885c26a374bc739fea7c88bea6f" title="Sets the maximum number of instances in a leaf.">setMaxInstInLeaf</a>(<span class="keywordtype">int</span> i) {
<a name="l01006"></a>01006     <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a166100c63bf7e886033a9a1505c94875" title="maximal number of instances in a leaf.">m_MaxInstInLeaf</a> = i;
<a name="l01007"></a>01007   }
<a name="l01008"></a>01008 
<a name="l01014"></a><a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#ad5de782aba81917625a066928ed4b821">01014</a>   <span class="keyword">public</span> <span class="keywordtype">int</span> <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#ad5de782aba81917625a066928ed4b821" title="Get the maximum number of instances in a leaf.">getMaxInstInLeaf</a>() {
<a name="l01015"></a>01015     <span class="keywordflow">return</span> <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a166100c63bf7e886033a9a1505c94875" title="maximal number of instances in a leaf.">m_MaxInstInLeaf</a>;
<a name="l01016"></a>01016   }
<a name="l01017"></a>01017 
<a name="l01023"></a><a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a6716cc6a50ebdb2c60b8a21645376f73">01023</a>   <span class="keyword">public</span> String <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a6716cc6a50ebdb2c60b8a21645376f73" title="Tip text for this property.">normalizeNodeWidthTipText</a>() {
<a name="l01024"></a>01024     <span class="keywordflow">return</span> <span class="stringliteral">&quot;Whether if the widths of the KDTree node should be normalized &quot;</span>
<a name="l01025"></a>01025         + <span class="stringliteral">&quot;by the width of the universe or not. &quot;</span>
<a name="l01026"></a>01026         + <span class="stringliteral">&quot;Where, width of the node is the range of the split attribute &quot;</span>
<a name="l01027"></a>01027         + <span class="stringliteral">&quot;based on the instances in that node, and width of the &quot;</span>
<a name="l01028"></a>01028         + <span class="stringliteral">&quot;universe is the range of the split attribute based on all the &quot;</span>
<a name="l01029"></a>01029         + <span class="stringliteral">&quot;instances (default: false).&quot;</span>;
<a name="l01030"></a>01030   }
<a name="l01031"></a>01031 
<a name="l01038"></a><a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a5591722e4913f18f55f7b752cb2cccf4">01038</a>   <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a5591722e4913f18f55f7b752cb2cccf4" title="Sets the flag for normalizing the widths of a KDTree Node by the width of the dimension...">setNormalizeNodeWidth</a>(<span class="keywordtype">boolean</span> n) {
<a name="l01039"></a>01039     <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#ae996feaa47a38087caa95ba387099c32" title="Properties&amp;#39; variables =====================================================.">m_NormalizeNodeWidth</a> = n;
<a name="l01040"></a>01040   }
<a name="l01041"></a>01041 
<a name="l01047"></a><a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a759ccf44ae761ddf061be59dbbe35540">01047</a>   <span class="keyword">public</span> <span class="keywordtype">boolean</span> <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a759ccf44ae761ddf061be59dbbe35540" title="Gets the normalize flag.">getNormalizeNodeWidth</a>() {
<a name="l01048"></a>01048     <span class="keywordflow">return</span> <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#ae996feaa47a38087caa95ba387099c32" title="Properties&amp;#39; variables =====================================================.">m_NormalizeNodeWidth</a>;
<a name="l01049"></a>01049   }
<a name="l01050"></a>01050 
<a name="l01056"></a><a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a756fadd44af3ee02d7101318f93518ab">01056</a>   <span class="keyword">public</span> <a class="code" href="interfacemoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1DistanceFunction.html" title="Interface for any class that can compute and return distances between two instances...">DistanceFunction</a> <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a756fadd44af3ee02d7101318f93518ab" title="returns the distance function currently in use.">getDistanceFunction</a>() {
<a name="l01057"></a>01057     <span class="keywordflow">return</span> (<a class="code" href="interfacemoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1DistanceFunction.html" title="Interface for any class that can compute and return distances between two instances...">DistanceFunction</a>) <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#aef887089a7250b9c5d3f79cfb2755730" title="The euclidean distance function to use.">m_EuclideanDistance</a>;
<a name="l01058"></a>01058   }
<a name="l01059"></a>01059 
<a name="l01066"></a><a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a209c14fb56dfcdbdfe5076cdac2132c9">01066</a>   <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a209c14fb56dfcdbdfe5076cdac2132c9" title="sets the distance function to use for nearest neighbour search.">setDistanceFunction</a>(<a class="code" href="interfacemoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1DistanceFunction.html" title="Interface for any class that can compute and return distances between two instances...">DistanceFunction</a> df) <span class="keywordflow">throws</span> Exception {
<a name="l01067"></a>01067     <span class="keywordflow">if</span> (!(df instanceof <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1EuclideanDistance.html" title="Implementing Euclidean distance (or similarity) function.">EuclideanDistance</a>))
<a name="l01068"></a>01068       <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&quot;KDTree currently only works with &quot;</span>
<a name="l01069"></a>01069           + <span class="stringliteral">&quot;EuclideanDistanceFunction.&quot;</span>);
<a name="l01070"></a>01070     <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1NearestNeighbourSearch.html#a2dac7a5d55e15226b854449c9804d274" title="the distance function used.">m_DistanceFunction</a> = <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#aef887089a7250b9c5d3f79cfb2755730" title="The euclidean distance function to use.">m_EuclideanDistance</a> = (EuclideanDistance) df;
<a name="l01071"></a>01071   }
<a name="l01072"></a>01072   
<a name="l01079"></a><a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#aa1b565068cdb06672609d7ab8d486da8">01079</a>   <span class="keyword">public</span> String <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#aa1b565068cdb06672609d7ab8d486da8" title="Returns the tip text for this property.">nodeSplitterTipText</a>() {
<a name="l01080"></a>01080     <span class="keywordflow">return</span> <span class="stringliteral">&quot;The the splitting method to split the nodes of the KDTree.&quot;</span>;
<a name="l01081"></a>01081   }
<a name="l01082"></a>01082 
<a name="l01089"></a><a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a42c55c6a598814a90f17bead0d0b17be">01089</a>   <span class="keyword">public</span> <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1kdtrees_1_1KDTreeNodeSplitter.html" title="Class that splits up a KDTreeNode.">KDTreeNodeSplitter</a> <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a42c55c6a598814a90f17bead0d0b17be" title="Returns the splitting method currently in use to split the nodes of the KDTree.">getNodeSplitter</a>() {
<a name="l01090"></a>01090     <span class="keywordflow">return</span> <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a84352fc3a7de173b099ffa088ff35902" title="The node splitter.">m_Splitter</a>;
<a name="l01091"></a>01091   }
<a name="l01092"></a>01092 
<a name="l01098"></a><a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a989e1263b5e5582ead42307eddd345a3">01098</a>   <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a989e1263b5e5582ead42307eddd345a3" title="Sets the splitting method to use to split the nodes of the KDTree.">setNodeSplitter</a>(<a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1kdtrees_1_1KDTreeNodeSplitter.html" title="Class that splits up a KDTreeNode.">KDTreeNodeSplitter</a> splitter) {
<a name="l01099"></a>01099     <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#a84352fc3a7de173b099ffa088ff35902" title="The node splitter.">m_Splitter</a> = splitter;
<a name="l01100"></a>01100   }
<a name="l01101"></a>01101 
<a name="l01108"></a><a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#aeee77a11cff6cdb5d9035d564a7f1935">01108</a>   <span class="keyword">public</span> String <a class="code" href="classmoa_1_1classifiers_1_1lazy_1_1neighboursearch_1_1KDTree.html#aeee77a11cff6cdb5d9035d564a7f1935" title="Returns a string describing this nearest neighbour search algorithm.">globalInfo</a>() {
<a name="l01109"></a>01109     <span class="keywordflow">return</span> 
<a name="l01110"></a>01110         <span class="stringliteral">&quot;Class implementing the KDTree search algorithm for nearest &quot;</span>
<a name="l01111"></a>01111       + <span class="stringliteral">&quot;neighbour search.\n&quot;</span>
<a name="l01112"></a>01112       + <span class="stringliteral">&quot;The connection to dataset is only a reference. For the tree &quot;</span>
<a name="l01113"></a>01113       + <span class="stringliteral">&quot;structure the indexes are stored in an array. \n&quot;</span>
<a name="l01114"></a>01114       + <span class="stringliteral">&quot;Building the tree:\n&quot;</span>
<a name="l01115"></a>01115       + <span class="stringliteral">&quot;If a node has &lt;maximal-inst-number&gt; (option -L) instances no &quot;</span>
<a name="l01116"></a>01116       + <span class="stringliteral">&quot;further splitting is done. Also if the split would leave one &quot;</span>
<a name="l01117"></a>01117       + <span class="stringliteral">&quot;side empty, the branch is not split any further even if the &quot;</span>
<a name="l01118"></a>01118       + <span class="stringliteral">&quot;instances in the resulting node are more than &quot;</span>
<a name="l01119"></a>01119       + <span class="stringliteral">&quot;&lt;maximal-inst-number&gt; instances.\n&quot;</span>
<a name="l01120"></a>01120       + <span class="stringliteral">&quot;**PLEASE NOTE:** The algorithm can not handle missing values, so it &quot;</span>
<a name="l01121"></a>01121       + <span class="stringliteral">&quot;is advisable to run ReplaceMissingValues filter if there are any &quot;</span>
<a name="l01122"></a>01122       + <span class="stringliteral">&quot;missing values in the dataset.\n\n&quot;</span>
<a name="l01123"></a>01123       + <span class="stringliteral">&quot;For more information see:\n\n&quot;</span>;
<a name="l01124"></a>01124   }
<a name="l01125"></a>01125 
<a name="l01126"></a>01126 
<a name="l01127"></a>01127 }
</pre></div></div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Enumerations</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr size="1"/><address style="text-align: right;"><small>Generated on 26 Nov 2014 for MOA by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
