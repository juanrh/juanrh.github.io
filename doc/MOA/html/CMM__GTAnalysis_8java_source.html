<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>MOA: main/java/moa/evaluation/CMM_GTAnalysis.java Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    </ul>
  </div>
<h1>main/java/moa/evaluation/CMM_GTAnalysis.java</h1><a href="CMM__GTAnalysis_8java.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00026"></a>00026 <span class="comment">/*</span>
<a name="l00027"></a>00027 <span class="comment"> * TODO:</span>
<a name="l00028"></a>00028 <span class="comment"> * - try to avoid calcualting the radius multiple times</span>
<a name="l00029"></a>00029 <span class="comment"> * - avoid the full distance map?</span>
<a name="l00030"></a>00030 <span class="comment"> * - knn functionality in clusters</span>
<a name="l00031"></a>00031 <span class="comment"> * - noise error</span>
<a name="l00032"></a>00032 <span class="comment"> */</span>
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 <span class="keyword">package </span>moa.evaluation;
<a name="l00035"></a>00035 
<a name="l00036"></a>00036 <span class="keyword">import</span> java.util.ArrayList;
<a name="l00037"></a>00037 <span class="keyword">import</span> java.util.HashMap;
<a name="l00038"></a>00038 <span class="keyword">import</span> java.util.Iterator;
<a name="l00039"></a>00039 <span class="keyword">import</span> moa.cluster.Clustering;
<a name="l00040"></a>00040 <span class="keyword">import</span> moa.core.AutoExpandVector;
<a name="l00041"></a>00041 <span class="keyword">import</span> moa.gui.visualization.DataPoint;
<a name="l00042"></a>00042 <span class="keyword">import</span> weka.core.Instance;
<a name="l00043"></a>00043 
<a name="l00044"></a><a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html">00044</a> <span class="keyword">public</span> <span class="keyword">class </span><a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html">CMM_GTAnalysis</a>{
<a name="l00045"></a>00045     
<a name="l00049"></a><a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#ae20bc1ec5e8cf6c8e9c4f7d3946d41d9">00049</a>     <span class="keyword">private</span> <a class="code" href="classmoa_1_1cluster_1_1Clustering.html">Clustering</a> <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#ae20bc1ec5e8cf6c8e9c4f7d3946d41d9" title="the given ground truth clustering">gtClustering</a>;
<a name="l00050"></a>00050     
<a name="l00054"></a><a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a0965fbdb68d33beb80c3eacdbfbae23a">00054</a>     <span class="keyword">private</span> ArrayList&lt;CMMPoint&gt; <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a0965fbdb68d33beb80c3eacdbfbae23a" title="list of given points within the horizon">cmmpoints</a>;
<a name="l00055"></a>00055     
<a name="l00059"></a><a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a7cc6f53a872eae41a64946e52d018b3c">00059</a>     <span class="keyword">private</span> ArrayList&lt;GTCluster&gt; <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a7cc6f53a872eae41a64946e52d018b3c" title="the newly calculate ground truth clustering">gt0Clusters</a>;
<a name="l00060"></a>00060 
<a name="l00064"></a><a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#ae127ba2ccbd6473eecee957166376b01">00064</a>     <span class="keyword">private</span> ArrayList&lt;Integer&gt; <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#ae127ba2ccbd6473eecee957166376b01" title="IDs of noise points.">noise</a>;
<a name="l00065"></a>00065     
<a name="l00069"></a><a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#aa2d0f1f8a9385144d77a0b9a229b18fe">00069</a>     <span class="keyword">private</span> <span class="keywordtype">int</span> <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#aa2d0f1f8a9385144d77a0b9a229b18fe" title="total number of points">numPoints</a>;
<a name="l00070"></a>00070 
<a name="l00074"></a><a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#ac1ef13e27a75f32996e8345f84104ab3">00074</a>     <span class="keyword">private</span> <span class="keywordtype">int</span> <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#ac1ef13e27a75f32996e8345f84104ab3" title="number of clusters of the original ground truth">numGTClusters</a>;
<a name="l00075"></a>00075 
<a name="l00080"></a><a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a192432eab53d9e63790f1884deb28ad6">00080</a>     <span class="keyword">private</span> <span class="keywordtype">int</span> <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a192432eab53d9e63790f1884deb28ad6" title="number of classes of the original ground truth, in case of a micro clustering ground...">numGTClasses</a>;
<a name="l00081"></a>00081 
<a name="l00085"></a><a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#ae20eee4960c0ab1c46945ae0ddceabc5">00085</a>     <span class="keyword">private</span> <span class="keywordtype">int</span> <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#ae20eee4960c0ab1c46945ae0ddceabc5" title="number of classes after we are done with the analysis">numGT0Classes</a>;
<a name="l00086"></a>00086 
<a name="l00090"></a><a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a5929b560ec034d7e89d94a46b9c833f9">00090</a>     <span class="keyword">private</span> <span class="keywordtype">int</span> <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a5929b560ec034d7e89d94a46b9c833f9" title="number of dimensions">numDims</a>;
<a name="l00091"></a>00091 
<a name="l00098"></a><a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#aec394c5b7fa779b1be6ae62d67a5605a">00098</a>     <span class="keyword">private</span> HashMap&lt;Integer, Integer&gt; <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#aec394c5b7fa779b1be6ae62d67a5605a" title="mapping between true cluster ID/class label of the original ground truth and the...">mapTrueLabelToWorkLabel</a>;
<a name="l00099"></a>00099 
<a name="l00103"></a><a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a8e2b007362023af2e309f1d42b4ff41f">00103</a>     <span class="keyword">private</span> <span class="keywordtype">int</span>[] <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a8e2b007362023af2e309f1d42b4ff41f" title="log of how clusters have been merged (for debugging)">mergeMap</a>;
<a name="l00104"></a>00104 
<a name="l00109"></a><a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a14641ffe1cea7697d92152c4dfbe2c08">00109</a>     <span class="keyword">private</span> <span class="keywordtype">int</span> <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a14641ffe1cea7697d92152c4dfbe2c08" title="number of non-noise points that will create an error due to the underlying clustering...">noiseErrorByModel</a>;
<a name="l00110"></a>00110 
<a name="l00115"></a><a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a494e4390e05aff2f7e2440ac9ae81b8f">00115</a>     <span class="keyword">private</span> <span class="keywordtype">int</span> <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a494e4390e05aff2f7e2440ac9ae81b8f" title="number of noise points that will create an error due to the underlying clustering...">pointErrorByModel</a>;    
<a name="l00116"></a>00116     
<a name="l00120"></a><a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a62bebded5af1f26fae7be62e14dcf2ec">00120</a>     <span class="keyword">private</span> <span class="keywordtype">boolean</span> <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a62bebded5af1f26fae7be62e14dcf2ec" title="CMM debug mode.">debug</a> = <span class="keyword">false</span>;
<a name="l00121"></a>00121 
<a name="l00122"></a>00122     
<a name="l00123"></a>00123     <span class="comment">/******* CMM parameter ***********/</span>
<a name="l00124"></a>00124 
<a name="l00128"></a><a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#aab0bccf5e6ea62738572a224b96787fc">00128</a>     <span class="keyword">private</span> <span class="keywordtype">int</span> <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#aab0bccf5e6ea62738572a224b96787fc" title="defines how many nearest neighbors will be used">knnNeighbourhood</a> = 2;
<a name="l00129"></a>00129 
<a name="l00134"></a><a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a91801ca91918ceff8edb511d568ee851">00134</a>     <span class="keyword">private</span> <span class="keywordtype">double</span> <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a91801ca91918ceff8edb511d568ee851" title="the threshold which defines when ground truth clusters will be merged.">tauConnection</a> = 0.5;
<a name="l00135"></a>00135     
<a name="l00140"></a><a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a292b5119262d9a88c5604b5afb38dfd3">00140</a>     <span class="keyword">private</span> <span class="keywordtype">double</span> <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a292b5119262d9a88c5604b5afb38dfd3" title="experimental (default: disabled) separate k for points to cluster and cluster to...">clusterConnectionMaxPoints</a> = <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#aab0bccf5e6ea62738572a224b96787fc" title="defines how many nearest neighbors will be used">knnNeighbourhood</a>;
<a name="l00141"></a>00141     
<a name="l00149"></a><a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a7ccfd650aef6e8fe584eee218d79203b">00149</a>     <span class="keyword">private</span> <span class="keywordtype">boolean</span> <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a7ccfd650aef6e8fe584eee218d79203b" title="experimental (default: disabled) use exponential connectivity function to model different...">useExpConnectivity</a> = <span class="keyword">false</span>;
<a name="l00150"></a><a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#aa0d61c06230991b95f84b502eda6e870">00150</a>     <span class="keyword">private</span> <span class="keywordtype">double</span> <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#aa0d61c06230991b95f84b502eda6e870">lambdaConnRefXValue</a> = 0.01;
<a name="l00151"></a><a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a6fcfbef25132f0ccea2cfa77060ac205">00151</a>     <span class="keyword">private</span> <span class="keywordtype">double</span> <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a6fcfbef25132f0ccea2cfa77060ac205">lambdaConnX</a> = 4;
<a name="l00152"></a><a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#ac668bdacbf7a57caa60b5f376665705e">00152</a>     <span class="keyword">private</span> <span class="keywordtype">double</span> <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#ac668bdacbf7a57caa60b5f376665705e">lamdaConn</a>;
<a name="l00153"></a>00153     
<a name="l00154"></a>00154     
<a name="l00155"></a>00155     <span class="comment">/******************************************/</span>
<a name="l00156"></a>00156     
<a name="l00157"></a>00157     
<a name="l00162"></a><a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1CMMPoint.html">00162</a>     <span class="keyword">protected</span> <span class="keyword">class </span><a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1CMMPoint.html" title="Wrapper class for data points to store CMM relevant attributes.">CMMPoint</a> <span class="keyword">extends</span> <a class="code" href="classmoa_1_1gui_1_1visualization_1_1DataPoint.html">DataPoint</a>{
<a name="l00166"></a><a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1CMMPoint.html#a63b8005f05e1980f211e5966e43abfbe">00166</a>         <span class="keyword">protected</span> <a class="code" href="classmoa_1_1gui_1_1visualization_1_1DataPoint.html">DataPoint</a> <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1CMMPoint.html#a63b8005f05e1980f211e5966e43abfbe" title="Reference to original point.">p</a> = null;
<a name="l00167"></a>00167         
<a name="l00171"></a><a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1CMMPoint.html#a6ceb48d5c944fe18c1d75a8f46f28a49">00171</a>         <span class="keyword">protected</span> <span class="keywordtype">int</span> <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1CMMPoint.html#a6ceb48d5c944fe18c1d75a8f46f28a49" title="point ID">pID</a> = 0;
<a name="l00172"></a>00172         
<a name="l00173"></a>00173         
<a name="l00177"></a><a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1CMMPoint.html#a91ffbd91a4000e61410340ef9415ad2b">00177</a>         <span class="keyword">protected</span> <span class="keywordtype">int</span> <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1CMMPoint.html#a91ffbd91a4000e61410340ef9415ad2b" title="true class label">trueClass</a> = -1;
<a name="l00178"></a>00178 
<a name="l00179"></a>00179         
<a name="l00183"></a><a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1CMMPoint.html#ae661e81945ef9785f9b0777665010dc2">00183</a>         <span class="keyword">protected</span> <span class="keywordtype">double</span> <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1CMMPoint.html#ae661e81945ef9785f9b0777665010dc2" title="the connectivity of the point to its cluster">connectivity</a> = 1.0;
<a name="l00184"></a>00184         
<a name="l00185"></a>00185         
<a name="l00189"></a><a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1CMMPoint.html#a962d32dd976cd174852774733f5f88f4">00189</a>         <span class="keyword">protected</span> <span class="keywordtype">double</span> <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1CMMPoint.html#a962d32dd976cd174852774733f5f88f4" title="knn distnace within own cluster">knnInCluster</a> = 0.0; 
<a name="l00190"></a>00190         
<a name="l00191"></a>00191         
<a name="l00195"></a><a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1CMMPoint.html#affb2e52824c5e843f3714c0aaed0c945">00195</a>         <span class="keyword">protected</span> ArrayList&lt;Integer&gt; <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1CMMPoint.html#affb2e52824c5e843f3714c0aaed0c945" title="knn indices (for debugging only)">knnIndices</a>;
<a name="l00196"></a>00196 
<a name="l00197"></a><a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1CMMPoint.html#a82a654c1c25083ecc71ec857edbb9baf">00197</a>         <span class="keyword">public</span> <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1CMMPoint.html#a82a654c1c25083ecc71ec857edbb9baf">CMMPoint</a>(<a class="code" href="classmoa_1_1gui_1_1visualization_1_1DataPoint.html">DataPoint</a> point, <span class="keywordtype">int</span> <span class="keywordtype">id</span>) {
<a name="l00198"></a>00198             <span class="comment">//make a copy, but keep reference</span>
<a name="l00199"></a>00199             super(point,point.<a class="code" href="classmoa_1_1gui_1_1visualization_1_1DataPoint.html#a2a969caa225b25dce49d0e0caba03037">getTimestamp</a>());
<a name="l00200"></a>00200             <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1CMMPoint.html#a63b8005f05e1980f211e5966e43abfbe" title="Reference to original point.">p</a> = point;
<a name="l00201"></a>00201             <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1CMMPoint.html#a6ceb48d5c944fe18c1d75a8f46f28a49" title="point ID">pID</a> = id;
<a name="l00202"></a>00202             <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1CMMPoint.html#a91ffbd91a4000e61410340ef9415ad2b" title="true class label">trueClass</a> = (int)point.classValue();
<a name="l00203"></a>00203         }
<a name="l00204"></a>00204 
<a name="l00205"></a>00205         
<a name="l00212"></a><a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1CMMPoint.html#ae69d6c93ab345ead82db85e885af44ad">00212</a>         <span class="keyword">protected</span> <span class="keywordtype">int</span> <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1CMMPoint.html#ae69d6c93ab345ead82db85e885af44ad" title="Retruns the current working label of the cluster the point belongs to.">workclass</a>(){
<a name="l00213"></a>00213             <span class="keywordflow">if</span>(<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1CMMPoint.html#a91ffbd91a4000e61410340ef9415ad2b" title="true class label">trueClass</a> == -1 )
<a name="l00214"></a>00214                 <span class="keywordflow">return</span> -1;
<a name="l00215"></a>00215             <span class="keywordflow">else</span>
<a name="l00216"></a>00216                 <span class="keywordflow">return</span> <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#aec394c5b7fa779b1be6ae62d67a5605a" title="mapping between true cluster ID/class label of the original ground truth and the...">mapTrueLabelToWorkLabel</a>.get(<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1CMMPoint.html#a91ffbd91a4000e61410340ef9415ad2b" title="true class label">trueClass</a>);
<a name="l00217"></a>00217         }
<a name="l00218"></a>00218     }
<a name="l00219"></a>00219 
<a name="l00220"></a>00220     
<a name="l00221"></a>00221     
<a name="l00226"></a><a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html">00226</a>     <span class="keyword">protected</span> <span class="keyword">class </span><a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html" title="Main class to model the new clusters that will be the output of the cluster analysis...">GTCluster</a>{
<a name="l00228"></a><a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#a61122cc1837ba7bf62885e570c22d04f">00228</a>         <span class="keyword">private</span> ArrayList&lt;Integer&gt; <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#a61122cc1837ba7bf62885e570c22d04f" title="points that are per definition in the cluster">points</a> = <span class="keyword">new</span> ArrayList&lt;Integer&gt;();
<a name="l00229"></a>00229         
<a name="l00236"></a><a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#a1b4087bd78769233ecd0972102e2857c">00236</a>         <span class="keyword">private</span> ArrayList&lt;Integer&gt; <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#a1b4087bd78769233ecd0972102e2857c" title="a new GT cluster consists of one or more &amp;quot;old&amp;quot; GT clusters.">clusterRepresentations</a> = <span class="keyword">new</span> ArrayList&lt;Integer&gt;();
<a name="l00237"></a>00237      
<a name="l00239"></a><a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#a82dd092b64ced5c5a4d08f9ff1f92e71">00239</a>         <span class="keyword">private</span> <span class="keywordtype">int</span> <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#a82dd092b64ced5c5a4d08f9ff1f92e71" title="current work class (changes when merging)">workclass</a>;
<a name="l00240"></a>00240         
<a name="l00242"></a><a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#a5681236b673e47b401878ac4d4b13f84">00242</a>         <span class="keyword">private</span> <span class="keyword">final</span> <span class="keywordtype">int</span> <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#a5681236b673e47b401878ac4d4b13f84" title="original work class">orgWorkClass</a>;
<a name="l00243"></a>00243         
<a name="l00245"></a><a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#a8fea6f54460bc32a95a09367dc85bb9c">00245</a>         <span class="keyword">private</span> <span class="keyword">final</span> <span class="keywordtype">int</span> <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#a8fea6f54460bc32a95a09367dc85bb9c" title="original class label">label</a>;
<a name="l00246"></a>00246         
<a name="l00248"></a><a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#ab2e409c1b650f69bddd852cf95ffa4b0">00248</a>         <span class="keyword">private</span> ArrayList&lt;Integer&gt; <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#ab2e409c1b650f69bddd852cf95ffa4b0" title="clusters that have been merged into this cluster (debugging)">mergedWorkLabels</a> = null;
<a name="l00249"></a>00249         
<a name="l00251"></a><a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#ac8f4d346124d90c001924308ecf56d36">00251</a>         <span class="keyword">private</span> <span class="keywordtype">double</span> <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#ac8f4d346124d90c001924308ecf56d36" title="average knn distance of all points in the cluster">knnMeanAvg</a> = 0;
<a name="l00252"></a>00252         
<a name="l00254"></a><a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#a43a65f7797452a537d59813a5f93700b">00254</a>         <span class="keyword">private</span> <span class="keywordtype">double</span> <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#a43a65f7797452a537d59813a5f93700b" title="average deviation of knn distance of all points">knnDevAvg</a> = 0;
<a name="l00255"></a>00255         
<a name="l00257"></a><a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#abda07002f6de3106c67027e641bfe76e">00257</a>         <span class="keyword">private</span> ArrayList&lt;Double&gt; <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#abda07002f6de3106c67027e641bfe76e" title="connectivity of the cluster to all other clusters">connections</a> = <span class="keyword">new</span> ArrayList&lt;Double&gt;();
<a name="l00258"></a>00258         
<a name="l00259"></a>00259 
<a name="l00260"></a><a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#add94a97cb06e4c42d464b3b31eb0b79f">00260</a>         <span class="keyword">private</span> <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#add94a97cb06e4c42d464b3b31eb0b79f">GTCluster</a>(<span class="keywordtype">int</span> <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#a82dd092b64ced5c5a4d08f9ff1f92e71" title="current work class (changes when merging)">workclass</a>, <span class="keywordtype">int</span> <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#a8fea6f54460bc32a95a09367dc85bb9c" title="original class label">label</a>, <span class="keywordtype">int</span> gtClusteringID) {
<a name="l00261"></a>00261            this.<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#a5681236b673e47b401878ac4d4b13f84" title="original work class">orgWorkClass</a> = workclass;
<a name="l00262"></a>00262            this.workclass = workclass;
<a name="l00263"></a>00263            this.label = label;
<a name="l00264"></a>00264            this.<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#a1b4087bd78769233ecd0972102e2857c" title="a new GT cluster consists of one or more &amp;quot;old&amp;quot; GT clusters.">clusterRepresentations</a>.add(gtClusteringID);
<a name="l00265"></a>00265         }
<a name="l00266"></a>00266 
<a name="l00267"></a>00267         
<a name="l00272"></a><a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#adc36623a46ee7a02391058f8a3f341b5">00272</a>         <span class="keyword">protected</span> <span class="keywordtype">int</span> <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#adc36623a46ee7a02391058f8a3f341b5" title="The original class label the cluster represents.">getLabel</a>(){
<a name="l00273"></a>00273             <span class="keywordflow">return</span> <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#a8fea6f54460bc32a95a09367dc85bb9c" title="original class label">label</a>;
<a name="l00274"></a>00274         }
<a name="l00275"></a>00275 
<a name="l00281"></a><a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#a1eb12645d8c7f4694ac9071b1eb34f80">00281</a>         <span class="keyword">protected</span> <span class="keywordtype">double</span> <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#a1eb12645d8c7f4694ac9071b1eb34f80" title="Calculate the probability of the point being covered through the cluster.">getInclusionProbability</a>(<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1CMMPoint.html" title="Wrapper class for data points to store CMM relevant attributes.">CMMPoint</a> point){
<a name="l00282"></a>00282             <span class="keywordtype">double</span> prob = Double.MIN_VALUE;
<a name="l00283"></a>00283             <span class="comment">//check all cluster representatives for coverage</span>
<a name="l00284"></a>00284             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> c = 0; c &lt; <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#a1b4087bd78769233ecd0972102e2857c" title="a new GT cluster consists of one or more &amp;quot;old&amp;quot; GT clusters.">clusterRepresentations</a>.size(); c++) {
<a name="l00285"></a>00285                <span class="keywordtype">double</span> tmp_prob = <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#ae20bc1ec5e8cf6c8e9c4f7d3946d41d9" title="the given ground truth clustering">gtClustering</a>.<a class="code" href="classmoa_1_1cluster_1_1Clustering.html#a6a66be9b90f5cb06b044da278cdf24c9" title="remove a cluster from the clustering">get</a>(<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#a1b4087bd78769233ecd0972102e2857c" title="a new GT cluster consists of one or more &amp;quot;old&amp;quot; GT clusters.">clusterRepresentations</a>.get(c)).<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#a1eb12645d8c7f4694ac9071b1eb34f80" title="Calculate the probability of the point being covered through the cluster.">getInclusionProbability</a>(point);
<a name="l00286"></a>00286                <span class="keywordflow">if</span>(tmp_prob &gt; prob) prob = tmp_prob;
<a name="l00287"></a>00287             }
<a name="l00288"></a>00288             <span class="keywordflow">return</span> prob;
<a name="l00289"></a>00289         }
<a name="l00290"></a>00290 
<a name="l00291"></a>00291         
<a name="l00296"></a><a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#a09170ac078e5dbc33442c8fba9aabb68">00296</a>         <span class="keyword">private</span> <span class="keywordtype">void</span> <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#a09170ac078e5dbc33442c8fba9aabb68" title="calculate knn distances of points within own cluster + average knn distance and average...">calculateKnn</a>(){
<a name="l00297"></a>00297             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> p0 : <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#a61122cc1837ba7bf62885e570c22d04f" title="points that are per definition in the cluster">points</a>) {
<a name="l00298"></a>00298                 <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1CMMPoint.html" title="Wrapper class for data points to store CMM relevant attributes.">CMMPoint</a> cmdp = <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a0965fbdb68d33beb80c3eacdbfbae23a" title="list of given points within the horizon">cmmpoints</a>.get(p0);
<a name="l00299"></a>00299                 <span class="keywordflow">if</span>(!cmdp.<a class="code" href="classmoa_1_1gui_1_1visualization_1_1DataPoint.html#a346207ffb1974293b5d67cf10656ef3d">isNoise</a>()){
<a name="l00300"></a>00300                     AutoExpandVector&lt;Double&gt; knnDist = <span class="keyword">new</span> AutoExpandVector&lt;Double&gt;();
<a name="l00301"></a>00301                     AutoExpandVector&lt;Integer&gt; knnPointIndex = <span class="keyword">new</span> AutoExpandVector&lt;Integer&gt;();
<a name="l00302"></a>00302                     
<a name="l00303"></a>00303                     <span class="comment">//calculate nearest neighbours </span>
<a name="l00304"></a>00304                     <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a12f256dabb3d986447d1d0b74a9a0dbc">getKnnInCluster</a>(cmdp, <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#aab0bccf5e6ea62738572a224b96787fc" title="defines how many nearest neighbors will be used">knnNeighbourhood</a>, points, knnDist,knnPointIndex);
<a name="l00305"></a>00305 
<a name="l00306"></a>00306                     <span class="comment">//TODO: What to do if we have less then k neighbours?</span>
<a name="l00307"></a>00307                     <span class="keywordtype">double</span> avgKnn = 0;
<a name="l00308"></a>00308                     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; knnDist.size(); i++) {
<a name="l00309"></a>00309                         avgKnn+= knnDist.get(i);
<a name="l00310"></a>00310                     }
<a name="l00311"></a>00311                     <span class="keywordflow">if</span>(knnDist.size()!=0)
<a name="l00312"></a>00312                         avgKnn/=knnDist.size();
<a name="l00313"></a>00313                     cmdp.<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1CMMPoint.html#a962d32dd976cd174852774733f5f88f4" title="knn distnace within own cluster">knnInCluster</a> = avgKnn;
<a name="l00314"></a>00314                     cmdp.<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1CMMPoint.html#affb2e52824c5e843f3714c0aaed0c945" title="knn indices (for debugging only)">knnIndices</a> = knnPointIndex;
<a name="l00315"></a>00315                     cmdp.<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1CMMPoint.html#a63b8005f05e1980f211e5966e43abfbe" title="Reference to original point.">p</a>.<a class="code" href="classmoa_1_1gui_1_1visualization_1_1DataPoint.html#ae785a3bf303998016133b7d56566a920">setMeasureValue</a>(<span class="stringliteral">&quot;knnAvg&quot;</span>, cmdp.<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1CMMPoint.html#a962d32dd976cd174852774733f5f88f4" title="knn distnace within own cluster">knnInCluster</a>);
<a name="l00316"></a>00316 
<a name="l00317"></a>00317                     <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#ac8f4d346124d90c001924308ecf56d36" title="average knn distance of all points in the cluster">knnMeanAvg</a>+=avgKnn;
<a name="l00318"></a>00318                     <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#a43a65f7797452a537d59813a5f93700b" title="average deviation of knn distance of all points">knnDevAvg</a>+=Math.pow(avgKnn,2);
<a name="l00319"></a>00319                 }
<a name="l00320"></a>00320             }
<a name="l00321"></a>00321             <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#ac8f4d346124d90c001924308ecf56d36" title="average knn distance of all points in the cluster">knnMeanAvg</a>=<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#ac8f4d346124d90c001924308ecf56d36" title="average knn distance of all points in the cluster">knnMeanAvg</a>/(double)points.size();
<a name="l00322"></a>00322             <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#a43a65f7797452a537d59813a5f93700b" title="average deviation of knn distance of all points">knnDevAvg</a>=<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#a43a65f7797452a537d59813a5f93700b" title="average deviation of knn distance of all points">knnDevAvg</a>/(double)points.size();
<a name="l00323"></a>00323 
<a name="l00324"></a>00324             <span class="keywordtype">double</span> variance = <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#a43a65f7797452a537d59813a5f93700b" title="average deviation of knn distance of all points">knnDevAvg</a>-Math.pow(<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#ac8f4d346124d90c001924308ecf56d36" title="average knn distance of all points in the cluster">knnMeanAvg</a>,2.0);
<a name="l00325"></a>00325             <span class="comment">// Due to numerical errors, small negative values can occur.</span>
<a name="l00326"></a>00326             <span class="keywordflow">if</span> (variance &lt;= 0.0) variance = 1e-50;
<a name="l00327"></a>00327             <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#a43a65f7797452a537d59813a5f93700b" title="average deviation of knn distance of all points">knnDevAvg</a> = Math.sqrt(variance);
<a name="l00328"></a>00328 
<a name="l00329"></a>00329         }
<a name="l00330"></a>00330 
<a name="l00331"></a>00331         
<a name="l00337"></a><a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#a4491214b1e08b8cfc8d1895fb5038a18">00337</a>         <span class="keyword">private</span> <span class="keywordtype">void</span> <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#a4491214b1e08b8cfc8d1895fb5038a18" title="Calculate the connection of a cluster to this cluster.">calculateClusterConnection</a>(<span class="keywordtype">int</span> otherCid, <span class="keywordtype">boolean</span> initial){
<a name="l00338"></a>00338             <span class="keywordtype">double</span> avgConnection = 0;
<a name="l00339"></a>00339             <span class="keywordflow">if</span>(<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#a82dd092b64ced5c5a4d08f9ff1f92e71" title="current work class (changes when merging)">workclass</a>==otherCid){
<a name="l00340"></a>00340                 avgConnection = 1;
<a name="l00341"></a>00341             }
<a name="l00342"></a>00342             <span class="keywordflow">else</span>{
<a name="l00343"></a>00343                 AutoExpandVector&lt;Double&gt; kmax = <span class="keyword">new</span> AutoExpandVector&lt;Double&gt;();
<a name="l00344"></a>00344                 AutoExpandVector&lt;Integer&gt; kmaxIndexes = <span class="keyword">new</span> AutoExpandVector&lt;Integer&gt;();
<a name="l00345"></a>00345 
<a name="l00346"></a>00346                 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> p : <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#a61122cc1837ba7bf62885e570c22d04f" title="points that are per definition in the cluster">points</a>){
<a name="l00347"></a>00347                     <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1CMMPoint.html" title="Wrapper class for data points to store CMM relevant attributes.">CMMPoint</a> cmdp = <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a0965fbdb68d33beb80c3eacdbfbae23a" title="list of given points within the horizon">cmmpoints</a>.get(p);
<a name="l00348"></a>00348                     <span class="keywordtype">double</span> con_p_Cj = <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a794b653c2c7b7335127f6ca7720ec5ab" title="Calculate the connection of a point to a cluster.">getConnectionValue</a>(<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a0965fbdb68d33beb80c3eacdbfbae23a" title="list of given points within the horizon">cmmpoints</a>.get(p), otherCid);
<a name="l00349"></a>00349                     <span class="keywordtype">double</span> connection = cmdp.<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1CMMPoint.html#ae661e81945ef9785f9b0777665010dc2" title="the connectivity of the point to its cluster">connectivity</a> * con_p_Cj;
<a name="l00350"></a>00350                     <span class="keywordflow">if</span>(initial){
<a name="l00351"></a>00351                         cmdp.<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1CMMPoint.html#a63b8005f05e1980f211e5966e43abfbe" title="Reference to original point.">p</a>.<a class="code" href="classmoa_1_1gui_1_1visualization_1_1DataPoint.html#ae785a3bf303998016133b7d56566a920">setMeasureValue</a>(<span class="stringliteral">&quot;Connection to C&quot;</span>+otherCid, con_p_Cj);
<a name="l00352"></a>00352                     }
<a name="l00353"></a>00353 
<a name="l00354"></a>00354                     <span class="comment">//connection</span>
<a name="l00355"></a>00355                     <span class="keywordflow">if</span>(kmax.size() &lt; <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a292b5119262d9a88c5604b5afb38dfd3" title="experimental (default: disabled) separate k for points to cluster and cluster to...">clusterConnectionMaxPoints</a> || connection &gt; kmax.get(kmax.size()-1)){
<a name="l00356"></a>00356                         <span class="keywordtype">int</span> index = 0;
<a name="l00357"></a>00357                         <span class="keywordflow">while</span>(index &lt; kmax.size() &amp;&amp; connection &lt; kmax.get(index)) {
<a name="l00358"></a>00358                             index++;
<a name="l00359"></a>00359                         }
<a name="l00360"></a>00360                         kmax.add(index, connection);
<a name="l00361"></a>00361                         kmaxIndexes.add(index, p);
<a name="l00362"></a>00362                         <span class="keywordflow">if</span>(kmax.size() &gt; <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a292b5119262d9a88c5604b5afb38dfd3" title="experimental (default: disabled) separate k for points to cluster and cluster to...">clusterConnectionMaxPoints</a>){
<a name="l00363"></a>00363                             kmax.remove(kmax.size()-1);
<a name="l00364"></a>00364                             kmaxIndexes.add(kmaxIndexes.size()-1);
<a name="l00365"></a>00365                         }
<a name="l00366"></a>00366                     }
<a name="l00367"></a>00367                 }
<a name="l00368"></a>00368                 <span class="comment">//connection</span>
<a name="l00369"></a>00369                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; kmax.size(); k++) {
<a name="l00370"></a>00370                     avgConnection+= kmax.get(k);
<a name="l00371"></a>00371                 }
<a name="l00372"></a>00372                 avgConnection/=kmax.size();
<a name="l00373"></a>00373             }
<a name="l00374"></a>00374 
<a name="l00375"></a>00375             <span class="keywordflow">if</span>(otherCid&lt;<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#abda07002f6de3106c67027e641bfe76e" title="connectivity of the cluster to all other clusters">connections</a>.size()){
<a name="l00376"></a>00376                 <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#abda07002f6de3106c67027e641bfe76e" title="connectivity of the cluster to all other clusters">connections</a>.set(otherCid, avgConnection);
<a name="l00377"></a>00377             }
<a name="l00378"></a>00378             <span class="keywordflow">else</span>
<a name="l00379"></a>00379                 <span class="keywordflow">if</span>(<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#abda07002f6de3106c67027e641bfe76e" title="connectivity of the cluster to all other clusters">connections</a>.size() == otherCid){
<a name="l00380"></a>00380                     <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#abda07002f6de3106c67027e641bfe76e" title="connectivity of the cluster to all other clusters">connections</a>.add(avgConnection);
<a name="l00381"></a>00381                 }
<a name="l00382"></a>00382                 <span class="keywordflow">else</span>
<a name="l00383"></a>00383                     System.out.println(<span class="stringliteral">&quot;Something is going really wrong with the connection listing!&quot;</span>+<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#aab0bccf5e6ea62738572a224b96787fc" title="defines how many nearest neighbors will be used">knnNeighbourhood</a>+<span class="stringliteral">&quot; &quot;</span>+<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a91801ca91918ceff8edb511d568ee851" title="the threshold which defines when ground truth clusters will be merged.">tauConnection</a>);
<a name="l00384"></a>00384         }
<a name="l00385"></a>00385 
<a name="l00386"></a>00386         
<a name="l00391"></a><a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#abfe7a47ed99bca19e98e7b54dd113447">00391</a>         <span class="keyword">private</span> <span class="keywordtype">void</span> <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#abfe7a47ed99bca19e98e7b54dd113447" title="Merge a cluster into this cluster.">mergeCluster</a>(<span class="keywordtype">int</span> mergeID){
<a name="l00392"></a>00392             <span class="keywordflow">if</span>(mergeID &lt; <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a7cc6f53a872eae41a64946e52d018b3c" title="the newly calculate ground truth clustering">gt0Clusters</a>.size()){
<a name="l00393"></a>00393                 <span class="comment">//track merging (debugging)</span>
<a name="l00394"></a>00394                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a192432eab53d9e63790f1884deb28ad6" title="number of classes of the original ground truth, in case of a micro clustering ground...">numGTClasses</a>; i++) {
<a name="l00395"></a>00395                     <span class="keywordflow">if</span>(<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a8e2b007362023af2e309f1d42b4ff41f" title="log of how clusters have been merged (for debugging)">mergeMap</a>[i]==mergeID)
<a name="l00396"></a>00396                         <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a8e2b007362023af2e309f1d42b4ff41f" title="log of how clusters have been merged (for debugging)">mergeMap</a>[i]=<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#a82dd092b64ced5c5a4d08f9ff1f92e71" title="current work class (changes when merging)">workclass</a>;
<a name="l00397"></a>00397                     <span class="keywordflow">if</span>(<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a8e2b007362023af2e309f1d42b4ff41f" title="log of how clusters have been merged (for debugging)">mergeMap</a>[i]&gt;mergeID)
<a name="l00398"></a>00398                         <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a8e2b007362023af2e309f1d42b4ff41f" title="log of how clusters have been merged (for debugging)">mergeMap</a>[i]--;
<a name="l00399"></a>00399                 }
<a name="l00400"></a>00400                 <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html" title="Main class to model the new clusters that will be the output of the cluster analysis...">GTCluster</a> gtcMerge  = <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a7cc6f53a872eae41a64946e52d018b3c" title="the newly calculate ground truth clustering">gt0Clusters</a>.get(mergeID);
<a name="l00401"></a>00401                 <span class="keywordflow">if</span>(<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a62bebded5af1f26fae7be62e14dcf2ec" title="CMM debug mode.">debug</a>)
<a name="l00402"></a>00402                     System.out.println(<span class="stringliteral">&quot;Merging C&quot;</span>+gtcMerge.<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#a82dd092b64ced5c5a4d08f9ff1f92e71" title="current work class (changes when merging)">workclass</a>+<span class="stringliteral">&quot; into C&quot;</span>+<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#a82dd092b64ced5c5a4d08f9ff1f92e71" title="current work class (changes when merging)">workclass</a>+
<a name="l00403"></a>00403                             <span class="stringliteral">&quot; with Con &quot;</span>+<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#abda07002f6de3106c67027e641bfe76e" title="connectivity of the cluster to all other clusters">connections</a>.get(mergeID)+<span class="stringliteral">&quot; / &quot;</span>+gtcMerge.<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#abda07002f6de3106c67027e641bfe76e" title="connectivity of the cluster to all other clusters">connections</a>.get(<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#a82dd092b64ced5c5a4d08f9ff1f92e71" title="current work class (changes when merging)">workclass</a>));
<a name="l00404"></a>00404 
<a name="l00405"></a>00405 
<a name="l00406"></a>00406                 <span class="comment">//update mapTrueLabelToWorkLabel</span>
<a name="l00407"></a>00407                 <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#aec394c5b7fa779b1be6ae62d67a5605a" title="mapping between true cluster ID/class label of the original ground truth and the...">mapTrueLabelToWorkLabel</a>.put(gtcMerge.<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#a8fea6f54460bc32a95a09367dc85bb9c" title="original class label">label</a>, <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#a82dd092b64ced5c5a4d08f9ff1f92e71" title="current work class (changes when merging)">workclass</a>);
<a name="l00408"></a>00408                 Iterator iterator = <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#aec394c5b7fa779b1be6ae62d67a5605a" title="mapping between true cluster ID/class label of the original ground truth and the...">mapTrueLabelToWorkLabel</a>.keySet().iterator();
<a name="l00409"></a>00409                 <span class="keywordflow">while</span> (iterator.hasNext()) {
<a name="l00410"></a>00410                     Integer key = (Integer)iterator.next();
<a name="l00411"></a>00411                     <span class="comment">//update pointer of already merged cluster</span>
<a name="l00412"></a>00412                     <span class="keywordtype">int</span> value = <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#aec394c5b7fa779b1be6ae62d67a5605a" title="mapping between true cluster ID/class label of the original ground truth and the...">mapTrueLabelToWorkLabel</a>.get(key);
<a name="l00413"></a>00413                     <span class="keywordflow">if</span>(value == mergeID)
<a name="l00414"></a>00414                         <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#aec394c5b7fa779b1be6ae62d67a5605a" title="mapping between true cluster ID/class label of the original ground truth and the...">mapTrueLabelToWorkLabel</a>.put(key, <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#a82dd092b64ced5c5a4d08f9ff1f92e71" title="current work class (changes when merging)">workclass</a>);
<a name="l00415"></a>00415                     <span class="keywordflow">if</span>(value &gt; mergeID)
<a name="l00416"></a>00416                         <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#aec394c5b7fa779b1be6ae62d67a5605a" title="mapping between true cluster ID/class label of the original ground truth and the...">mapTrueLabelToWorkLabel</a>.put(key, value-1);
<a name="l00417"></a>00417                 }
<a name="l00418"></a>00418 
<a name="l00419"></a>00419                 <span class="comment">//merge points from B into A</span>
<a name="l00420"></a>00420                 <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#a61122cc1837ba7bf62885e570c22d04f" title="points that are per definition in the cluster">points</a>.addAll(gtcMerge.<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#a61122cc1837ba7bf62885e570c22d04f" title="points that are per definition in the cluster">points</a>);
<a name="l00421"></a>00421                 <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#a1b4087bd78769233ecd0972102e2857c" title="a new GT cluster consists of one or more &amp;quot;old&amp;quot; GT clusters.">clusterRepresentations</a>.addAll(gtcMerge.<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#a1b4087bd78769233ecd0972102e2857c" title="a new GT cluster consists of one or more &amp;quot;old&amp;quot; GT clusters.">clusterRepresentations</a>);
<a name="l00422"></a>00422                 <span class="keywordflow">if</span>(<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#ab2e409c1b650f69bddd852cf95ffa4b0" title="clusters that have been merged into this cluster (debugging)">mergedWorkLabels</a>==null){
<a name="l00423"></a>00423                     <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#ab2e409c1b650f69bddd852cf95ffa4b0" title="clusters that have been merged into this cluster (debugging)">mergedWorkLabels</a> = <span class="keyword">new</span> ArrayList&lt;Integer&gt;();
<a name="l00424"></a>00424                 }
<a name="l00425"></a>00425                 <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#ab2e409c1b650f69bddd852cf95ffa4b0" title="clusters that have been merged into this cluster (debugging)">mergedWorkLabels</a>.add(gtcMerge.<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#a5681236b673e47b401878ac4d4b13f84" title="original work class">orgWorkClass</a>);
<a name="l00426"></a>00426                 <span class="keywordflow">if</span>(gtcMerge.<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#ab2e409c1b650f69bddd852cf95ffa4b0" title="clusters that have been merged into this cluster (debugging)">mergedWorkLabels</a>!=null)
<a name="l00427"></a>00427                     <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#ab2e409c1b650f69bddd852cf95ffa4b0" title="clusters that have been merged into this cluster (debugging)">mergedWorkLabels</a>.addAll(gtcMerge.<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#ab2e409c1b650f69bddd852cf95ffa4b0" title="clusters that have been merged into this cluster (debugging)">mergedWorkLabels</a>);
<a name="l00428"></a>00428 
<a name="l00429"></a>00429                 <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a7cc6f53a872eae41a64946e52d018b3c" title="the newly calculate ground truth clustering">gt0Clusters</a>.remove(mergeID);
<a name="l00430"></a>00430 
<a name="l00431"></a>00431                 <span class="comment">//update workclass labels</span>
<a name="l00432"></a>00432                 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> c=mergeID; c &lt; <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a7cc6f53a872eae41a64946e52d018b3c" title="the newly calculate ground truth clustering">gt0Clusters</a>.size(); c++){
<a name="l00433"></a>00433                     <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a7cc6f53a872eae41a64946e52d018b3c" title="the newly calculate ground truth clustering">gt0Clusters</a>.get(c).workclass = c;
<a name="l00434"></a>00434                 }
<a name="l00435"></a>00435 
<a name="l00436"></a>00436                 <span class="comment">//update knn distances</span>
<a name="l00437"></a>00437                 <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#a09170ac078e5dbc33442c8fba9aabb68" title="calculate knn distances of points within own cluster + average knn distance and average...">calculateKnn</a>();
<a name="l00438"></a>00438                 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> c=0; c &lt; <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a7cc6f53a872eae41a64946e52d018b3c" title="the newly calculate ground truth clustering">gt0Clusters</a>.size(); c++){
<a name="l00439"></a>00439                     <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a7cc6f53a872eae41a64946e52d018b3c" title="the newly calculate ground truth clustering">gt0Clusters</a>.get(c).connections.remove(mergeID);
<a name="l00440"></a>00440                     
<a name="l00441"></a>00441                     <span class="comment">//recalculate connection from other clusters to the new merged one</span>
<a name="l00442"></a>00442                     <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a7cc6f53a872eae41a64946e52d018b3c" title="the newly calculate ground truth clustering">gt0Clusters</a>.get(c).calculateClusterConnection(<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#a82dd092b64ced5c5a4d08f9ff1f92e71" title="current work class (changes when merging)">workclass</a>,<span class="keyword">false</span>);
<a name="l00443"></a>00443                     <span class="comment">//and from new merged one to other clusters</span>
<a name="l00444"></a>00444                     <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a7cc6f53a872eae41a64946e52d018b3c" title="the newly calculate ground truth clustering">gt0Clusters</a>.get(<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html#a82dd092b64ced5c5a4d08f9ff1f92e71" title="current work class (changes when merging)">workclass</a>).calculateClusterConnection(c,<span class="keyword">false</span>);
<a name="l00445"></a>00445                 }
<a name="l00446"></a>00446             }
<a name="l00447"></a>00447             <span class="keywordflow">else</span>{
<a name="l00448"></a>00448                 System.out.println(<span class="stringliteral">&quot;Merge indices are not valid&quot;</span>);
<a name="l00449"></a>00449             }
<a name="l00450"></a>00450         }
<a name="l00451"></a>00451     }
<a name="l00452"></a>00452 
<a name="l00453"></a>00453     
<a name="l00459"></a><a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#af80b5acd2a6d1578a4d3bb13d3e65140">00459</a>     <span class="keyword">public</span> <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#af80b5acd2a6d1578a4d3bb13d3e65140">CMM_GTAnalysis</a>(<a class="code" href="classmoa_1_1cluster_1_1Clustering.html">Clustering</a> trueClustering, ArrayList&lt;DataPoint&gt; points, <span class="keywordtype">boolean</span> enableClassMerge){
<a name="l00460"></a>00460         <span class="keywordflow">if</span>(<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a62bebded5af1f26fae7be62e14dcf2ec" title="CMM debug mode.">debug</a>)
<a name="l00461"></a>00461             System.out.println(<span class="stringliteral">&quot;GT Analysis Debug Output&quot;</span>);
<a name="l00462"></a>00462 
<a name="l00463"></a>00463         <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a14641ffe1cea7697d92152c4dfbe2c08" title="number of non-noise points that will create an error due to the underlying clustering...">noiseErrorByModel</a> = 0;
<a name="l00464"></a>00464         <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a494e4390e05aff2f7e2440ac9ae81b8f" title="number of noise points that will create an error due to the underlying clustering...">pointErrorByModel</a> = 0;
<a name="l00465"></a>00465         <span class="keywordflow">if</span>(!enableClassMerge){
<a name="l00466"></a>00466             <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a91801ca91918ceff8edb511d568ee851" title="the threshold which defines when ground truth clusters will be merged.">tauConnection</a> = 1.0;
<a name="l00467"></a>00467         }
<a name="l00468"></a>00468 
<a name="l00469"></a>00469         <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#ac668bdacbf7a57caa60b5f376665705e">lamdaConn</a> = -Math.log(<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#aa0d61c06230991b95f84b502eda6e870">lambdaConnRefXValue</a>)/Math.log(2)/<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a6fcfbef25132f0ccea2cfa77060ac205">lambdaConnX</a>;
<a name="l00470"></a>00470         
<a name="l00471"></a>00471         this.<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#ae20bc1ec5e8cf6c8e9c4f7d3946d41d9" title="the given ground truth clustering">gtClustering</a> = trueClustering;
<a name="l00472"></a>00472 
<a name="l00473"></a>00473         <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#aa2d0f1f8a9385144d77a0b9a229b18fe" title="total number of points">numPoints</a> = points.size();
<a name="l00474"></a>00474         <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a5929b560ec034d7e89d94a46b9c833f9" title="number of dimensions">numDims</a> = points.get(0).numAttributes()-1;
<a name="l00475"></a>00475         <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#ac1ef13e27a75f32996e8345f84104ab3" title="number of clusters of the original ground truth">numGTClusters</a> = <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#ae20bc1ec5e8cf6c8e9c4f7d3946d41d9" title="the given ground truth clustering">gtClustering</a>.<a class="code" href="classmoa_1_1cluster_1_1Clustering.html#a054a386d94acf3b88574f061ab4c8d71">size</a>();
<a name="l00476"></a>00476 
<a name="l00477"></a>00477         <span class="comment">//init mappings between work and true labels</span>
<a name="l00478"></a>00478         <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#aec394c5b7fa779b1be6ae62d67a5605a" title="mapping between true cluster ID/class label of the original ground truth and the...">mapTrueLabelToWorkLabel</a> = <span class="keyword">new</span> HashMap&lt;Integer, Integer&gt;();
<a name="l00479"></a>00479         
<a name="l00480"></a>00480         <span class="comment">//set up base of new clustering</span>
<a name="l00481"></a>00481         <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a7cc6f53a872eae41a64946e52d018b3c" title="the newly calculate ground truth clustering">gt0Clusters</a> = <span class="keyword">new</span> ArrayList&lt;GTCluster&gt;();
<a name="l00482"></a>00482         <span class="keywordtype">int</span> numWorkClasses = 0;
<a name="l00483"></a>00483         <span class="comment">//create label to worklabel mapping as real labels can be just a set of unordered integers</span>
<a name="l00484"></a>00484         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#ac1ef13e27a75f32996e8345f84104ab3" title="number of clusters of the original ground truth">numGTClusters</a>; i++) {
<a name="l00485"></a>00485             <span class="keywordtype">int</span> label = (int)<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#ae20bc1ec5e8cf6c8e9c4f7d3946d41d9" title="the given ground truth clustering">gtClustering</a>.<a class="code" href="classmoa_1_1cluster_1_1Clustering.html#a6a66be9b90f5cb06b044da278cdf24c9" title="remove a cluster from the clustering">get</a>(i).<a class="code" href="classmoa_1_1cluster_1_1Cluster.html#a8be46287f76d14e83567381c23581d3b">getGroundTruth</a>();
<a name="l00486"></a>00486             <span class="keywordflow">if</span>(!<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#aec394c5b7fa779b1be6ae62d67a5605a" title="mapping between true cluster ID/class label of the original ground truth and the...">mapTrueLabelToWorkLabel</a>.containsKey(label)){
<a name="l00487"></a>00487                 gt0Clusters.add(<span class="keyword">new</span> <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html" title="Main class to model the new clusters that will be the output of the cluster analysis...">GTCluster</a>(numWorkClasses,label,i));
<a name="l00488"></a>00488                 <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#aec394c5b7fa779b1be6ae62d67a5605a" title="mapping between true cluster ID/class label of the original ground truth and the...">mapTrueLabelToWorkLabel</a>.put(label,numWorkClasses);
<a name="l00489"></a>00489                 numWorkClasses++;
<a name="l00490"></a>00490             }
<a name="l00491"></a>00491             <span class="keywordflow">else</span>{
<a name="l00492"></a>00492                 gt0Clusters.get(<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#aec394c5b7fa779b1be6ae62d67a5605a" title="mapping between true cluster ID/class label of the original ground truth and the...">mapTrueLabelToWorkLabel</a>.get(label)).clusterRepresentations.add(i);
<a name="l00493"></a>00493             }
<a name="l00494"></a>00494         }
<a name="l00495"></a>00495         <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a192432eab53d9e63790f1884deb28ad6" title="number of classes of the original ground truth, in case of a micro clustering ground...">numGTClasses</a> = numWorkClasses;
<a name="l00496"></a>00496 
<a name="l00497"></a>00497         <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a8e2b007362023af2e309f1d42b4ff41f" title="log of how clusters have been merged (for debugging)">mergeMap</a> = <span class="keyword">new</span> <span class="keywordtype">int</span>[<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a192432eab53d9e63790f1884deb28ad6" title="number of classes of the original ground truth, in case of a micro clustering ground...">numGTClasses</a>];
<a name="l00498"></a>00498         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a192432eab53d9e63790f1884deb28ad6" title="number of classes of the original ground truth, in case of a micro clustering ground...">numGTClasses</a>; i++) {
<a name="l00499"></a>00499             <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a8e2b007362023af2e309f1d42b4ff41f" title="log of how clusters have been merged (for debugging)">mergeMap</a>[i]=i;
<a name="l00500"></a>00500         }
<a name="l00501"></a>00501 
<a name="l00502"></a>00502         <span class="comment">//create cmd point wrapper instances</span>
<a name="l00503"></a>00503         <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a0965fbdb68d33beb80c3eacdbfbae23a" title="list of given points within the horizon">cmmpoints</a> = <span class="keyword">new</span> ArrayList&lt;CMMPoint&gt;();
<a name="l00504"></a>00504         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> p = 0; p &lt; points.size(); p++) {
<a name="l00505"></a>00505             <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1CMMPoint.html" title="Wrapper class for data points to store CMM relevant attributes.">CMMPoint</a> cmdp = <span class="keyword">new</span> <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1CMMPoint.html" title="Wrapper class for data points to store CMM relevant attributes.">CMMPoint</a>(points.get(p), p);
<a name="l00506"></a>00506             <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a0965fbdb68d33beb80c3eacdbfbae23a" title="list of given points within the horizon">cmmpoints</a>.add(cmdp);
<a name="l00507"></a>00507         }
<a name="l00508"></a>00508 
<a name="l00509"></a>00509 
<a name="l00510"></a>00510         <span class="comment">//split points up into their GTClusters and Noise (according to class labels)</span>
<a name="l00511"></a>00511         <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#ae127ba2ccbd6473eecee957166376b01" title="IDs of noise points.">noise</a> = <span class="keyword">new</span> ArrayList&lt;Integer&gt;();
<a name="l00512"></a>00512         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> p = 0; p &lt; <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#aa2d0f1f8a9385144d77a0b9a229b18fe" title="total number of points">numPoints</a>; p++) {
<a name="l00513"></a>00513             <span class="keywordflow">if</span>(<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a0965fbdb68d33beb80c3eacdbfbae23a" title="list of given points within the horizon">cmmpoints</a>.get(p).isNoise()){
<a name="l00514"></a>00514                 <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#ae127ba2ccbd6473eecee957166376b01" title="IDs of noise points.">noise</a>.add(p);
<a name="l00515"></a>00515             }
<a name="l00516"></a>00516             <span class="keywordflow">else</span>{
<a name="l00517"></a>00517                 gt0Clusters.get(<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a0965fbdb68d33beb80c3eacdbfbae23a" title="list of given points within the horizon">cmmpoints</a>.get(p).workclass()).points.add(p);
<a name="l00518"></a>00518             }
<a name="l00519"></a>00519         }
<a name="l00520"></a>00520 
<a name="l00521"></a>00521         <span class="comment">//calculate initial knnMean and knnDev</span>
<a name="l00522"></a>00522         <span class="keywordflow">for</span> (<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html" title="Main class to model the new clusters that will be the output of the cluster analysis...">GTCluster</a> gtc : gt0Clusters) {
<a name="l00523"></a>00523             gtc.calculateKnn();
<a name="l00524"></a>00524         }
<a name="l00525"></a>00525 
<a name="l00526"></a>00526         <span class="comment">//calculate cluster connections</span>
<a name="l00527"></a>00527         <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a1b5233802d3c226528fc633eac344280" title="Calculate connections between clusters and merge clusters accordingly as long as...">calculateGTClusterConnections</a>();
<a name="l00528"></a>00528 
<a name="l00529"></a>00529         <span class="comment">//calculate point connections with own clusters</span>
<a name="l00530"></a>00530         <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a9c1e7ad3767a13b46a47e49a9a4de041" title="calculate initial connectivities">calculateGTPointQualities</a>();
<a name="l00531"></a>00531 
<a name="l00532"></a>00532         <span class="keywordflow">if</span>(<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a62bebded5af1f26fae7be62e14dcf2ec" title="CMM debug mode.">debug</a>)
<a name="l00533"></a>00533             System.out.println(<span class="stringliteral">&quot;GT Analysis Debug End&quot;</span>);
<a name="l00534"></a>00534 
<a name="l00535"></a>00535    }
<a name="l00536"></a>00536 
<a name="l00544"></a>00544     <span class="comment">//TODO: Cache the connection value for a point to the different clusters???</span>
<a name="l00545"></a><a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a794b653c2c7b7335127f6ca7720ec5ab">00545</a>     <span class="keyword">protected</span> <span class="keywordtype">double</span> <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a794b653c2c7b7335127f6ca7720ec5ab" title="Calculate the connection of a point to a cluster.">getConnectionValue</a>(<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1CMMPoint.html" title="Wrapper class for data points to store CMM relevant attributes.">CMMPoint</a> cmmp, <span class="keywordtype">int</span> clusterID){
<a name="l00546"></a>00546         AutoExpandVector&lt;Double&gt; knnDist = <span class="keyword">new</span> AutoExpandVector&lt;Double&gt;();
<a name="l00547"></a>00547         AutoExpandVector&lt;Integer&gt; knnPointIndex = <span class="keyword">new</span> AutoExpandVector&lt;Integer&gt;();
<a name="l00548"></a>00548         
<a name="l00549"></a>00549         <span class="comment">//calculate the knn distance of the point to the cluster</span>
<a name="l00550"></a>00550         <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a12f256dabb3d986447d1d0b74a9a0dbc">getKnnInCluster</a>(cmmp, <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#aab0bccf5e6ea62738572a224b96787fc" title="defines how many nearest neighbors will be used">knnNeighbourhood</a>, <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a7cc6f53a872eae41a64946e52d018b3c" title="the newly calculate ground truth clustering">gt0Clusters</a>.get(clusterID).points, knnDist, knnPointIndex);
<a name="l00551"></a>00551 
<a name="l00552"></a>00552         <span class="comment">//TODO: What to do if we have less then k neighbors?</span>
<a name="l00553"></a>00553         <span class="keywordtype">double</span> avgDist = 0;
<a name="l00554"></a>00554         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; knnDist.size(); i++) {
<a name="l00555"></a>00555             avgDist+= knnDist.get(i);
<a name="l00556"></a>00556         }
<a name="l00557"></a>00557         <span class="comment">//what to do if we only have a single point???</span>
<a name="l00558"></a>00558         <span class="keywordflow">if</span>(knnDist.size()!=0)
<a name="l00559"></a>00559             avgDist/=knnDist.size();
<a name="l00560"></a>00560         <span class="keywordflow">else</span>
<a name="l00561"></a>00561             <span class="keywordflow">return</span> 0;
<a name="l00562"></a>00562 
<a name="l00563"></a>00563         <span class="comment">//get the upper knn distance of the cluster</span>
<a name="l00564"></a>00564         <span class="keywordtype">double</span> upperKnn = <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a7cc6f53a872eae41a64946e52d018b3c" title="the newly calculate ground truth clustering">gt0Clusters</a>.get(clusterID).knnMeanAvg + <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a7cc6f53a872eae41a64946e52d018b3c" title="the newly calculate ground truth clustering">gt0Clusters</a>.get(clusterID).knnDevAvg;
<a name="l00565"></a>00565         
<a name="l00566"></a>00566         <span class="comment">/* calculate the connectivity based on knn distance of the point within the cluster</span>
<a name="l00567"></a>00567 <span class="comment">           and the upper knn distance of the cluster*/</span> 
<a name="l00568"></a>00568         <span class="keywordflow">if</span>(avgDist &lt; upperKnn){
<a name="l00569"></a>00569             <span class="keywordflow">return</span> 1;
<a name="l00570"></a>00570         }
<a name="l00571"></a>00571         <span class="keywordflow">else</span>{
<a name="l00572"></a>00572             <span class="comment">//value that should be reached at upperKnn distance</span>
<a name="l00573"></a>00573             <span class="comment">//Choose connection formula</span>
<a name="l00574"></a>00574             <span class="keywordtype">double</span> conn;
<a name="l00575"></a>00575             <span class="keywordflow">if</span>(<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a7ccfd650aef6e8fe584eee218d79203b" title="experimental (default: disabled) use exponential connectivity function to model different...">useExpConnectivity</a>)
<a name="l00576"></a>00576                 conn = Math.pow(2,-<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#ac668bdacbf7a57caa60b5f376665705e">lamdaConn</a>*(avgDist-upperKnn)/upperKnn);
<a name="l00577"></a>00577             <span class="keywordflow">else</span>
<a name="l00578"></a>00578                 conn = upperKnn/avgDist;
<a name="l00579"></a>00579 
<a name="l00580"></a>00580             <span class="keywordflow">if</span>(Double.isNaN(conn))
<a name="l00581"></a>00581                 System.out.println(<span class="stringliteral">&quot;Connectivity NaN at &quot;</span>+cmmp.<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1CMMPoint.html#a63b8005f05e1980f211e5966e43abfbe" title="Reference to original point.">p</a>.<a class="code" href="classmoa_1_1gui_1_1visualization_1_1DataPoint.html#a2a969caa225b25dce49d0e0caba03037">getTimestamp</a>());
<a name="l00582"></a>00582 
<a name="l00583"></a>00583             <span class="keywordflow">return</span> conn;
<a name="l00584"></a>00584         }
<a name="l00585"></a>00585     }
<a name="l00586"></a>00586 
<a name="l00587"></a>00587     
<a name="l00595"></a><a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a12f256dabb3d986447d1d0b74a9a0dbc">00595</a>     <span class="keyword">private</span> <span class="keywordtype">void</span> <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a12f256dabb3d986447d1d0b74a9a0dbc">getKnnInCluster</a>(<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1CMMPoint.html" title="Wrapper class for data points to store CMM relevant attributes.">CMMPoint</a> cmmp, <span class="keywordtype">int</span> k,
<a name="l00596"></a>00596                                  ArrayList&lt;Integer&gt; pointIDs,
<a name="l00597"></a>00597                                  AutoExpandVector&lt;Double&gt; knnDist,
<a name="l00598"></a>00598                                  AutoExpandVector&lt;Integer&gt; knnPointIndex) {
<a name="l00599"></a>00599 
<a name="l00600"></a>00600         <span class="comment">//iterate over every point in the choosen cluster, cal distance and insert into list</span>
<a name="l00601"></a>00601         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> p1 = 0; p1 &lt; pointIDs.size(); p1++) {
<a name="l00602"></a>00602             <span class="keywordtype">int</span> pid = pointIDs.get(p1);
<a name="l00603"></a>00603             <span class="keywordflow">if</span>(cmmp.<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1CMMPoint.html#a6ceb48d5c944fe18c1d75a8f46f28a49" title="point ID">pID</a> == pid) <span class="keywordflow">continue</span>;
<a name="l00604"></a>00604             <span class="keywordtype">double</span> dist = <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a0d6e0c9cce76d83d7edbc65a3bacb315" title="Calculates Euclidian distance.">distance</a>(cmmp,<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a0965fbdb68d33beb80c3eacdbfbae23a" title="list of given points within the horizon">cmmpoints</a>.get(pid));
<a name="l00605"></a>00605             <span class="keywordflow">if</span>(knnDist.size() &lt; k || dist &lt; knnDist.get(knnDist.size()-1)){
<a name="l00606"></a>00606                 <span class="keywordtype">int</span> index = 0;
<a name="l00607"></a>00607                 <span class="keywordflow">while</span>(index &lt; knnDist.size() &amp;&amp; dist &gt; knnDist.get(index)) {
<a name="l00608"></a>00608                     index++;
<a name="l00609"></a>00609                 }
<a name="l00610"></a>00610                 knnDist.add(index, dist);
<a name="l00611"></a>00611                 knnPointIndex.add(index,pid);
<a name="l00612"></a>00612                 <span class="keywordflow">if</span>(knnDist.size() &gt; k){
<a name="l00613"></a>00613                     knnDist.remove(knnDist.size()-1);
<a name="l00614"></a>00614                     knnPointIndex.remove(knnPointIndex.size()-1);
<a name="l00615"></a>00615                 }
<a name="l00616"></a>00616             }
<a name="l00617"></a>00617         }
<a name="l00618"></a>00618     }
<a name="l00619"></a>00619 
<a name="l00620"></a>00620 
<a name="l00621"></a>00621     
<a name="l00625"></a><a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a9c1e7ad3767a13b46a47e49a9a4de041">00625</a>     <span class="keyword">private</span> <span class="keywordtype">void</span> <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a9c1e7ad3767a13b46a47e49a9a4de041" title="calculate initial connectivities">calculateGTPointQualities</a>(){
<a name="l00626"></a>00626         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> p = 0; p &lt; <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#aa2d0f1f8a9385144d77a0b9a229b18fe" title="total number of points">numPoints</a>; p++) {
<a name="l00627"></a>00627             <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1CMMPoint.html" title="Wrapper class for data points to store CMM relevant attributes.">CMMPoint</a> cmdp = <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a0965fbdb68d33beb80c3eacdbfbae23a" title="list of given points within the horizon">cmmpoints</a>.get(p);
<a name="l00628"></a>00628             <span class="keywordflow">if</span>(!cmdp.<a class="code" href="classmoa_1_1gui_1_1visualization_1_1DataPoint.html#a346207ffb1974293b5d67cf10656ef3d">isNoise</a>()){
<a name="l00629"></a>00629                 cmdp.<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1CMMPoint.html#ae661e81945ef9785f9b0777665010dc2" title="the connectivity of the point to its cluster">connectivity</a> = <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a794b653c2c7b7335127f6ca7720ec5ab" title="Calculate the connection of a point to a cluster.">getConnectionValue</a>(cmdp, cmdp.<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1CMMPoint.html#ae69d6c93ab345ead82db85e885af44ad" title="Retruns the current working label of the cluster the point belongs to.">workclass</a>());
<a name="l00630"></a>00630                 cmdp.<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1CMMPoint.html#a63b8005f05e1980f211e5966e43abfbe" title="Reference to original point.">p</a>.<a class="code" href="classmoa_1_1gui_1_1visualization_1_1DataPoint.html#ae785a3bf303998016133b7d56566a920">setMeasureValue</a>(<span class="stringliteral">&quot;Connectivity&quot;</span>, cmdp.<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1CMMPoint.html#ae661e81945ef9785f9b0777665010dc2" title="the connectivity of the point to its cluster">connectivity</a>);
<a name="l00631"></a>00631             }
<a name="l00632"></a>00632         }
<a name="l00633"></a>00633     }
<a name="l00634"></a>00634 
<a name="l00635"></a>00635     
<a name="l00636"></a>00636     
<a name="l00641"></a><a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a1b5233802d3c226528fc633eac344280">00641</a>     <span class="keyword">private</span> <span class="keywordtype">void</span> <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a1b5233802d3c226528fc633eac344280" title="Calculate connections between clusters and merge clusters accordingly as long as...">calculateGTClusterConnections</a>(){
<a name="l00642"></a>00642         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> c0 = 0; c0 &lt; <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a7cc6f53a872eae41a64946e52d018b3c" title="the newly calculate ground truth clustering">gt0Clusters</a>.size(); c0++) {
<a name="l00643"></a>00643             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> c1 = 0; c1 &lt; <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a7cc6f53a872eae41a64946e52d018b3c" title="the newly calculate ground truth clustering">gt0Clusters</a>.size(); c1++) {
<a name="l00644"></a>00644                     <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a7cc6f53a872eae41a64946e52d018b3c" title="the newly calculate ground truth clustering">gt0Clusters</a>.get(c0).calculateClusterConnection(c1, <span class="keyword">true</span>);
<a name="l00645"></a>00645             }
<a name="l00646"></a>00646         }
<a name="l00647"></a>00647 
<a name="l00648"></a>00648         <span class="keywordtype">boolean</span> changedConnection = <span class="keyword">true</span>;
<a name="l00649"></a>00649         <span class="keywordflow">while</span>(changedConnection){
<a name="l00650"></a>00650             <span class="keywordflow">if</span>(<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a62bebded5af1f26fae7be62e14dcf2ec" title="CMM debug mode.">debug</a>){
<a name="l00651"></a>00651                 System.out.println(<span class="stringliteral">&quot;Cluster Connection&quot;</span>);
<a name="l00652"></a>00652                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> c = 0; c &lt; <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a7cc6f53a872eae41a64946e52d018b3c" title="the newly calculate ground truth clustering">gt0Clusters</a>.size(); c++) {
<a name="l00653"></a>00653                     System.out.print(<span class="stringliteral">&quot;C&quot;</span>+<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a7cc6f53a872eae41a64946e52d018b3c" title="the newly calculate ground truth clustering">gt0Clusters</a>.get(c).label+<span class="stringliteral">&quot; --&gt; &quot;</span>);
<a name="l00654"></a>00654                     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> c1 = 0; c1 &lt; <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a7cc6f53a872eae41a64946e52d018b3c" title="the newly calculate ground truth clustering">gt0Clusters</a>.get(c).connections.size(); c1++) {
<a name="l00655"></a>00655                         System.out.print(<span class="stringliteral">&quot; C&quot;</span>+<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a7cc6f53a872eae41a64946e52d018b3c" title="the newly calculate ground truth clustering">gt0Clusters</a>.get(c1).label+<span class="stringliteral">&quot;: &quot;</span>+<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a7cc6f53a872eae41a64946e52d018b3c" title="the newly calculate ground truth clustering">gt0Clusters</a>.get(c).connections.get(c1));
<a name="l00656"></a>00656                     }
<a name="l00657"></a>00657                     System.out.println(<span class="stringliteral">&quot;&quot;</span>);
<a name="l00658"></a>00658                 }
<a name="l00659"></a>00659                 System.out.println(<span class="stringliteral">&quot;&quot;</span>);
<a name="l00660"></a>00660             }
<a name="l00661"></a>00661 
<a name="l00662"></a>00662             <span class="keywordtype">double</span> max = 0;
<a name="l00663"></a>00663             <span class="keywordtype">int</span> maxIndexI = -1;
<a name="l00664"></a>00664             <span class="keywordtype">int</span> maxIndexJ = -1;
<a name="l00665"></a>00665 
<a name="l00666"></a>00666             changedConnection = <span class="keyword">false</span>;
<a name="l00667"></a>00667             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> c0 = 0; c0 &lt; <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a7cc6f53a872eae41a64946e52d018b3c" title="the newly calculate ground truth clustering">gt0Clusters</a>.size(); c0++) {
<a name="l00668"></a>00668                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> c1 = c0+1; c1 &lt; <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a7cc6f53a872eae41a64946e52d018b3c" title="the newly calculate ground truth clustering">gt0Clusters</a>.size(); c1++) {
<a name="l00669"></a>00669                     <span class="keywordflow">if</span>(c0==c1) <span class="keywordflow">continue</span>;
<a name="l00670"></a>00670                         <span class="keywordtype">double</span> min =Math.min(<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a7cc6f53a872eae41a64946e52d018b3c" title="the newly calculate ground truth clustering">gt0Clusters</a>.get(c0).connections.get(c1), <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a7cc6f53a872eae41a64946e52d018b3c" title="the newly calculate ground truth clustering">gt0Clusters</a>.get(c1).connections.get(c0));
<a name="l00671"></a>00671                         <span class="keywordflow">if</span>(min &gt; max){
<a name="l00672"></a>00672                             max = min;
<a name="l00673"></a>00673                             maxIndexI = c0;
<a name="l00674"></a>00674                             maxIndexJ = c1;
<a name="l00675"></a>00675                         }
<a name="l00676"></a>00676                 }
<a name="l00677"></a>00677             }
<a name="l00678"></a>00678             <span class="keywordflow">if</span>(maxIndexI!=-1 &amp;&amp; max &gt; <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a91801ca91918ceff8edb511d568ee851" title="the threshold which defines when ground truth clusters will be merged.">tauConnection</a>){
<a name="l00679"></a>00679                 <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a7cc6f53a872eae41a64946e52d018b3c" title="the newly calculate ground truth clustering">gt0Clusters</a>.get(maxIndexI).mergeCluster(maxIndexJ);
<a name="l00680"></a>00680                 <span class="keywordflow">if</span>(<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a62bebded5af1f26fae7be62e14dcf2ec" title="CMM debug mode.">debug</a>)
<a name="l00681"></a>00681                     System.out.println(<span class="stringliteral">&quot;Merging &quot;</span>+maxIndexI+<span class="stringliteral">&quot; and &quot;</span>+maxIndexJ+<span class="stringliteral">&quot; because of connection &quot;</span>+max);
<a name="l00682"></a>00682 
<a name="l00683"></a>00683                 changedConnection = <span class="keyword">true</span>;
<a name="l00684"></a>00684             }
<a name="l00685"></a>00685         }
<a name="l00686"></a>00686         <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#ae20eee4960c0ab1c46945ae0ddceabc5" title="number of classes after we are done with the analysis">numGT0Classes</a> = <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a7cc6f53a872eae41a64946e52d018b3c" title="the newly calculate ground truth clustering">gt0Clusters</a>.size();
<a name="l00687"></a>00687     }
<a name="l00688"></a>00688 
<a name="l00689"></a>00689     
<a name="l00695"></a><a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a1cd4b963a4b6b34f7f7eb5ab5bb5877e">00695</a>     <span class="keyword">public</span> <span class="keywordtype">double</span> <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a1cd4b963a4b6b34f7f7eb5ab5bb5877e" title="Calculates how well the original clusters are separable.">getClassSeparability</a>(){
<a name="l00696"></a>00696 <span class="comment">//        int totalConn = numGTClasses*(numGTClasses-1)/2;</span>
<a name="l00697"></a>00697 <span class="comment">//        int mergedConn = 0;</span>
<a name="l00698"></a>00698 <span class="comment">//        for(GTCluster gt : gt0Clusters){</span>
<a name="l00699"></a>00699 <span class="comment">//            int merged = gt.clusterRepresentations.size();</span>
<a name="l00700"></a>00700 <span class="comment">//            if(merged &gt; 1)</span>
<a name="l00701"></a>00701 <span class="comment">//                mergedConn+=merged * (merged-1)/2;</span>
<a name="l00702"></a>00702 <span class="comment">//        }</span>
<a name="l00703"></a>00703 <span class="comment">//        if(totalConn == 0)</span>
<a name="l00704"></a>00704 <span class="comment">//            return 0;</span>
<a name="l00705"></a>00705 <span class="comment">//        else</span>
<a name="l00706"></a>00706 <span class="comment">//            return 1-mergedConn/(double)totalConn;</span>
<a name="l00707"></a>00707         <span class="keywordflow">return</span> <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#ae20eee4960c0ab1c46945ae0ddceabc5" title="number of classes after we are done with the analysis">numGT0Classes</a>/(double)<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a192432eab53d9e63790f1884deb28ad6" title="number of classes of the original ground truth, in case of a micro clustering ground...">numGTClasses</a>;
<a name="l00708"></a>00708 
<a name="l00709"></a>00709     }
<a name="l00710"></a>00710 
<a name="l00711"></a>00711     
<a name="l00717"></a><a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a5f44be6f2df9384d281d5ac9fb741bb9">00717</a>     <span class="keyword">public</span> <span class="keywordtype">double</span> <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a5f44be6f2df9384d281d5ac9fb741bb9" title="Calculates how well noise is separable from the given clusters Small values indicate...">getNoiseSeparability</a>(){
<a name="l00718"></a>00718         <span class="keywordflow">if</span>(<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#ae127ba2ccbd6473eecee957166376b01" title="IDs of noise points.">noise</a>.isEmpty()) 
<a name="l00719"></a>00719             <span class="keywordflow">return</span> 1;
<a name="l00720"></a>00720 
<a name="l00721"></a>00721         <span class="keywordtype">double</span> connectivity = 0;
<a name="l00722"></a>00722         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> p : <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#ae127ba2ccbd6473eecee957166376b01" title="IDs of noise points.">noise</a>){
<a name="l00723"></a>00723             <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1CMMPoint.html" title="Wrapper class for data points to store CMM relevant attributes.">CMMPoint</a> npoint = <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a0965fbdb68d33beb80c3eacdbfbae23a" title="list of given points within the horizon">cmmpoints</a>.get(p);
<a name="l00724"></a>00724             <span class="keywordtype">double</span> maxConnection = 0;
<a name="l00725"></a>00725 
<a name="l00726"></a>00726             <span class="comment">//TODO: some kind of pruning possible. what about weighting?</span>
<a name="l00727"></a>00727             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> c = 0; c &lt; <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a7cc6f53a872eae41a64946e52d018b3c" title="the newly calculate ground truth clustering">gt0Clusters</a>.size(); c++) {
<a name="l00728"></a>00728                 <span class="keywordtype">double</span> connection = <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a794b653c2c7b7335127f6ca7720ec5ab" title="Calculate the connection of a point to a cluster.">getConnectionValue</a>(npoint, c);
<a name="l00729"></a>00729                 <span class="keywordflow">if</span>(connection &gt; maxConnection)
<a name="l00730"></a>00730                     maxConnection = connection;
<a name="l00731"></a>00731             }
<a name="l00732"></a>00732             connectivity+=maxConnection;
<a name="l00733"></a>00733             npoint.<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1CMMPoint.html#a63b8005f05e1980f211e5966e43abfbe" title="Reference to original point.">p</a>.<a class="code" href="classmoa_1_1gui_1_1visualization_1_1DataPoint.html#ae785a3bf303998016133b7d56566a920">setMeasureValue</a>(<span class="stringliteral">&quot;MaxConnection&quot;</span>, maxConnection);
<a name="l00734"></a>00734         }
<a name="l00735"></a>00735 
<a name="l00736"></a>00736         <span class="keywordflow">return</span> 1-(connectivity / noise.size());
<a name="l00737"></a>00737     }
<a name="l00738"></a>00738 
<a name="l00739"></a>00739     
<a name="l00744"></a><a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#ac62e2f616277de082896f6b0708451b9">00744</a>     <span class="keyword">public</span> <span class="keywordtype">double</span> <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#ac62e2f616277de082896f6b0708451b9" title="Calculates the relative number of errors being caused by the underlying cluster model...">getModelQuality</a>(){
<a name="l00745"></a>00745         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> p = 0; p &lt; <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#aa2d0f1f8a9385144d77a0b9a229b18fe" title="total number of points">numPoints</a>; p++){
<a name="l00746"></a>00746             <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1CMMPoint.html" title="Wrapper class for data points to store CMM relevant attributes.">CMMPoint</a> cmdp = <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a0965fbdb68d33beb80c3eacdbfbae23a" title="list of given points within the horizon">cmmpoints</a>.get(p);
<a name="l00747"></a>00747             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> hc = 0; hc &lt; <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#ac1ef13e27a75f32996e8345f84104ab3" title="number of clusters of the original ground truth">numGTClusters</a>;hc++){
<a name="l00748"></a>00748                 <span class="keywordflow">if</span>(<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#ae20bc1ec5e8cf6c8e9c4f7d3946d41d9" title="the given ground truth clustering">gtClustering</a>.<a class="code" href="classmoa_1_1cluster_1_1Clustering.html#a6a66be9b90f5cb06b044da278cdf24c9" title="remove a cluster from the clustering">get</a>(hc).<a class="code" href="classmoa_1_1cluster_1_1Cluster.html#a8be46287f76d14e83567381c23581d3b">getGroundTruth</a>() != cmdp.<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1CMMPoint.html#a91ffbd91a4000e61410340ef9415ad2b" title="true class label">trueClass</a>){
<a name="l00749"></a>00749                     <span class="keywordflow">if</span>(<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#ae20bc1ec5e8cf6c8e9c4f7d3946d41d9" title="the given ground truth clustering">gtClustering</a>.<a class="code" href="classmoa_1_1cluster_1_1Clustering.html#a6a66be9b90f5cb06b044da278cdf24c9" title="remove a cluster from the clustering">get</a>(hc).<a class="code" href="classmoa_1_1cluster_1_1Cluster.html#abf05802928ccf0ebe145e00c3568944b" title="Returns the probability of the given point belonging to this cluster.">getInclusionProbability</a>(cmdp) &gt;= 1){
<a name="l00750"></a>00750                         <span class="keywordflow">if</span>(!cmdp.<a class="code" href="classmoa_1_1gui_1_1visualization_1_1DataPoint.html#a346207ffb1974293b5d67cf10656ef3d">isNoise</a>())
<a name="l00751"></a>00751                             <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a494e4390e05aff2f7e2440ac9ae81b8f" title="number of noise points that will create an error due to the underlying clustering...">pointErrorByModel</a>++;
<a name="l00752"></a>00752                         <span class="keywordflow">else</span>
<a name="l00753"></a>00753                             <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a14641ffe1cea7697d92152c4dfbe2c08" title="number of non-noise points that will create an error due to the underlying clustering...">noiseErrorByModel</a>++;
<a name="l00754"></a>00754                         <span class="keywordflow">break</span>;
<a name="l00755"></a>00755                     }
<a name="l00756"></a>00756                 }
<a name="l00757"></a>00757             }
<a name="l00758"></a>00758         }
<a name="l00759"></a>00759         <span class="keywordflow">if</span>(<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a62bebded5af1f26fae7be62e14dcf2ec" title="CMM debug mode.">debug</a>)
<a name="l00760"></a>00760             System.out.println(<span class="stringliteral">&quot;Error by model: noise &quot;</span>+<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a14641ffe1cea7697d92152c4dfbe2c08" title="number of non-noise points that will create an error due to the underlying clustering...">noiseErrorByModel</a>+<span class="stringliteral">&quot; point &quot;</span>+<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a494e4390e05aff2f7e2440ac9ae81b8f" title="number of noise points that will create an error due to the underlying clustering...">pointErrorByModel</a>);
<a name="l00761"></a>00761 
<a name="l00762"></a>00762         <span class="keywordflow">return</span> 1-((<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a494e4390e05aff2f7e2440ac9ae81b8f" title="number of noise points that will create an error due to the underlying clustering...">pointErrorByModel</a> + <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a14641ffe1cea7697d92152c4dfbe2c08" title="number of non-noise points that will create an error due to the underlying clustering...">noiseErrorByModel</a>)/(<span class="keywordtype">double</span>) numPoints);
<a name="l00763"></a>00763     }
<a name="l00764"></a>00764 
<a name="l00765"></a>00765     
<a name="l00771"></a><a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#ab51995be418ac5ce4804c20c03ccfdec">00771</a>     <span class="keyword">protected</span> <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1CMMPoint.html" title="Wrapper class for data points to store CMM relevant attributes.">CMMPoint</a> <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#ab51995be418ac5ce4804c20c03ccfdec" title="Get CMM internal point.">getPoint</a>(<span class="keywordtype">int</span> index){
<a name="l00772"></a>00772         <span class="keywordflow">return</span> <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a0965fbdb68d33beb80c3eacdbfbae23a" title="list of given points within the horizon">cmmpoints</a>.get(index);
<a name="l00773"></a>00773     }
<a name="l00774"></a>00774 
<a name="l00775"></a>00775     
<a name="l00781"></a><a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a2be0eba421cfefb98188c587657d17ac">00781</a>     <span class="keyword">protected</span> <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis_1_1GTCluster.html" title="Main class to model the new clusters that will be the output of the cluster analysis...">GTCluster</a> <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a2be0eba421cfefb98188c587657d17ac" title="Return cluster.">getGT0Cluster</a>(<span class="keywordtype">int</span> index){
<a name="l00782"></a>00782         <span class="keywordflow">return</span> <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a7cc6f53a872eae41a64946e52d018b3c" title="the newly calculate ground truth clustering">gt0Clusters</a>.get(index);
<a name="l00783"></a>00783     }
<a name="l00784"></a>00784 
<a name="l00789"></a><a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a46eb1352fe6d1ce88523316e5545ae0d">00789</a>     <span class="keyword">protected</span> <span class="keywordtype">int</span> <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a46eb1352fe6d1ce88523316e5545ae0d" title="Number of classes/clusters of the new clustering.">getNumberOfGT0Classes</a>() {
<a name="l00790"></a>00790         <span class="keywordflow">return</span> <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#ae20eee4960c0ab1c46945ae0ddceabc5" title="number of classes after we are done with the analysis">numGT0Classes</a>;
<a name="l00791"></a>00791     }
<a name="l00792"></a>00792     
<a name="l00799"></a><a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a0d6e0c9cce76d83d7edbc65a3bacb315">00799</a>     <span class="keyword">private</span> <span class="keywordtype">double</span> <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a0d6e0c9cce76d83d7edbc65a3bacb315" title="Calculates Euclidian distance.">distance</a>(Instance inst1, Instance inst2){
<a name="l00800"></a>00800           <span class="keywordflow">return</span> <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a0d6e0c9cce76d83d7edbc65a3bacb315" title="Calculates Euclidian distance.">distance</a>(inst1, inst2.toDoubleArray());
<a name="l00801"></a>00801 
<a name="l00802"></a>00802     }
<a name="l00803"></a>00803     
<a name="l00810"></a><a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a0960217ed3b00d28d2b62694263e3126">00810</a>     <span class="keyword">private</span> <span class="keywordtype">double</span> <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a0960217ed3b00d28d2b62694263e3126" title="Calculates Euclidian distance.">distance</a>(Instance inst1, <span class="keywordtype">double</span>[] inst2){
<a name="l00811"></a>00811         <span class="keywordtype">double</span> <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a0d6e0c9cce76d83d7edbc65a3bacb315" title="Calculates Euclidian distance.">distance</a> = 0.0;
<a name="l00812"></a>00812         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a5929b560ec034d7e89d94a46b9c833f9" title="number of dimensions">numDims</a>; i++) {
<a name="l00813"></a>00813             <span class="keywordtype">double</span> d = inst1.value(i) - inst2[i];
<a name="l00814"></a>00814             distance += d * d;
<a name="l00815"></a>00815         }
<a name="l00816"></a>00816         <span class="keywordflow">return</span> Math.sqrt(distance);
<a name="l00817"></a>00817     }
<a name="l00818"></a>00818     
<a name="l00823"></a><a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#aa64e316da13b9a001554536d4d72d1da">00823</a>     <span class="keyword">public</span> String <a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#aa64e316da13b9a001554536d4d72d1da" title="String with main CMM parameters.">getParameterString</a>(){
<a name="l00824"></a>00824         String para = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00825"></a>00825         para+=<span class="stringliteral">&quot;k=&quot;</span>+<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#aab0bccf5e6ea62738572a224b96787fc" title="defines how many nearest neighbors will be used">knnNeighbourhood</a>+<span class="stringliteral">&quot;;&quot;</span>;
<a name="l00826"></a>00826         <span class="keywordflow">if</span>(<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a7ccfd650aef6e8fe584eee218d79203b" title="experimental (default: disabled) use exponential connectivity function to model different...">useExpConnectivity</a>){
<a name="l00827"></a>00827             para+=<span class="stringliteral">&quot;lambdaConnX=&quot;</span>+<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a6fcfbef25132f0ccea2cfa77060ac205">lambdaConnX</a>+<span class="stringliteral">&quot;;&quot;</span>;
<a name="l00828"></a>00828             para+=<span class="stringliteral">&quot;lambdaConn=&quot;</span>+<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#ac668bdacbf7a57caa60b5f376665705e">lamdaConn</a>+<span class="stringliteral">&quot;;&quot;</span>;
<a name="l00829"></a>00829             para+=<span class="stringliteral">&quot;lambdaConnRef=&quot;</span>+<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#aa0d61c06230991b95f84b502eda6e870">lambdaConnRefXValue</a>+<span class="stringliteral">&quot;;&quot;</span>;
<a name="l00830"></a>00830         }
<a name="l00831"></a>00831         para+=<span class="stringliteral">&quot;m=&quot;</span>+<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a292b5119262d9a88c5604b5afb38dfd3" title="experimental (default: disabled) separate k for points to cluster and cluster to...">clusterConnectionMaxPoints</a>+<span class="stringliteral">&quot;;&quot;</span>;
<a name="l00832"></a>00832         para+=<span class="stringliteral">&quot;tauConn=&quot;</span>+<a class="code" href="classmoa_1_1evaluation_1_1CMM__GTAnalysis.html#a91801ca91918ceff8edb511d568ee851" title="the threshold which defines when ground truth clusters will be merged.">tauConnection</a>+<span class="stringliteral">&quot;;&quot;</span>;
<a name="l00833"></a>00833 
<a name="l00834"></a>00834         <span class="keywordflow">return</span> para;
<a name="l00835"></a>00835     }    
<a name="l00836"></a>00836 }
<a name="l00837"></a>00837 
<a name="l00838"></a>00838 
</pre></div></div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Enumerations</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr size="1"/><address style="text-align: right;"><small>Generated on 26 Nov 2014 for MOA by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
