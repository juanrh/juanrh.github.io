<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>MOA: main/java/moa/clusterers/clustree/ClusTree.java Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    </ul>
  </div>
<h1>main/java/moa/clusterers/clustree/ClusTree.java</h1><a href="ClusTree_8java.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> *    ClusTree.java</span>
<a name="l00003"></a>00003 <span class="comment"> *    Copyright (C) 2010 RWTH Aachen University, Germany</span>
<a name="l00004"></a>00004 <span class="comment"> *    @author Sanchez Villaamil (moa@cs.rwth-aachen.de)</span>
<a name="l00005"></a>00005 <span class="comment"> *</span>
<a name="l00006"></a>00006 <span class="comment"> *    Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<a name="l00007"></a>00007 <span class="comment"> *    you may not use this file except in compliance with the License.</span>
<a name="l00008"></a>00008 <span class="comment"> *    You may obtain a copy of the License at</span>
<a name="l00009"></a>00009 <span class="comment"> *</span>
<a name="l00010"></a>00010 <span class="comment"> *      http://www.apache.org/licenses/LICENSE-2.0</span>
<a name="l00011"></a>00011 <span class="comment"> *</span>
<a name="l00012"></a>00012 <span class="comment"> *    Unless required by applicable law or agreed to in writing, software</span>
<a name="l00013"></a>00013 <span class="comment"> *    distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<a name="l00014"></a>00014 <span class="comment"> *    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<a name="l00015"></a>00015 <span class="comment"> *    See the License for the specific language governing permissions and</span>
<a name="l00016"></a>00016 <span class="comment"> *    limitations under the License.</span>
<a name="l00017"></a>00017 <span class="comment"> *    </span>
<a name="l00018"></a>00018 <span class="comment"> *    </span>
<a name="l00019"></a>00019 <span class="comment"> */</span>
<a name="l00020"></a>00020 
<a name="l00021"></a>00021 <span class="keyword">package </span>moa.clusterers.clustree;
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 <span class="keyword">import</span> java.util.ArrayList;
<a name="l00024"></a>00024 
<a name="l00025"></a>00025 <span class="keyword">import</span> java.util.LinkedList;
<a name="l00026"></a>00026 <span class="keyword">import</span> moa.clusterers.clustree.util.*;
<a name="l00027"></a>00027 <span class="keyword">import</span> moa.cluster.Clustering;
<a name="l00028"></a>00028 <span class="keyword">import</span> moa.clusterers.AbstractClusterer;
<a name="l00029"></a>00029 <span class="keyword">import</span> moa.core.Measurement;
<a name="l00030"></a>00030 <span class="keyword">import</span> moa.options.IntOption;
<a name="l00031"></a>00031 <span class="keyword">import</span> weka.core.Instance;
<a name="l00032"></a>00032 
<a name="l00038"></a><a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html">00038</a> <span class="keyword">public</span> <span class="keyword">class </span><a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html" title="Citation: ClusTree: Philipp Kranen, Ira Assent, Corinna Baldauf, Thomas Seidl: The...">ClusTree</a> <span class="keyword">extends</span> <a class="code" href="classmoa_1_1clusterers_1_1AbstractClusterer.html">AbstractClusterer</a>{
<a name="l00039"></a><a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a6e44cb75095ffc11de4f819b7d071257">00039</a>     <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keywordtype">long</span> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a6e44cb75095ffc11de4f819b7d071257">serialVersionUID</a> = 1L;
<a name="l00040"></a>00040     
<a name="l00041"></a><a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a62ae463934c56dc26e84bfdd9e57dc6f">00041</a>     <span class="keyword">public</span> <a class="code" href="classmoa_1_1options_1_1IntOption.html" title="Int option.">IntOption</a> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a62ae463934c56dc26e84bfdd9e57dc6f">horizonOption</a> = <span class="keyword">new</span> <a class="code" href="classmoa_1_1options_1_1IntOption.html" title="Int option.">IntOption</a>(<span class="stringliteral">&quot;horizon&quot;</span>,
<a name="l00042"></a>00042             <span class="charliteral">&apos;h&apos;</span>, <span class="stringliteral">&quot;Range of the window.&quot;</span>, 1000);
<a name="l00043"></a>00043 
<a name="l00044"></a><a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#afb5bc3aeed8c1e3e009c739af6274c6b">00044</a>     <span class="keyword">public</span> <a class="code" href="classmoa_1_1options_1_1IntOption.html" title="Int option.">IntOption</a> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#afb5bc3aeed8c1e3e009c739af6274c6b">maxHeightOption</a> = <span class="keyword">new</span> <a class="code" href="classmoa_1_1options_1_1IntOption.html" title="Int option.">IntOption</a>(
<a name="l00045"></a>00045             <span class="stringliteral">&quot;maxHeight&quot;</span>, <span class="charliteral">&apos;H&apos;</span>,
<a name="l00046"></a>00046             <span class="stringliteral">&quot;The maximal height of the tree&quot;</span>, <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a578db786d6f7bcf13a76c1d8216cf79c">getDefaultHeight</a>());
<a name="l00047"></a>00047     
<a name="l00048"></a><a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a578db786d6f7bcf13a76c1d8216cf79c">00048</a>     <span class="keyword">protected</span> <span class="keywordtype">int</span> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a578db786d6f7bcf13a76c1d8216cf79c">getDefaultHeight</a>() {
<a name="l00049"></a>00049         <span class="keywordflow">return</span> 8;
<a name="l00050"></a>00050     }
<a name="l00051"></a>00051     
<a name="l00052"></a><a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a45825ca1e9a79ed7d64ffb5e629ef80d">00052</a>     <span class="keyword">private</span> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a45825ca1e9a79ed7d64ffb5e629ef80d">INSERTIONS_BETWEEN_CLEANUPS</a> = 10000;
<a name="l00056"></a><a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a7e68f41dd0fecd5934d8eded9438eb6e">00056</a>     <span class="keyword">protected</span> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html">Node</a> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a7e68f41dd0fecd5934d8eded9438eb6e" title="The root node of the tree.">root</a>;
<a name="l00057"></a>00057     <span class="comment">// Information about the data represented in this tree.</span>
<a name="l00061"></a><a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#ae3d6b1118438f92171963de089ec119a">00061</a> <span class="comment"></span>    <span class="keyword">private</span> <span class="keywordtype">int</span> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#ae3d6b1118438f92171963de089ec119a" title="Dimensionality of the data points managed by this tree.">numberDimensions</a>;
<a name="l00065"></a><a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a01f20064f2f34a61dd81d5bf568473d5">00065</a>     <span class="keyword">protected</span> <span class="keywordtype">double</span> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a01f20064f2f34a61dd81d5bf568473d5" title="Parameter for the weighting function use to weight the entries.">negLambda</a>;
<a name="l00069"></a><a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#af5304f844b2c0bf266c6b3ee686a4a22">00069</a>     <span class="keyword">private</span> <span class="keywordtype">int</span> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#af5304f844b2c0bf266c6b3ee686a4a22" title="The current height of the tree.">height</a>;
<a name="l00073"></a><a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#aabde7ef28bade0a3ee8909603b591813">00073</a>     <span class="keyword">protected</span> <span class="keywordtype">int</span> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#aabde7ef28bade0a3ee8909603b591813" title="The maximal height of the tree.">maxHeight</a>;
<a name="l00078"></a><a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#af4bb41722a229335793648b58f4fb3ea">00078</a>     <span class="keyword">private</span> <span class="keywordtype">int</span> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#af4bb41722a229335793648b58f4fb3ea" title="This variable is used to keep the inverse height that is stored in every node correct...">numRootSplits</a>;
<a name="l00085"></a><a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a25df486eb6e958fdbc5eaf9c4a54b2c3">00085</a>     <span class="keyword">private</span> <span class="keywordtype">double</span> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a25df486eb6e958fdbc5eaf9c4a54b2c3" title="The threshold for the weighting of an Entry.">weightThreshold</a> = 0.05;
<a name="l00089"></a><a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#af88a846ce35b0bc3ddf5f2d8408639b3">00089</a>     <span class="keyword">private</span> <span class="keywordtype">int</span> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#af88a846ce35b0bc3ddf5f2d8408639b3" title="Number of points inserted into the tree.">numberInsertions</a>;
<a name="l00090"></a><a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#ab38af63448db68c547aaad6404c494f0">00090</a>     <span class="keyword">private</span> <span class="keywordtype">long</span> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#ab38af63448db68c547aaad6404c494f0">timestamp</a>;
<a name="l00091"></a>00091 
<a name="l00095"></a>00095     <span class="comment">//TODO: Add Option for that</span>
<a name="l00096"></a><a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a79c228d7b99b88e842f658af62f46149">00096</a>     <span class="keyword">protected</span> <span class="keywordtype">boolean</span> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a79c228d7b99b88e842f658af62f46149" title="Parameter to determine wich strategy to use.">breadthFirstStrat</a> = <span class="keyword">false</span>;
<a name="l00097"></a>00097     
<a name="l00098"></a>00098     <span class="comment">//TODO: cleanup</span>
<a name="l00099"></a><a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#af46c83185d2389c2c105a139011a6e26">00099</a>     <span class="keyword">private</span> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html">Entry</a> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#af46c83185d2389c2c105a139011a6e26">alsoUpdate</a>;
<a name="l00100"></a>00100     
<a name="l00101"></a>00101     @Override
<a name="l00102"></a><a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a14e7551734e17b7dd9ba6e30aba24379">00102</a>     <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a14e7551734e17b7dd9ba6e30aba24379">resetLearningImpl</a>() {
<a name="l00103"></a>00103         <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a01f20064f2f34a61dd81d5bf568473d5" title="Parameter for the weighting function use to weight the entries.">negLambda</a> = (1.0 / (double) <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a62ae463934c56dc26e84bfdd9e57dc6f">horizonOption</a>.<a class="code" href="classmoa_1_1options_1_1IntOption.html#affae8787274b44ab7616d46b8d6c831a">getValue</a>())
<a name="l00104"></a>00104                 * (Math.log(<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a25df486eb6e958fdbc5eaf9c4a54b2c3" title="The threshold for the weighting of an Entry.">weightThreshold</a>) / Math.log(2));
<a name="l00105"></a>00105         <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#aabde7ef28bade0a3ee8909603b591813" title="The maximal height of the tree.">maxHeight</a> = <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#afb5bc3aeed8c1e3e009c739af6274c6b">maxHeightOption</a>.<a class="code" href="classmoa_1_1options_1_1IntOption.html#affae8787274b44ab7616d46b8d6c831a">getValue</a>();
<a name="l00106"></a>00106         <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#ae3d6b1118438f92171963de089ec119a" title="Dimensionality of the data points managed by this tree.">numberDimensions</a> = -1;
<a name="l00107"></a>00107         <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a7e68f41dd0fecd5934d8eded9438eb6e" title="The root node of the tree.">root</a> = null;
<a name="l00108"></a>00108         <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#ab38af63448db68c547aaad6404c494f0">timestamp</a> = 0;
<a name="l00109"></a>00109         <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#af5304f844b2c0bf266c6b3ee686a4a22" title="The current height of the tree.">height</a> = 0;
<a name="l00110"></a>00110         <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#af4bb41722a229335793648b58f4fb3ea" title="This variable is used to keep the inverse height that is stored in every node correct...">numRootSplits</a> = 0;
<a name="l00111"></a>00111         <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#af88a846ce35b0bc3ddf5f2d8408639b3" title="Number of points inserted into the tree.">numberInsertions</a> = 0;
<a name="l00112"></a>00112     }
<a name="l00113"></a>00113 
<a name="l00114"></a>00114 
<a name="l00115"></a>00115     @Override
<a name="l00116"></a><a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a7ce98ae348b61aae414939f8a0dfe529">00116</a>     <span class="keyword">protected</span> <a class="code" href="classmoa_1_1core_1_1Measurement.html" title="Class for storing an evaluation measurement.">Measurement</a>[] <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a7ce98ae348b61aae414939f8a0dfe529">getModelMeasurementsImpl</a>() {
<a name="l00117"></a>00117         <span class="keywordflow">return</span> null;
<a name="l00118"></a>00118     }
<a name="l00119"></a>00119 
<a name="l00120"></a><a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#af9b1ad0e0197f2f67cf3a5adfadb5237">00120</a>     <span class="keyword">public</span> <span class="keywordtype">boolean</span> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#af9b1ad0e0197f2f67cf3a5adfadb5237">isRandomizable</a>() {
<a name="l00121"></a>00121         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00122"></a>00122     }
<a name="l00123"></a>00123 
<a name="l00124"></a>00124     @Override
<a name="l00125"></a><a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a38ddd4f4a28610dd51d4dfce69086c4e">00125</a>     <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a38ddd4f4a28610dd51d4dfce69086c4e">getModelDescription</a>(StringBuilder out, <span class="keywordtype">int</span> indent) {
<a name="l00126"></a>00126     }
<a name="l00127"></a>00127 
<a name="l00128"></a><a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a3487f05149e213d10b615ade69d219c4">00128</a>     <span class="keyword">public</span> <span class="keywordtype">double</span>[] <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a3487f05149e213d10b615ade69d219c4">getVotesForInstance</a>(Instance inst) {
<a name="l00129"></a>00129         <span class="keywordflow">return</span> null;
<a name="l00130"></a>00130     }
<a name="l00131"></a>00131 
<a name="l00132"></a>00132     @Override
<a name="l00133"></a><a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a17a8293837e30d9a1d7e6540b74fe1d8">00133</a>     <span class="keyword">public</span> <span class="keywordtype">boolean</span> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a17a8293837e30d9a1d7e6540b74fe1d8">implementsMicroClusterer</a>() {
<a name="l00134"></a>00134         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00135"></a>00135     }
<a name="l00136"></a>00136 
<a name="l00137"></a>00137 
<a name="l00138"></a>00138 
<a name="l00139"></a>00139     @Override
<a name="l00140"></a><a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a8fd397a6344c5b97fe5cf44fcf8b2db9">00140</a>     <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a8fd397a6344c5b97fe5cf44fcf8b2db9">trainOnInstanceImpl</a>(Instance instance) {
<a name="l00141"></a>00141         <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#ab38af63448db68c547aaad6404c494f0">timestamp</a>++;
<a name="l00142"></a>00142         
<a name="l00143"></a>00143         <span class="comment">//TODO check if instance contains label</span>
<a name="l00144"></a>00144         <span class="keywordflow">if</span>(<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a7e68f41dd0fecd5934d8eded9438eb6e" title="The root node of the tree.">root</a> == null){
<a name="l00145"></a>00145             <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#ae3d6b1118438f92171963de089ec119a" title="Dimensionality of the data points managed by this tree.">numberDimensions</a> = instance.numAttributes();
<a name="l00146"></a>00146             <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a7e68f41dd0fecd5934d8eded9438eb6e" title="The root node of the tree.">root</a> = <span class="keyword">new</span> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html">Node</a>(<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#ae3d6b1118438f92171963de089ec119a" title="Dimensionality of the data points managed by this tree.">numberDimensions</a>, 0);
<a name="l00147"></a>00147         }
<a name="l00148"></a>00148         <span class="keywordflow">else</span>{
<a name="l00149"></a>00149             <span class="keywordflow">if</span>(<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#ae3d6b1118438f92171963de089ec119a" title="Dimensionality of the data points managed by this tree.">numberDimensions</a>!=instance.numAttributes())
<a name="l00150"></a>00150                 System.out.println(<span class="stringliteral">&quot;Wrong dimensionality, expected:&quot;</span>+<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#ae3d6b1118438f92171963de089ec119a" title="Dimensionality of the data points managed by this tree.">numberDimensions</a>+ <span class="stringliteral">&quot;found:&quot;</span>+instance.numAttributes());
<a name="l00151"></a>00151         }
<a name="l00152"></a>00152 
<a name="l00153"></a>00153         <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusKernel.html" title="Representation of an Entry in the tree.">ClusKernel</a> newPointAsKernel = <span class="keyword">new</span> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusKernel.html" title="Representation of an Entry in the tree.">ClusKernel</a>(instance.toDoubleArray(), <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#ae3d6b1118438f92171963de089ec119a" title="Dimensionality of the data points managed by this tree.">numberDimensions</a>);
<a name="l00154"></a>00154         <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a1fcbd4768f2142bdae4d88c80e0323e9" title="Insert a new point in the Tree.">insert</a>(newPointAsKernel, <span class="keyword">new</span> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1util_1_1SimpleBudget.html">SimpleBudget</a>(1000),<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#ab38af63448db68c547aaad6404c494f0">timestamp</a>);
<a name="l00155"></a>00155     }
<a name="l00156"></a>00156 
<a name="l00157"></a>00157 
<a name="l00170"></a><a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a1fcbd4768f2142bdae4d88c80e0323e9">00170</a>     <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a1fcbd4768f2142bdae4d88c80e0323e9" title="Insert a new point in the Tree.">insert</a>(<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusKernel.html" title="Representation of an Entry in the tree.">ClusKernel</a> newPoint, <a class="code" href="interfacemoa_1_1clusterers_1_1clustree_1_1util_1_1Budget.html" title="This is an interface for classes that are to be given along with every data point...">Budget</a> budget, <span class="keywordtype">long</span> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#ab38af63448db68c547aaad6404c494f0">timestamp</a>) {
<a name="l00171"></a>00171         <span class="keywordflow">if</span> (<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a79c228d7b99b88e842f658af62f46149" title="Parameter to determine wich strategy to use.">breadthFirstStrat</a>){
<a name="l00172"></a>00172             <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a7998f24fe858f360f96c6557f7aada85" title="insert newPoint into the tree using the BreadthFirst strategy, i.e.">insertBreadthFirst</a>(newPoint, budget, timestamp);
<a name="l00173"></a>00173        }
<a name="l00174"></a>00174         <span class="keywordflow">else</span>{
<a name="l00175"></a>00175             <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html">Entry</a> rootEntry = <span class="keyword">new</span> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html">Entry</a>(this.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#ae3d6b1118438f92171963de089ec119a" title="Dimensionality of the data points managed by this tree.">numberDimensions</a>,
<a name="l00176"></a>00176                     <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a7e68f41dd0fecd5934d8eded9438eb6e" title="The root node of the tree.">root</a>, timestamp, null, null);
<a name="l00177"></a>00177             <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusKernel.html" title="Representation of an Entry in the tree.">ClusKernel</a> carriedBuffer = <span class="keyword">new</span> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusKernel.html" title="Representation of an Entry in the tree.">ClusKernel</a>(this.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#ae3d6b1118438f92171963de089ec119a" title="Dimensionality of the data points managed by this tree.">numberDimensions</a>);
<a name="l00178"></a>00178             <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html">Entry</a> toInsertHere = <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a1fcbd4768f2142bdae4d88c80e0323e9" title="Insert a new point in the Tree.">insert</a>(newPoint, carriedBuffer, <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a7e68f41dd0fecd5934d8eded9438eb6e" title="The root node of the tree.">root</a>, rootEntry,
<a name="l00179"></a>00179                     budget, timestamp);
<a name="l00180"></a>00180     
<a name="l00181"></a>00181             <span class="keywordflow">if</span> (toInsertHere != null) {
<a name="l00182"></a>00182                 this.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#af4bb41722a229335793648b58f4fb3ea" title="This variable is used to keep the inverse height that is stored in every node correct...">numRootSplits</a>++;
<a name="l00183"></a>00183                 this.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#af5304f844b2c0bf266c6b3ee686a4a22" title="The current height of the tree.">height</a> += this.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#af5304f844b2c0bf266c6b3ee686a4a22" title="The current height of the tree.">height</a> &lt; this.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#aabde7ef28bade0a3ee8909603b591813" title="The maximal height of the tree.">maxHeight</a> ? 1 : 0;
<a name="l00184"></a>00184                 
<a name="l00185"></a>00185                 <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html">Node</a> newRoot = <span class="keyword">new</span> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html">Node</a>(this.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#ae3d6b1118438f92171963de089ec119a" title="Dimensionality of the data points managed by this tree.">numberDimensions</a>,
<a name="l00186"></a>00186                         toInsertHere.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html#a61f6036ac71f69f1b16546544b8f01ac" title="Return the reference to the child of this Entry to navigate in the tree.">getChild</a>().<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#a5e9889abea42f6dde8fd9430d37cf8be" title="Return the level number in the node.">getRawLevel</a>() + 1);
<a name="l00187"></a>00187                 newRoot.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#a6afa5be4c7a2bba3be60383747b5508c" title="Add a new Entry to this node.">addEntry</a>(rootEntry, timestamp);
<a name="l00188"></a>00188                 newRoot.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#a6afa5be4c7a2bba3be60383747b5508c" title="Add a new Entry to this node.">addEntry</a>(toInsertHere, timestamp);
<a name="l00189"></a>00189                 rootEntry.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html#a5debb1d02b0f4015063eda14ead10d91">setNode</a>(newRoot);
<a name="l00190"></a>00190                 toInsertHere.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html#a5debb1d02b0f4015063eda14ead10d91">setNode</a>(newRoot);
<a name="l00191"></a>00191                 this.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a7e68f41dd0fecd5934d8eded9438eb6e" title="The root node of the tree.">root</a> = newRoot;
<a name="l00192"></a>00192             }
<a name="l00193"></a>00193         }
<a name="l00194"></a>00194 
<a name="l00195"></a>00195         this.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#af88a846ce35b0bc3ddf5f2d8408639b3" title="Number of points inserted into the tree.">numberInsertions</a>++;
<a name="l00196"></a>00196         <span class="keywordflow">if</span> (this.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#af88a846ce35b0bc3ddf5f2d8408639b3" title="Number of points inserted into the tree.">numberInsertions</a> % <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a45825ca1e9a79ed7d64ffb5e629ef80d">INSERTIONS_BETWEEN_CLEANUPS</a> == 0) {
<a name="l00197"></a>00197             <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a2f72c2f7faf51a9bd5a2b5a4c8c81db5">cleanUp</a>(this.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a7e68f41dd0fecd5934d8eded9438eb6e" title="The root node of the tree.">root</a>, 0);
<a name="l00198"></a>00198         }
<a name="l00199"></a>00199     }
<a name="l00200"></a>00200 
<a name="l00209"></a><a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a7998f24fe858f360f96c6557f7aada85">00209</a>     <span class="keyword">private</span> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html">Entry</a> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a7998f24fe858f360f96c6557f7aada85" title="insert newPoint into the tree using the BreadthFirst strategy, i.e.">insertBreadthFirst</a>(<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusKernel.html" title="Representation of an Entry in the tree.">ClusKernel</a> newPoint, <a class="code" href="interfacemoa_1_1clusterers_1_1clustree_1_1util_1_1Budget.html" title="This is an interface for classes that are to be given along with every data point...">Budget</a> budget, <span class="keywordtype">long</span> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#ab38af63448db68c547aaad6404c494f0">timestamp</a>) {
<a name="l00210"></a>00210         <span class="comment">//check all leaf nodes and get the one with the closest entry to newPoint</span>
<a name="l00211"></a>00211         <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html">Node</a> bestFit = <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#abb5a974d06555fddd065f5c6fae41e00" title="This method calculates the distances between the new point and each Entry in a leaf...">findBestLeafNode</a>(newPoint);
<a name="l00212"></a>00212         bestFit.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#ab0ebdeafbb74d7d6495ecb691a865f20">makeOlder</a>(timestamp, <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a01f20064f2f34a61dd81d5bf568473d5" title="Parameter for the weighting function use to weight the entries.">negLambda</a>);
<a name="l00213"></a>00213         <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html">Entry</a> parent = bestFit.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#abb9b9f7152bcbc9df763bb39f92b4968" title="Return an array with references to the children of this node.">getEntries</a>()[0].<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html#a2d7e1562388238298e5c14c7b5762fcc">getParentEntry</a>();    
<a name="l00214"></a>00214         <span class="comment">// Search for an Entry with a weight under the threshold.</span>
<a name="l00215"></a>00215         <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html">Entry</a> irrelevantEntry = bestFit.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#acd83a9b5876f2067bc0305ea8fa826f8" title="If there exists an entry, whose relevance is under the threshold given as a parameter...">getIrrelevantEntry</a>(this.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a25df486eb6e958fdbc5eaf9c4a54b2c3" title="The threshold for the weighting of an Entry.">weightThreshold</a>);
<a name="l00216"></a>00216         <span class="keywordtype">int</span> numFreeEntries = bestFit.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#a2d0e202c1ae236d13cffd616fb152010" title="Return the number of free Entrys in this node.">numFreeEntries</a>();
<a name="l00217"></a>00217         <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html">Entry</a> newEntry = <span class="keyword">new</span> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html">Entry</a>(newPoint.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusKernel.html#a7f902903111565ba68a1c1859f55b5c8">getCenter</a>().length,
<a name="l00218"></a>00218                 newPoint, timestamp, parent, bestFit);
<a name="l00219"></a>00219         <span class="comment">//if there is space, add it to the node ( doesn&apos;t ever occur, since nodes are created with 3 entries) </span>
<a name="l00220"></a>00220         <span class="keywordflow">if</span> (numFreeEntries&gt;0){
<a name="l00221"></a>00221             bestFit.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#a6afa5be4c7a2bba3be60383747b5508c" title="Add a new Entry to this node.">addEntry</a>(newEntry, timestamp);
<a name="l00222"></a>00222         }
<a name="l00223"></a>00223         <span class="comment">//if outdated cluster in this best fitting node, replace it</span>
<a name="l00224"></a>00224          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (irrelevantEntry != null) {
<a name="l00225"></a>00225             irrelevantEntry.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html#a7731defba51740b36c4025255a5415d2" title="Overwrites the LS, SS and weightedN in the data cluster of this Entry to the values...">overwriteOldEntry</a>(newEntry);
<a name="l00226"></a>00226         }
<a name="l00227"></a>00227         <span class="comment">//if there is space/outdated cluster on path to top, split. Else merge without split</span>
<a name="l00228"></a>00228         <span class="keywordflow">else</span> {
<a name="l00229"></a>00229             <span class="keywordflow">if</span> (<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a20dce56eedf22741eb72524ccd135b1d" title="This method checks if there is an outdated (or empty) entry on the path from node...">existsOutdatedEntryOnPath</a>(bestFit)||!this.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a7ffea39d741ddbe7cacb054deef5e943">hasMaximalSize</a>()){
<a name="l00230"></a>00230                 <span class="comment">// We have to split.</span>
<a name="l00231"></a>00231                 <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a650e952fc922b0305c024c1ac76cd1ac" title="Method called by insertBreadthFirst.">insertHereWithSplit</a>(newEntry, bestFit, timestamp);
<a name="l00232"></a>00232             }
<a name="l00233"></a>00233             <span class="keywordflow">else</span> {
<a name="l00234"></a>00234                 <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a344cb4a855b69ffcc8b8e0b1381d7952" title="Inserts an Entry into a Node without inducing a split.">mergeEntryWithoutSplit</a>(bestFit, newEntry,
<a name="l00235"></a>00235                         timestamp);
<a name="l00236"></a>00236             }
<a name="l00237"></a>00237         }
<a name="l00238"></a>00238         <span class="comment">//update all nodes on path to top.</span>
<a name="l00239"></a>00239         <span class="keywordflow">if</span> (bestFit.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#abb9b9f7152bcbc9df763bb39f92b4968" title="Return an array with references to the children of this node.">getEntries</a>()[0].<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html#a2d7e1562388238298e5c14c7b5762fcc">getParentEntry</a>()!=null)
<a name="l00240"></a>00240             <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a0630e6739f1c4bcfb5ace7dbc67065e5" title="recalculates data for all entries, that lie on the path from the root to the Entry...">updateToTop</a>(bestFit.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#abb9b9f7152bcbc9df763bb39f92b4968" title="Return an array with references to the children of this node.">getEntries</a>()[0].<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html#a2d7e1562388238298e5c14c7b5762fcc">getParentEntry</a>().<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html#a072892b980cf66e0bc2a975379380bbd">getNode</a>());
<a name="l00241"></a>00241         <span class="keywordflow">return</span> null;
<a name="l00242"></a>00242     }
<a name="l00249"></a><a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a20dce56eedf22741eb72524ccd135b1d">00249</a>     <span class="keyword">private</span> <span class="keywordtype">boolean</span> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a20dce56eedf22741eb72524ccd135b1d" title="This method checks if there is an outdated (or empty) entry on the path from node...">existsOutdatedEntryOnPath</a>(<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html">Node</a> node) {
<a name="l00250"></a>00250         <span class="keywordflow">if</span> (node == <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a7e68f41dd0fecd5934d8eded9438eb6e" title="The root node of the tree.">root</a>){
<a name="l00251"></a>00251             node.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#ab0ebdeafbb74d7d6495ecb691a865f20">makeOlder</a>(<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#ab38af63448db68c547aaad6404c494f0">timestamp</a>, <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a01f20064f2f34a61dd81d5bf568473d5" title="Parameter for the weighting function use to weight the entries.">negLambda</a>);
<a name="l00252"></a>00252             <span class="keywordflow">return</span> node.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#acd83a9b5876f2067bc0305ea8fa826f8" title="If there exists an entry, whose relevance is under the threshold given as a parameter...">getIrrelevantEntry</a>(this.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a25df486eb6e958fdbc5eaf9c4a54b2c3" title="The threshold for the weighting of an Entry.">weightThreshold</a>)!=null;
<a name="l00253"></a>00253         }
<a name="l00254"></a>00254         <span class="keywordflow">do</span>{
<a name="l00255"></a>00255             node = node.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#abb9b9f7152bcbc9df763bb39f92b4968" title="Return an array with references to the children of this node.">getEntries</a>()[0].<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html#a2d7e1562388238298e5c14c7b5762fcc">getParentEntry</a>().<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html#a072892b980cf66e0bc2a975379380bbd">getNode</a>();
<a name="l00256"></a>00256             node.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#ab0ebdeafbb74d7d6495ecb691a865f20">makeOlder</a>(<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#ab38af63448db68c547aaad6404c494f0">timestamp</a>, <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a01f20064f2f34a61dd81d5bf568473d5" title="Parameter for the weighting function use to weight the entries.">negLambda</a>);
<a name="l00257"></a>00257             <span class="keywordflow">for</span> (<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html">Entry</a> e : node.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#abb9b9f7152bcbc9df763bb39f92b4968" title="Return an array with references to the children of this node.">getEntries</a>()){
<a name="l00258"></a>00258                 e.recalculateData();
<a name="l00259"></a>00259             }
<a name="l00260"></a>00260             <span class="keywordflow">if</span> (node.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#a2d0e202c1ae236d13cffd616fb152010" title="Return the number of free Entrys in this node.">numFreeEntries</a>()&gt;0)
<a name="l00261"></a>00261                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00262"></a>00262             <span class="keywordflow">if</span> (node.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#acd83a9b5876f2067bc0305ea8fa826f8" title="If there exists an entry, whose relevance is under the threshold given as a parameter...">getIrrelevantEntry</a>(<span class="keyword">this</span>.weightThreshold)!=null)
<a name="l00263"></a>00263                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00264"></a>00264         }<span class="keywordflow">while</span>(node.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#abb9b9f7152bcbc9df763bb39f92b4968" title="Return an array with references to the children of this node.">getEntries</a>()[0].<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html#a2d7e1562388238298e5c14c7b5762fcc">getParentEntry</a>()!=null);
<a name="l00265"></a>00265         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00266"></a>00266     }
<a name="l00267"></a>00267     
<a name="l00272"></a><a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a0630e6739f1c4bcfb5ace7dbc67065e5">00272</a>     <span class="keyword">private</span> <span class="keywordtype">void</span> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a0630e6739f1c4bcfb5ace7dbc67065e5" title="recalculates data for all entries, that lie on the path from the root to the Entry...">updateToTop</a>(<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html">Node</a> toUpdate) {
<a name="l00273"></a>00273         <span class="keywordflow">while</span>(toUpdate!=null){
<a name="l00274"></a>00274             <span class="keywordflow">for</span> (<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html">Entry</a> e: toUpdate.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#abb9b9f7152bcbc9df763bb39f92b4968" title="Return an array with references to the children of this node.">getEntries</a>())
<a name="l00275"></a>00275                 e.recalculateData();
<a name="l00276"></a>00276             <span class="keywordflow">if</span> (toUpdate.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#abb9b9f7152bcbc9df763bb39f92b4968" title="Return an array with references to the children of this node.">getEntries</a>()[0].<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html#a2d7e1562388238298e5c14c7b5762fcc">getParentEntry</a>()==null)
<a name="l00277"></a>00277                 <span class="keywordflow">break</span>;
<a name="l00278"></a>00278             toUpdate=toUpdate.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#abb9b9f7152bcbc9df763bb39f92b4968" title="Return an array with references to the children of this node.">getEntries</a>()[0].<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html#a2d7e1562388238298e5c14c7b5762fcc">getParentEntry</a>().<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html#a072892b980cf66e0bc2a975379380bbd">getNode</a>();
<a name="l00279"></a>00279         }
<a name="l00280"></a>00280     }
<a name="l00281"></a>00281 
<a name="l00289"></a><a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a650e952fc922b0305c024c1ac76cd1ac">00289</a>     <span class="keyword">private</span> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html">Entry</a> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a650e952fc922b0305c024c1ac76cd1ac" title="Method called by insertBreadthFirst.">insertHereWithSplit</a>(<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html">Entry</a> toInsert, <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html">Node</a> insertNode,
<a name="l00290"></a>00290             <span class="keywordtype">long</span> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#ab38af63448db68c547aaad6404c494f0">timestamp</a>) {
<a name="l00291"></a>00291         <span class="comment">//Handle root split</span>
<a name="l00292"></a>00292         <span class="keywordflow">if</span> (insertNode.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#abb9b9f7152bcbc9df763bb39f92b4968" title="Return an array with references to the children of this node.">getEntries</a>()[0].<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html#a2d7e1562388238298e5c14c7b5762fcc">getParentEntry</a>()==null){
<a name="l00293"></a>00293             <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a7e68f41dd0fecd5934d8eded9438eb6e" title="The root node of the tree.">root</a>.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#ab0ebdeafbb74d7d6495ecb691a865f20">makeOlder</a>(timestamp, <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a01f20064f2f34a61dd81d5bf568473d5" title="Parameter for the weighting function use to weight the entries.">negLambda</a>);
<a name="l00294"></a>00294             <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html">Entry</a> irrelevantEntry = insertNode.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#acd83a9b5876f2067bc0305ea8fa826f8" title="If there exists an entry, whose relevance is under the threshold given as a parameter...">getIrrelevantEntry</a>(this.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a25df486eb6e958fdbc5eaf9c4a54b2c3" title="The threshold for the weighting of an Entry.">weightThreshold</a>);
<a name="l00295"></a>00295             <span class="keywordtype">int</span> numFreeEntries = insertNode.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#a2d0e202c1ae236d13cffd616fb152010" title="Return the number of free Entrys in this node.">numFreeEntries</a>();
<a name="l00296"></a>00296             <span class="keywordflow">if</span> (irrelevantEntry != null) {
<a name="l00297"></a>00297                 irrelevantEntry.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html#a7731defba51740b36c4025255a5415d2" title="Overwrites the LS, SS and weightedN in the data cluster of this Entry to the values...">overwriteOldEntry</a>(toInsert);
<a name="l00298"></a>00298             }
<a name="l00299"></a>00299             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (numFreeEntries&gt;0){
<a name="l00300"></a>00300                 insertNode.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#a6afa5be4c7a2bba3be60383747b5508c" title="Add a new Entry to this node.">addEntry</a>(toInsert, timestamp);
<a name="l00301"></a>00301             }
<a name="l00302"></a>00302             <span class="keywordflow">else</span>{
<a name="l00303"></a>00303                 this.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#af4bb41722a229335793648b58f4fb3ea" title="This variable is used to keep the inverse height that is stored in every node correct...">numRootSplits</a>++;
<a name="l00304"></a>00304                 this.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#af5304f844b2c0bf266c6b3ee686a4a22" title="The current height of the tree.">height</a> += this.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#af5304f844b2c0bf266c6b3ee686a4a22" title="The current height of the tree.">height</a> &lt; this.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#aabde7ef28bade0a3ee8909603b591813" title="The maximal height of the tree.">maxHeight</a> ? 1 : 0;
<a name="l00305"></a>00305                 <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html">Entry</a> oldRootEntry = <span class="keyword">new</span> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html">Entry</a>(this.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#ae3d6b1118438f92171963de089ec119a" title="Dimensionality of the data points managed by this tree.">numberDimensions</a>,
<a name="l00306"></a>00306                         <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a7e68f41dd0fecd5934d8eded9438eb6e" title="The root node of the tree.">root</a>, timestamp, null, null);
<a name="l00307"></a>00307                 <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html">Node</a> newRoot = <span class="keyword">new</span> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html">Node</a>(this.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#ae3d6b1118438f92171963de089ec119a" title="Dimensionality of the data points managed by this tree.">numberDimensions</a>,
<a name="l00308"></a>00308                         this.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#af5304f844b2c0bf266c6b3ee686a4a22" title="The current height of the tree.">height</a>);
<a name="l00309"></a>00309                 <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html">Entry</a> newRootEntry = <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a2b13ed32dddc7452296ac0a8f458c7ca" title="Performs a (2,2) split on the given node with the given entry.">split</a>(toInsert, <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a7e68f41dd0fecd5934d8eded9438eb6e" title="The root node of the tree.">root</a>, oldRootEntry, timestamp);
<a name="l00310"></a>00310                 newRoot.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#a6afa5be4c7a2bba3be60383747b5508c" title="Add a new Entry to this node.">addEntry</a>(oldRootEntry, timestamp);
<a name="l00311"></a>00311                 newRoot.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#a6afa5be4c7a2bba3be60383747b5508c" title="Add a new Entry to this node.">addEntry</a>(newRootEntry, timestamp);
<a name="l00312"></a>00312                 this.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a7e68f41dd0fecd5934d8eded9438eb6e" title="The root node of the tree.">root</a> = newRoot;
<a name="l00313"></a>00313                 <span class="keywordflow">for</span> (<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html">Entry</a> c : oldRootEntry.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html#a61f6036ac71f69f1b16546544b8f01ac" title="Return the reference to the child of this Entry to navigate in the tree.">getChild</a>().<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#abb9b9f7152bcbc9df763bb39f92b4968" title="Return an array with references to the children of this node.">getEntries</a>())
<a name="l00314"></a>00314                     c.setParentEntry(<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a7e68f41dd0fecd5934d8eded9438eb6e" title="The root node of the tree.">root</a>.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#abb9b9f7152bcbc9df763bb39f92b4968" title="Return an array with references to the children of this node.">getEntries</a>()[0]);
<a name="l00315"></a>00315                 <span class="keywordflow">for</span> (<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html">Entry</a> c : newRootEntry.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html#a61f6036ac71f69f1b16546544b8f01ac" title="Return the reference to the child of this Entry to navigate in the tree.">getChild</a>().<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#abb9b9f7152bcbc9df763bb39f92b4968" title="Return an array with references to the children of this node.">getEntries</a>())
<a name="l00316"></a>00316                     c.setParentEntry(<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a7e68f41dd0fecd5934d8eded9438eb6e" title="The root node of the tree.">root</a>.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#abb9b9f7152bcbc9df763bb39f92b4968" title="Return an array with references to the children of this node.">getEntries</a>()[1]);
<a name="l00317"></a>00317             }
<a name="l00318"></a>00318             <span class="keywordflow">return</span> null;
<a name="l00319"></a>00319         }
<a name="l00320"></a>00320         insertNode.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#ab0ebdeafbb74d7d6495ecb691a865f20">makeOlder</a>(timestamp, <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a01f20064f2f34a61dd81d5bf568473d5" title="Parameter for the weighting function use to weight the entries.">negLambda</a>);
<a name="l00321"></a>00321         <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html">Entry</a> irrelevantEntry = insertNode.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#acd83a9b5876f2067bc0305ea8fa826f8" title="If there exists an entry, whose relevance is under the threshold given as a parameter...">getIrrelevantEntry</a>(this.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a25df486eb6e958fdbc5eaf9c4a54b2c3" title="The threshold for the weighting of an Entry.">weightThreshold</a>);
<a name="l00322"></a>00322         <span class="keywordtype">int</span> numFreeEntries = insertNode.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#a2d0e202c1ae236d13cffd616fb152010" title="Return the number of free Entrys in this node.">numFreeEntries</a>();
<a name="l00323"></a>00323         <span class="keywordflow">if</span> (irrelevantEntry != null) {
<a name="l00324"></a>00324             irrelevantEntry.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html#a7731defba51740b36c4025255a5415d2" title="Overwrites the LS, SS and weightedN in the data cluster of this Entry to the values...">overwriteOldEntry</a>(toInsert);
<a name="l00325"></a>00325         }
<a name="l00326"></a>00326         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (numFreeEntries&gt;0){
<a name="l00327"></a>00327             insertNode.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#a6afa5be4c7a2bba3be60383747b5508c" title="Add a new Entry to this node.">addEntry</a>(toInsert, timestamp);
<a name="l00328"></a>00328         }
<a name="l00329"></a>00329         <span class="keywordflow">else</span> {
<a name="l00330"></a>00330                 <span class="comment">// We have to split.</span>
<a name="l00331"></a>00331                 <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html">Entry</a> parentEntry = insertNode.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#abb9b9f7152bcbc9df763bb39f92b4968" title="Return an array with references to the children of this node.">getEntries</a>()[0].<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html#a2d7e1562388238298e5c14c7b5762fcc">getParentEntry</a>();
<a name="l00332"></a>00332                 <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html">Entry</a> residualEntry = <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a2b13ed32dddc7452296ac0a8f458c7ca" title="Performs a (2,2) split on the given node with the given entry.">split</a>(toInsert, insertNode, parentEntry, timestamp);
<a name="l00333"></a>00333                 <span class="keywordflow">if</span> (<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#af46c83185d2389c2c105a139011a6e26">alsoUpdate</a>!=null){
<a name="l00334"></a>00334                     <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#af46c83185d2389c2c105a139011a6e26">alsoUpdate</a> = residualEntry;
<a name="l00335"></a>00335                 }
<a name="l00336"></a>00336                 <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html">Node</a> nodeForResidualEntry = insertNode.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#abb9b9f7152bcbc9df763bb39f92b4968" title="Return an array with references to the children of this node.">getEntries</a>()[0].<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html#a2d7e1562388238298e5c14c7b5762fcc">getParentEntry</a>().<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html#a072892b980cf66e0bc2a975379380bbd">getNode</a>();
<a name="l00337"></a>00337                 <span class="comment">//recursive call</span>
<a name="l00338"></a>00338                 <span class="keywordflow">return</span> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a650e952fc922b0305c024c1ac76cd1ac" title="Method called by insertBreadthFirst.">insertHereWithSplit</a>(residualEntry, nodeForResidualEntry, timestamp);
<a name="l00339"></a>00339         }
<a name="l00340"></a>00340         
<a name="l00341"></a>00341         <span class="comment">//no Split</span>
<a name="l00342"></a>00342         <span class="keywordflow">return</span> null;
<a name="l00343"></a>00343     }
<a name="l00344"></a>00344 
<a name="l00345"></a>00345 
<a name="l00346"></a>00346     <span class="comment">// XXX: Document the insertion when the final implementation is done.</span>
<a name="l00347"></a><a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a036b945ba16cbe4f9dc66fcf1e0fd60d">00347</a>     <span class="keyword">private</span> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html">Entry</a> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a036b945ba16cbe4f9dc66fcf1e0fd60d">insertHere</a>(<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html">Entry</a> newEntry, <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html">Node</a> currentNode,
<a name="l00348"></a>00348             <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html">Entry</a> parentEntry, <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusKernel.html" title="Representation of an Entry in the tree.">ClusKernel</a> carriedBuffer, <a class="code" href="interfacemoa_1_1clusterers_1_1clustree_1_1util_1_1Budget.html" title="This is an interface for classes that are to be given along with every data point...">Budget</a> budget,
<a name="l00349"></a>00349             <span class="keywordtype">long</span> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#ab38af63448db68c547aaad6404c494f0">timestamp</a>) {
<a name="l00350"></a>00350     
<a name="l00351"></a>00351         <span class="keywordtype">int</span> numFreeEntries = currentNode.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#a2d0e202c1ae236d13cffd616fb152010" title="Return the number of free Entrys in this node.">numFreeEntries</a>();
<a name="l00352"></a>00352     
<a name="l00353"></a>00353         <span class="comment">// Insert the buffer that we carry.</span>
<a name="l00354"></a>00354         <span class="keywordflow">if</span> (!carriedBuffer.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusKernel.html#a9e4f5414cfacb3df03db9a7001ab4187" title="Check if this cluster is empty or not.">isEmpty</a>()) {
<a name="l00355"></a>00355             <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html">Entry</a> bufferEntry = <span class="keyword">new</span> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html">Entry</a>(this.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#ae3d6b1118438f92171963de089ec119a" title="Dimensionality of the data points managed by this tree.">numberDimensions</a>,
<a name="l00356"></a>00356                     carriedBuffer, timestamp, parentEntry, currentNode);
<a name="l00357"></a>00357     
<a name="l00358"></a>00358             <span class="keywordflow">if</span> (numFreeEntries &lt;= 1) {
<a name="l00359"></a>00359                 <span class="comment">// Distance from buffer to entries.</span>
<a name="l00360"></a>00360                 <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html">Entry</a> nearestEntryToCarriedBuffer =
<a name="l00361"></a>00361                         currentNode.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#a9f6542affee04b5a17698c10bf71fd04" title="Returns the neareast Entry to the given Cluster.">nearestEntry</a>(newEntry);
<a name="l00362"></a>00362                 <span class="keywordtype">double</span> distanceNearestEntryToBuffer =
<a name="l00363"></a>00363                         nearestEntryToCarriedBuffer.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html#a9a7e452c2508fc5df286d93c9d20198d" title="Calculates the distance to the data in this entry.">calcDistance</a>(newEntry);
<a name="l00364"></a>00364     
<a name="l00365"></a>00365                 <span class="comment">// Distance between buffer and point to insert.</span>
<a name="l00366"></a>00366                 <span class="keywordtype">double</span> distanceBufferNewEntry =
<a name="l00367"></a>00367                         newEntry.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html#a9a7e452c2508fc5df286d93c9d20198d" title="Calculates the distance to the data in this entry.">calcDistance</a>(carriedBuffer);
<a name="l00368"></a>00368     
<a name="l00369"></a>00369                 <span class="comment">// Best distance between Entrys in the Node.</span>
<a name="l00370"></a>00370                 <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree_1_1BestMergeInNode.html" title="A class to code the return value of searching the smallest merge in a node.">BestMergeInNode</a> bestMergeInNode =
<a name="l00371"></a>00371                         <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a7a86b051d0547c6c7e9e14dcdfc385b9" title="Calculates the best merge possible between two nodes in a node.">calculateBestMergeInNode</a>(currentNode);
<a name="l00372"></a>00372     
<a name="l00373"></a>00373                 <span class="comment">// See what the minimal distance is and do the correspoding</span>
<a name="l00374"></a>00374                 <span class="comment">// action.</span>
<a name="l00375"></a>00375                 <span class="keywordflow">if</span> (distanceNearestEntryToBuffer &lt;= distanceBufferNewEntry
<a name="l00376"></a>00376                         &amp;&amp; distanceNearestEntryToBuffer &lt;= bestMergeInNode.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree_1_1BestMergeInNode.html#a2245b52c47a350c8f0ad67a3b017a06a" title="The distance between the two entries.">distance</a>) {
<a name="l00377"></a>00377                     <span class="comment">// Aggregate buffer entry to nearest entry in node.</span>
<a name="l00378"></a>00378                     nearestEntryToCarriedBuffer.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html#a1aaad422a371bd8a734d37d821fdced6" title="Aggregate the data in the Kernel of the other Entry.">aggregateEntry</a>(bufferEntry,
<a name="l00379"></a>00379                             timestamp, this.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a01f20064f2f34a61dd81d5bf568473d5" title="Parameter for the weighting function use to weight the entries.">negLambda</a>);
<a name="l00380"></a>00380                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (distanceBufferNewEntry &lt;= distanceNearestEntryToBuffer
<a name="l00381"></a>00381                         &amp;&amp; distanceBufferNewEntry &lt;= bestMergeInNode.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree_1_1BestMergeInNode.html#a2245b52c47a350c8f0ad67a3b017a06a" title="The distance between the two entries.">distance</a>) {
<a name="l00382"></a>00382                     newEntry.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html#a04a8fa3a2017bd967520242ab5f70c1e" title="Merge this entry witht the given Entry.">mergeWith</a>(bufferEntry);
<a name="l00383"></a>00383                 } <span class="keywordflow">else</span> {
<a name="l00384"></a>00384                     currentNode.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#a363585ee74aa37a8ec2f7d9a77781ba3" title="Merge the two entries at the given position.">mergeEntries</a>(bestMergeInNode.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree_1_1BestMergeInNode.html#abf9a8266227edcf5ff2e89eca98699ed" title="The position of the first entry in the array of the node.">entryPos1</a>,
<a name="l00385"></a>00385                             bestMergeInNode.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree_1_1BestMergeInNode.html#ab8ad29da72afa6d07091ade64a89b2fc" title="The position of the second entry in the array of the node.">entryPos2</a>);
<a name="l00386"></a>00386                     currentNode.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#a6afa5be4c7a2bba3be60383747b5508c" title="Add a new Entry to this node.">addEntry</a>(bufferEntry, timestamp);
<a name="l00387"></a>00387                 }
<a name="l00388"></a>00388     
<a name="l00389"></a>00389             } <span class="keywordflow">else</span> {
<a name="l00390"></a>00390                 assert (currentNode.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#a6b2452dc6b977cdaf769c3289005cddd" title="Checks if this node is a leaf.">isLeaf</a>());
<a name="l00391"></a>00391                 currentNode.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#a6afa5be4c7a2bba3be60383747b5508c" title="Add a new Entry to this node.">addEntry</a>(bufferEntry, timestamp);
<a name="l00392"></a>00392             }
<a name="l00393"></a>00393         }
<a name="l00394"></a>00394     
<a name="l00395"></a>00395         <span class="comment">// Normally the insertion of the carries buffer does not change the</span>
<a name="l00396"></a>00396         <span class="comment">// number of free entries, but in case of future changes we calculate</span>
<a name="l00397"></a>00397         <span class="comment">// the number again.</span>
<a name="l00398"></a>00398         numFreeEntries = currentNode.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#a2d0e202c1ae236d13cffd616fb152010" title="Return the number of free Entrys in this node.">numFreeEntries</a>();
<a name="l00399"></a>00399     
<a name="l00400"></a>00400         <span class="comment">// Search for an Entry with a weight under the threshold.</span>
<a name="l00401"></a>00401         <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html">Entry</a> irrelevantEntry = currentNode.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#acd83a9b5876f2067bc0305ea8fa826f8" title="If there exists an entry, whose relevance is under the threshold given as a parameter...">getIrrelevantEntry</a>(this.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a25df486eb6e958fdbc5eaf9c4a54b2c3" title="The threshold for the weighting of an Entry.">weightThreshold</a>);
<a name="l00402"></a>00402         <span class="keywordflow">if</span> (currentNode.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#a6b2452dc6b977cdaf769c3289005cddd" title="Checks if this node is a leaf.">isLeaf</a>() &amp;&amp; irrelevantEntry != null) {
<a name="l00403"></a>00403             irrelevantEntry.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html#a7731defba51740b36c4025255a5415d2" title="Overwrites the LS, SS and weightedN in the data cluster of this Entry to the values...">overwriteOldEntry</a>(newEntry);
<a name="l00404"></a>00404         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (numFreeEntries &gt;= 1) {
<a name="l00405"></a>00405             currentNode.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#a6afa5be4c7a2bba3be60383747b5508c" title="Add a new Entry to this node.">addEntry</a>(newEntry, timestamp);
<a name="l00406"></a>00406         } <span class="keywordflow">else</span> {
<a name="l00407"></a>00407             <span class="keywordflow">if</span> (currentNode.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#a6b2452dc6b977cdaf769c3289005cddd" title="Checks if this node is a leaf.">isLeaf</a>() &amp;&amp; (this.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a7ffea39d741ddbe7cacb054deef5e943">hasMaximalSize</a>()
<a name="l00408"></a>00408                     || !budget.<a class="code" href="interfacemoa_1_1clusterers_1_1clustree_1_1util_1_1Budget.html#a436c6d34127764bfa9fe9da49a7f2ed8" title="A function for the tree to ask if there is budget(time) left.">hasMoreTime</a>())) {
<a name="l00409"></a>00409                 <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a344cb4a855b69ffcc8b8e0b1381d7952" title="Inserts an Entry into a Node without inducing a split.">mergeEntryWithoutSplit</a>(currentNode, newEntry,
<a name="l00410"></a>00410                         timestamp);
<a name="l00411"></a>00411             } <span class="keywordflow">else</span> {
<a name="l00412"></a>00412                 <span class="comment">// We have to split.</span>
<a name="l00413"></a>00413                 <span class="keywordflow">return</span> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a2b13ed32dddc7452296ac0a8f458c7ca" title="Performs a (2,2) split on the given node with the given entry.">split</a>(newEntry, currentNode, parentEntry, timestamp);
<a name="l00414"></a>00414             }
<a name="l00415"></a>00415         }
<a name="l00416"></a>00416     
<a name="l00417"></a>00417         <span class="keywordflow">return</span> null;
<a name="l00418"></a>00418     }
<a name="l00419"></a>00419 
<a name="l00427"></a><a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#abb5a974d06555fddd065f5c6fae41e00">00427</a>     <span class="keyword">private</span> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html">Node</a> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#abb5a974d06555fddd065f5c6fae41e00" title="This method calculates the distances between the new point and each Entry in a leaf...">findBestLeafNode</a>(<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusKernel.html" title="Representation of an Entry in the tree.">ClusKernel</a> newPoint) {
<a name="l00428"></a>00428         <span class="keywordtype">double</span> minDist = Double.MAX_VALUE;
<a name="l00429"></a>00429         <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html">Node</a> bestFit = null;
<a name="l00430"></a>00430         <span class="keywordflow">for</span> (<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html">Node</a> e: <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a6c444cf1848c9dc5749e0cc016a445b4">collectLeafNodes</a>(<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a7e68f41dd0fecd5934d8eded9438eb6e" title="The root node of the tree.">root</a>)){
<a name="l00431"></a>00431             <span class="keywordflow">if</span> (newPoint.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusKernel.html#ab8824bf20ad60031875d95147ccb7a53" title="Calculate the distance to this other cluster.">calcDistance</a>(e.nearestEntry(newPoint).getData())&lt;minDist){
<a name="l00432"></a>00432                 bestFit = e;
<a name="l00433"></a>00433                 minDist = newPoint.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusKernel.html#ab8824bf20ad60031875d95147ccb7a53" title="Calculate the distance to this other cluster.">calcDistance</a>(e.nearestEntry(newPoint).getData());
<a name="l00434"></a>00434             }
<a name="l00435"></a>00435         }
<a name="l00436"></a>00436         <span class="keywordflow">if</span> (bestFit!=null)
<a name="l00437"></a>00437             <span class="keywordflow">return</span> bestFit;
<a name="l00438"></a>00438         <span class="keywordflow">else</span>
<a name="l00439"></a>00439             <span class="keywordflow">return</span> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a7e68f41dd0fecd5934d8eded9438eb6e" title="The root node of the tree.">root</a>;
<a name="l00440"></a>00440     }
<a name="l00441"></a>00441     
<a name="l00442"></a><a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a6c444cf1848c9dc5749e0cc016a445b4">00442</a>     <span class="keyword">private</span> ArrayList&lt;Node&gt; <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a6c444cf1848c9dc5749e0cc016a445b4">collectLeafNodes</a>(<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html">Node</a> curr){
<a name="l00443"></a>00443         ArrayList&lt;Node&gt; toReturn = <span class="keyword">new</span> ArrayList&lt;Node&gt;();
<a name="l00444"></a>00444         <span class="keywordflow">if</span> (curr==null)
<a name="l00445"></a>00445             <span class="keywordflow">return</span> toReturn;
<a name="l00446"></a>00446         <span class="keywordflow">if</span>  (curr.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#a6b2452dc6b977cdaf769c3289005cddd" title="Checks if this node is a leaf.">isLeaf</a>()){
<a name="l00447"></a>00447             toReturn.add(curr);
<a name="l00448"></a>00448             <span class="keywordflow">return</span> toReturn;
<a name="l00449"></a>00449         }
<a name="l00450"></a>00450         <span class="keywordflow">else</span>{
<a name="l00451"></a>00451             <span class="keywordflow">for</span> (<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html">Entry</a> e : curr.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#abb9b9f7152bcbc9df763bb39f92b4968" title="Return an array with references to the children of this node.">getEntries</a>())
<a name="l00452"></a>00452                 toReturn.addAll(<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a6c444cf1848c9dc5749e0cc016a445b4">collectLeafNodes</a>(e.getChild()));
<a name="l00453"></a>00453             <span class="keywordflow">return</span> toReturn;
<a name="l00454"></a>00454         }
<a name="l00455"></a>00455     }
<a name="l00456"></a>00456 
<a name="l00457"></a>00457     <span class="comment">// TODO: Expand all function that work on entries to work with the Budget.</span>
<a name="l00458"></a><a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a8945983f656f329d5a7e4f1e321e5c3b">00458</a>     <span class="keyword">private</span> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html">Entry</a> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a1fcbd4768f2142bdae4d88c80e0323e9" title="Insert a new point in the Tree.">insert</a>(<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusKernel.html" title="Representation of an Entry in the tree.">ClusKernel</a> pointToInsert, <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusKernel.html" title="Representation of an Entry in the tree.">ClusKernel</a> carriedBuffer,
<a name="l00459"></a>00459             <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html">Node</a> currentNode, <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html">Entry</a> parentEntry, <a class="code" href="interfacemoa_1_1clusterers_1_1clustree_1_1util_1_1Budget.html" title="This is an interface for classes that are to be given along with every data point...">Budget</a> budget, <span class="keywordtype">long</span> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#ab38af63448db68c547aaad6404c494f0">timestamp</a>) {
<a name="l00460"></a>00460         assert (currentNode != null);
<a name="l00461"></a>00461         assert (currentNode.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#a6b2452dc6b977cdaf769c3289005cddd" title="Checks if this node is a leaf.">isLeaf</a>()
<a name="l00462"></a>00462                 || currentNode.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#abb9b9f7152bcbc9df763bb39f92b4968" title="Return an array with references to the children of this node.">getEntries</a>()[0].<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html#a61f6036ac71f69f1b16546544b8f01ac" title="Return the reference to the child of this Entry to navigate in the tree.">getChild</a>() != null);
<a name="l00463"></a>00463 
<a name="l00464"></a>00464         currentNode.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#ab0ebdeafbb74d7d6495ecb691a865f20">makeOlder</a>(timestamp, this.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a01f20064f2f34a61dd81d5bf568473d5" title="Parameter for the weighting function use to weight the entries.">negLambda</a>);
<a name="l00465"></a>00465 
<a name="l00466"></a>00466         <span class="comment">// This variable will be changed from to null to an actual reference</span>
<a name="l00467"></a>00467         <span class="comment">// in the following if-else block if we have to insert something here,</span>
<a name="l00468"></a>00468         <span class="comment">// either because this is a leaf, or because of split propagation.</span>
<a name="l00469"></a>00469         <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html">Entry</a> toInsertHere = null;
<a name="l00470"></a>00470 
<a name="l00471"></a>00471         <span class="keywordflow">if</span> (currentNode.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#a6b2452dc6b977cdaf769c3289005cddd" title="Checks if this node is a leaf.">isLeaf</a>()) {
<a name="l00472"></a>00472             <span class="comment">// At the end of the function the entry will be inserted.</span>
<a name="l00473"></a>00473             toInsertHere = <span class="keyword">new</span> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html">Entry</a>(this.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#ae3d6b1118438f92171963de089ec119a" title="Dimensionality of the data points managed by this tree.">numberDimensions</a>,
<a name="l00474"></a>00474                     pointToInsert, timestamp, parentEntry, currentNode);
<a name="l00475"></a>00475         } <span class="keywordflow">else</span> {
<a name="l00476"></a>00476 
<a name="l00477"></a>00477             <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html">Entry</a> bestEntry = currentNode.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#a9f6542affee04b5a17698c10bf71fd04" title="Returns the neareast Entry to the given Cluster.">nearestEntry</a>(pointToInsert);
<a name="l00478"></a>00478             bestEntry.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html#a41d1e47ff09d1abe11300f330d436133" title="Aggregate the given Kernel to the data cluster of this entry.">aggregateCluster</a>(pointToInsert, timestamp,
<a name="l00479"></a>00479                     this.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a01f20064f2f34a61dd81d5bf568473d5" title="Parameter for the weighting function use to weight the entries.">negLambda</a>);
<a name="l00480"></a>00480 
<a name="l00481"></a>00481             <span class="keywordtype">boolean</span> isCarriedBufferEmpty = carriedBuffer.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusKernel.html#a9e4f5414cfacb3df03db9a7001ab4187" title="Check if this cluster is empty or not.">isEmpty</a>();
<a name="l00482"></a>00482 
<a name="l00483"></a>00483             <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html">Entry</a> bestBufferEntry = null;
<a name="l00484"></a>00484             <span class="keywordflow">if</span> (!isCarriedBufferEmpty) {
<a name="l00485"></a>00485                 bestBufferEntry = currentNode.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#a9f6542affee04b5a17698c10bf71fd04" title="Returns the neareast Entry to the given Cluster.">nearestEntry</a>(carriedBuffer);
<a name="l00486"></a>00486                 bestBufferEntry.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html#a41d1e47ff09d1abe11300f330d436133" title="Aggregate the given Kernel to the data cluster of this entry.">aggregateCluster</a>(carriedBuffer, timestamp,
<a name="l00487"></a>00487                         this.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a01f20064f2f34a61dd81d5bf568473d5" title="Parameter for the weighting function use to weight the entries.">negLambda</a>);
<a name="l00488"></a>00488             }
<a name="l00489"></a>00489 
<a name="l00490"></a>00490             <span class="keywordflow">if</span> (!budget.<a class="code" href="interfacemoa_1_1clusterers_1_1clustree_1_1util_1_1Budget.html#a436c6d34127764bfa9fe9da49a7f2ed8" title="A function for the tree to ask if there is budget(time) left.">hasMoreTime</a>()) {
<a name="l00491"></a>00491                 bestEntry.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html#ad5b82282bf99139283de65624bf9043f" title="Aggregate the given Kernel to the buffer cluster of this entry.">aggregateToBuffer</a>(pointToInsert, timestamp,
<a name="l00492"></a>00492                         this.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a01f20064f2f34a61dd81d5bf568473d5" title="Parameter for the weighting function use to weight the entries.">negLambda</a>);
<a name="l00493"></a>00493                 <span class="keywordflow">if</span> (!isCarriedBufferEmpty) {
<a name="l00494"></a>00494                     bestBufferEntry.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html#ad5b82282bf99139283de65624bf9043f" title="Aggregate the given Kernel to the buffer cluster of this entry.">aggregateToBuffer</a>(carriedBuffer,
<a name="l00495"></a>00495                             timestamp, this.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a01f20064f2f34a61dd81d5bf568473d5" title="Parameter for the weighting function use to weight the entries.">negLambda</a>);
<a name="l00496"></a>00496                 }
<a name="l00497"></a>00497                 <span class="keywordflow">return</span> null;
<a name="l00498"></a>00498             }
<a name="l00499"></a>00499 
<a name="l00500"></a>00500             <span class="comment">// If the way of the buffer differs from the way of the point to</span>
<a name="l00501"></a>00501             <span class="comment">// be inserted, leave the buffer here.</span>
<a name="l00502"></a>00502             <span class="keywordflow">if</span> (!isCarriedBufferEmpty &amp;&amp; (bestEntry != bestBufferEntry)) {
<a name="l00503"></a>00503                 bestBufferEntry.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html#ad5b82282bf99139283de65624bf9043f" title="Aggregate the given Kernel to the buffer cluster of this entry.">aggregateToBuffer</a>(carriedBuffer, timestamp,
<a name="l00504"></a>00504                         this.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a01f20064f2f34a61dd81d5bf568473d5" title="Parameter for the weighting function use to weight the entries.">negLambda</a>);
<a name="l00505"></a>00505                 carriedBuffer.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusKernel.html#a46a307a9c5aab1b2a86871561805142b" title="Remove all points from this cluster.">clear</a>();
<a name="l00506"></a>00506             }
<a name="l00507"></a>00507             <span class="comment">// Take the buffer of the best entry for the point to be inserted</span>
<a name="l00508"></a>00508             <span class="comment">// along.</span>
<a name="l00509"></a>00509             <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusKernel.html" title="Representation of an Entry in the tree.">ClusKernel</a> takeAlongBuffer = bestEntry.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html#afcd548a246a12becff8d7124bc09b843" title="Clear the buffer in this entry and return a copy.">emptyBuffer</a>(timestamp,
<a name="l00510"></a>00510                     this.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a01f20064f2f34a61dd81d5bf568473d5" title="Parameter for the weighting function use to weight the entries.">negLambda</a>);
<a name="l00511"></a>00511             carriedBuffer.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusKernel.html#af0be9102b0138f656beffa39c0036fd7" title="Adds the given cluster to this cluster, without making this cluster older.">add</a>(takeAlongBuffer);
<a name="l00512"></a>00512 
<a name="l00513"></a>00513             <span class="comment">// Recursive call.</span>
<a name="l00514"></a>00514             toInsertHere = <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a1fcbd4768f2142bdae4d88c80e0323e9" title="Insert a new point in the Tree.">insert</a>(pointToInsert, carriedBuffer,
<a name="l00515"></a>00515                     bestEntry.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html#a61f6036ac71f69f1b16546544b8f01ac" title="Return the reference to the child of this Entry to navigate in the tree.">getChild</a>(), bestEntry, budget, timestamp);
<a name="l00516"></a>00516         }
<a name="l00517"></a>00517 
<a name="l00518"></a>00518         <span class="comment">// If the above block has a new Entry for this place insert it.</span>
<a name="l00519"></a>00519         <span class="keywordflow">if</span> (toInsertHere != null) {
<a name="l00520"></a>00520             <span class="keywordflow">return</span> this.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a036b945ba16cbe4f9dc66fcf1e0fd60d">insertHere</a>(toInsertHere, currentNode, parentEntry,
<a name="l00521"></a>00521                     carriedBuffer, budget, timestamp);
<a name="l00522"></a>00522         }
<a name="l00523"></a>00523 
<a name="l00524"></a>00524         <span class="comment">// If nothing else needs to be done in all the above levels</span>
<a name="l00525"></a>00525         <span class="comment">// return null to signalize it.</span>
<a name="l00526"></a>00526         <span class="keywordflow">return</span> null;
<a name="l00527"></a>00527     }
<a name="l00528"></a>00528 
<a name="l00536"></a><a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a344cb4a855b69ffcc8b8e0b1381d7952">00536</a>     <span class="keyword">private</span> <span class="keywordtype">void</span> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a344cb4a855b69ffcc8b8e0b1381d7952" title="Inserts an Entry into a Node without inducing a split.">mergeEntryWithoutSplit</a>(<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html">Node</a> node,
<a name="l00537"></a>00537             <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html">Entry</a> newEntry, <span class="keywordtype">long</span> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#ab38af63448db68c547aaad6404c494f0">timestamp</a>) {
<a name="l00538"></a>00538 
<a name="l00539"></a>00539         <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html">Entry</a> nearestEntryToCarriedBuffer =
<a name="l00540"></a>00540                 node.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#a9f6542affee04b5a17698c10bf71fd04" title="Returns the neareast Entry to the given Cluster.">nearestEntry</a>(newEntry);
<a name="l00541"></a>00541         <span class="keywordtype">double</span> distanceNearestEntryToBuffer =
<a name="l00542"></a>00542                 nearestEntryToCarriedBuffer.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html#a9a7e452c2508fc5df286d93c9d20198d" title="Calculates the distance to the data in this entry.">calcDistance</a>(newEntry);
<a name="l00543"></a>00543 
<a name="l00544"></a>00544         <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree_1_1BestMergeInNode.html" title="A class to code the return value of searching the smallest merge in a node.">BestMergeInNode</a> bestMergeInNode =
<a name="l00545"></a>00545                 <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a7a86b051d0547c6c7e9e14dcdfc385b9" title="Calculates the best merge possible between two nodes in a node.">calculateBestMergeInNode</a>(node);
<a name="l00546"></a>00546 
<a name="l00547"></a>00547         <span class="keywordflow">if</span> (distanceNearestEntryToBuffer &lt; bestMergeInNode.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree_1_1BestMergeInNode.html#a2245b52c47a350c8f0ad67a3b017a06a" title="The distance between the two entries.">distance</a>) {
<a name="l00548"></a>00548             nearestEntryToCarriedBuffer.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html#a1aaad422a371bd8a734d37d821fdced6" title="Aggregate the data in the Kernel of the other Entry.">aggregateEntry</a>(newEntry, timestamp,
<a name="l00549"></a>00549                     this.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a01f20064f2f34a61dd81d5bf568473d5" title="Parameter for the weighting function use to weight the entries.">negLambda</a>);
<a name="l00550"></a>00550         } <span class="keywordflow">else</span> {
<a name="l00551"></a>00551             node.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#a363585ee74aa37a8ec2f7d9a77781ba3" title="Merge the two entries at the given position.">mergeEntries</a>(bestMergeInNode.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree_1_1BestMergeInNode.html#abf9a8266227edcf5ff2e89eca98699ed" title="The position of the first entry in the array of the node.">entryPos1</a>,
<a name="l00552"></a>00552                     bestMergeInNode.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree_1_1BestMergeInNode.html#ab8ad29da72afa6d07091ade64a89b2fc" title="The position of the second entry in the array of the node.">entryPos2</a>);
<a name="l00553"></a>00553             node.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#a6afa5be4c7a2bba3be60383747b5508c" title="Add a new Entry to this node.">addEntry</a>(newEntry, timestamp);
<a name="l00554"></a>00554         }
<a name="l00555"></a>00555     }
<a name="l00556"></a>00556 
<a name="l00566"></a><a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a7a86b051d0547c6c7e9e14dcdfc385b9">00566</a>     <span class="keyword">private</span> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree_1_1BestMergeInNode.html" title="A class to code the return value of searching the smallest merge in a node.">BestMergeInNode</a> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a7a86b051d0547c6c7e9e14dcdfc385b9" title="Calculates the best merge possible between two nodes in a node.">calculateBestMergeInNode</a>(<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html">Node</a> node) {
<a name="l00567"></a>00567         assert (node.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#a2d0e202c1ae236d13cffd616fb152010" title="Return the number of free Entrys in this node.">numFreeEntries</a>() == 0);
<a name="l00568"></a>00568 
<a name="l00569"></a>00569         <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html">Entry</a>[] entries = node.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#abb9b9f7152bcbc9df763bb39f92b4968" title="Return an array with references to the children of this node.">getEntries</a>();
<a name="l00570"></a>00570 
<a name="l00571"></a>00571         <span class="keywordtype">int</span> toMerge1 = -1;
<a name="l00572"></a>00572         <span class="keywordtype">int</span> toMerge2 = -1;
<a name="l00573"></a>00573         <span class="keywordtype">double</span> distanceBetweenMergeEntries = Double.NaN;
<a name="l00574"></a>00574 
<a name="l00575"></a>00575         <span class="keywordtype">double</span> minDistance = Double.MAX_VALUE;
<a name="l00576"></a>00576         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; entries.length; i++) {
<a name="l00577"></a>00577             <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html">Entry</a> e1 = entries[i];
<a name="l00578"></a>00578             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = i + 1; j &lt; entries.length; j++) {
<a name="l00579"></a>00579                 <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html">Entry</a> e2 = entries[j];
<a name="l00580"></a>00580                 <span class="keywordtype">double</span> distance = e1.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html#a9a7e452c2508fc5df286d93c9d20198d" title="Calculates the distance to the data in this entry.">calcDistance</a>(e2);
<a name="l00581"></a>00581                 <span class="keywordflow">if</span> (distance &lt; minDistance) {
<a name="l00582"></a>00582                     toMerge1 = i;
<a name="l00583"></a>00583                     toMerge2 = j;
<a name="l00584"></a>00584                     distanceBetweenMergeEntries = distance;
<a name="l00585"></a>00585                 }
<a name="l00586"></a>00586             }
<a name="l00587"></a>00587         }
<a name="l00588"></a>00588 
<a name="l00589"></a>00589         assert (toMerge1 != -1 &amp;&amp; toMerge2 != -1);
<a name="l00590"></a>00590         <span class="keywordflow">if</span> (Double.isNaN(distanceBetweenMergeEntries)) {
<a name="l00591"></a>00591             <span class="keywordflow">throw</span> <span class="keyword">new</span> RuntimeException(<span class="stringliteral">&quot;The minimal distance between two &quot;</span>
<a name="l00592"></a>00592                     + <span class="stringliteral">&quot;Entrys in a Node was Double.MAX_VAUE. That can hardly &quot;</span>
<a name="l00593"></a>00593                     + <span class="stringliteral">&quot;be right.&quot;</span>);
<a name="l00594"></a>00594         }
<a name="l00595"></a>00595 
<a name="l00596"></a>00596         <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree_1_1BestMergeInNode.html" title="A class to code the return value of searching the smallest merge in a node.">BestMergeInNode</a>(toMerge1, toMerge2,
<a name="l00597"></a>00597                 distanceBetweenMergeEntries);
<a name="l00598"></a>00598     }
<a name="l00599"></a>00599 
<a name="l00600"></a><a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a7ffea39d741ddbe7cacb054deef5e943">00600</a>     <span class="keyword">private</span> <span class="keywordtype">boolean</span> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a7ffea39d741ddbe7cacb054deef5e943">hasMaximalSize</a>() {
<a name="l00601"></a>00601         <span class="comment">// TODO: Improve hasMaximalSize(). For now it just works somehow for testing.</span>
<a name="l00602"></a>00602         <span class="keywordflow">return</span> this.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#af5304f844b2c0bf266c6b3ee686a4a22" title="The current height of the tree.">height</a> == this.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#aabde7ef28bade0a3ee8909603b591813" title="The maximal height of the tree.">maxHeight</a>;
<a name="l00603"></a>00603     }
<a name="l00604"></a>00604 
<a name="l00619"></a><a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a2b13ed32dddc7452296ac0a8f458c7ca">00619</a>     <span class="keyword">private</span> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html">Entry</a> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a2b13ed32dddc7452296ac0a8f458c7ca" title="Performs a (2,2) split on the given node with the given entry.">split</a>(<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html">Entry</a> newEntry, <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html">Node</a> node, <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html">Entry</a> parentEntry,
<a name="l00620"></a>00620             <span class="keywordtype">long</span> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#ab38af63448db68c547aaad6404c494f0">timestamp</a>) {
<a name="l00621"></a>00621         <span class="comment">// The implemented split function only works in trees where node</span>
<a name="l00622"></a>00622         <span class="comment">// have three entries.</span>
<a name="l00623"></a>00623         <span class="comment">// Splitting only makes sense on full nodes.</span>
<a name="l00624"></a>00624         assert (node.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#a2d0e202c1ae236d13cffd616fb152010" title="Return the number of free Entrys in this node.">numFreeEntries</a>() == 0);
<a name="l00625"></a>00625         assert (parentEntry.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html#a61f6036ac71f69f1b16546544b8f01ac" title="Return the reference to the child of this Entry to navigate in the tree.">getChild</a>() == node);
<a name="l00626"></a>00626 
<a name="l00627"></a>00627         <span class="comment">// All the entries we have to separate in two nodes.</span>
<a name="l00628"></a>00628         <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html">Entry</a>[] allEntries = <span class="keyword">new</span> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html">Entry</a>[4];
<a name="l00629"></a>00629         <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html">Entry</a>[] nodeEntries = node.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#abb9b9f7152bcbc9df763bb39f92b4968" title="Return an array with references to the children of this node.">getEntries</a>();
<a name="l00630"></a>00630         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nodeEntries.length; i++) {
<a name="l00631"></a>00631             allEntries[i] = <span class="keyword">new</span> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html">Entry</a>(nodeEntries[i]);
<a name="l00632"></a>00632         }
<a name="l00633"></a>00633         allEntries[3] = newEntry;
<a name="l00634"></a>00634 
<a name="l00635"></a>00635         <span class="comment">// Clear the given node, since we are going to refill it later.</span>
<a name="l00636"></a>00636         node = <span class="keyword">new</span> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html">Node</a>(this.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#ae3d6b1118438f92171963de089ec119a" title="Dimensionality of the data points managed by this tree.">numberDimensions</a>, node.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#a5e9889abea42f6dde8fd9430d37cf8be" title="Return the level number in the node.">getRawLevel</a>());
<a name="l00637"></a>00637 
<a name="l00638"></a>00638         <span class="comment">// Calculate the distance of all the possible pairings, since we want</span>
<a name="l00639"></a>00639         <span class="comment">// to do a (2,2) split.</span>
<a name="l00640"></a>00640         <span class="keywordtype">double</span> select01 = allEntries[0].calcDistance(allEntries[1])
<a name="l00641"></a>00641                 + allEntries[2].calcDistance(allEntries[3]);
<a name="l00642"></a>00642 
<a name="l00643"></a>00643         <span class="keywordtype">double</span> select02 = allEntries[0].calcDistance(allEntries[2])
<a name="l00644"></a>00644                 + allEntries[1].calcDistance(allEntries[3]);
<a name="l00645"></a>00645 
<a name="l00646"></a>00646         <span class="keywordtype">double</span> select03 = allEntries[0].calcDistance(allEntries[3])
<a name="l00647"></a>00647                 + allEntries[1].calcDistance(allEntries[2]);
<a name="l00648"></a>00648 
<a name="l00649"></a>00649         <span class="comment">// See which of the pairings is minimal and distribute the entries</span>
<a name="l00650"></a>00650         <span class="comment">// accordingly.</span>
<a name="l00651"></a>00651         <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html">Node</a> residualNode = <span class="keyword">new</span> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html">Node</a>(this.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#ae3d6b1118438f92171963de089ec119a" title="Dimensionality of the data points managed by this tree.">numberDimensions</a>,
<a name="l00652"></a>00652                 node.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#a5e9889abea42f6dde8fd9430d37cf8be" title="Return the level number in the node.">getRawLevel</a>());
<a name="l00653"></a>00653         <span class="keywordflow">if</span> (select01 &lt; select02) {
<a name="l00654"></a>00654             <span class="keywordflow">if</span> (select01 &lt; select03) {<span class="comment">//select01 smallest</span>
<a name="l00655"></a>00655                 node.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#a6afa5be4c7a2bba3be60383747b5508c" title="Add a new Entry to this node.">addEntry</a>(allEntries[0], timestamp);
<a name="l00656"></a>00656                 node.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#a6afa5be4c7a2bba3be60383747b5508c" title="Add a new Entry to this node.">addEntry</a>(allEntries[1], timestamp);
<a name="l00657"></a>00657                 residualNode.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#a6afa5be4c7a2bba3be60383747b5508c" title="Add a new Entry to this node.">addEntry</a>(allEntries[2], timestamp);
<a name="l00658"></a>00658                 residualNode.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#a6afa5be4c7a2bba3be60383747b5508c" title="Add a new Entry to this node.">addEntry</a>(allEntries[3], timestamp);
<a name="l00659"></a>00659             } <span class="keywordflow">else</span> {<span class="comment">//select03 smallest</span>
<a name="l00660"></a>00660                 node.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#a6afa5be4c7a2bba3be60383747b5508c" title="Add a new Entry to this node.">addEntry</a>(allEntries[0], timestamp);
<a name="l00661"></a>00661                 node.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#a6afa5be4c7a2bba3be60383747b5508c" title="Add a new Entry to this node.">addEntry</a>(allEntries[3], timestamp);
<a name="l00662"></a>00662                 residualNode.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#a6afa5be4c7a2bba3be60383747b5508c" title="Add a new Entry to this node.">addEntry</a>(allEntries[1], timestamp);
<a name="l00663"></a>00663                 residualNode.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#a6afa5be4c7a2bba3be60383747b5508c" title="Add a new Entry to this node.">addEntry</a>(allEntries[2], timestamp);
<a name="l00664"></a>00664             }
<a name="l00665"></a>00665         } <span class="keywordflow">else</span> {
<a name="l00666"></a>00666             <span class="keywordflow">if</span> (select02 &lt; select03) {<span class="comment">//select02 smallest</span>
<a name="l00667"></a>00667                 node.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#a6afa5be4c7a2bba3be60383747b5508c" title="Add a new Entry to this node.">addEntry</a>(allEntries[0], timestamp);
<a name="l00668"></a>00668                 node.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#a6afa5be4c7a2bba3be60383747b5508c" title="Add a new Entry to this node.">addEntry</a>(allEntries[2], timestamp);
<a name="l00669"></a>00669                 residualNode.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#a6afa5be4c7a2bba3be60383747b5508c" title="Add a new Entry to this node.">addEntry</a>(allEntries[1], timestamp);
<a name="l00670"></a>00670                 residualNode.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#a6afa5be4c7a2bba3be60383747b5508c" title="Add a new Entry to this node.">addEntry</a>(allEntries[3], timestamp);
<a name="l00671"></a>00671             } <span class="keywordflow">else</span> {<span class="comment">//select03 smallest</span>
<a name="l00672"></a>00672                 node.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#a6afa5be4c7a2bba3be60383747b5508c" title="Add a new Entry to this node.">addEntry</a>(allEntries[0], timestamp);
<a name="l00673"></a>00673                 node.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#a6afa5be4c7a2bba3be60383747b5508c" title="Add a new Entry to this node.">addEntry</a>(allEntries[3], timestamp);
<a name="l00674"></a>00674                 residualNode.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#a6afa5be4c7a2bba3be60383747b5508c" title="Add a new Entry to this node.">addEntry</a>(allEntries[1], timestamp);
<a name="l00675"></a>00675                 residualNode.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#a6afa5be4c7a2bba3be60383747b5508c" title="Add a new Entry to this node.">addEntry</a>(allEntries[2], timestamp);
<a name="l00676"></a>00676             }
<a name="l00677"></a>00677         }
<a name="l00678"></a>00678 
<a name="l00679"></a>00679         <span class="comment">// Set the other node into the tree.</span>
<a name="l00680"></a>00680         parentEntry.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html#adbcdb4fa43878fb812bfb4c7c2dc9b62" title="Setter for the child in this entry.">setChild</a>(node);
<a name="l00681"></a>00681         parentEntry.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html#a84c2f6bfd2944bfe4bbdbceb95398797" title="This functions reads every entry in the child node and calculates the corresponding...">recalculateData</a>();
<a name="l00682"></a>00682         <span class="keywordtype">int</span> count = 0;
<a name="l00683"></a>00683         <span class="keywordflow">for</span> (<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html">Entry</a> e : node.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#abb9b9f7152bcbc9df763bb39f92b4968" title="Return an array with references to the children of this node.">getEntries</a>()){
<a name="l00684"></a>00684             e.setParentEntry(parentEntry);
<a name="l00685"></a>00685             <span class="keywordflow">if</span> (e.getData().getN() != 0)
<a name="l00686"></a>00686                 count++;
<a name="l00687"></a>00687         }
<a name="l00688"></a>00688         <span class="comment">//System.out.println(count);</span>
<a name="l00689"></a>00689         <span class="comment">// Generate a new entry for the residual node.</span>
<a name="l00690"></a>00690         <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html">Entry</a> residualEntry = <span class="keyword">new</span> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html">Entry</a>(this.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#ae3d6b1118438f92171963de089ec119a" title="Dimensionality of the data points managed by this tree.">numberDimensions</a>,
<a name="l00691"></a>00691                 residualNode, timestamp, parentEntry, node);
<a name="l00692"></a>00692         count=0;
<a name="l00693"></a>00693         <span class="keywordflow">for</span> (<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html">Entry</a> e: residualNode.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#abb9b9f7152bcbc9df763bb39f92b4968" title="Return an array with references to the children of this node.">getEntries</a>()){
<a name="l00694"></a>00694             e.setParentEntry(residualEntry);
<a name="l00695"></a>00695             <span class="keywordflow">if</span> (e.getData().getN() != 0)
<a name="l00696"></a>00696                 count++;
<a name="l00697"></a>00697         }
<a name="l00698"></a>00698         <span class="comment">//System.out.println(count);</span>
<a name="l00699"></a>00699         <span class="keywordflow">return</span> residualEntry;
<a name="l00700"></a>00700     }
<a name="l00701"></a>00701 
<a name="l00707"></a><a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#af0ed3de0c583140317504bc713db7dd8">00707</a>     <span class="keyword">public</span> <span class="keywordtype">int</span> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#af0ed3de0c583140317504bc713db7dd8" title="Return the number of time the tree has grown in size.">getNumRootSplits</a>() {
<a name="l00708"></a>00708         <span class="keywordflow">return</span> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#af4bb41722a229335793648b58f4fb3ea" title="This variable is used to keep the inverse height that is stored in every node correct...">numRootSplits</a>;
<a name="l00709"></a>00709     }
<a name="l00710"></a>00710 
<a name="l00717"></a><a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a2260876c3080c7b122409ad5cf88af7f">00717</a>     <span class="keyword">public</span> <span class="keywordtype">int</span> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a2260876c3080c7b122409ad5cf88af7f" title="Return the current height of the tree.">getHeight</a>() {
<a name="l00718"></a>00718         assert (<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#af5304f844b2c0bf266c6b3ee686a4a22" title="The current height of the tree.">height</a> &lt;= <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#aabde7ef28bade0a3ee8909603b591813" title="The maximal height of the tree.">maxHeight</a>);
<a name="l00719"></a>00719         <span class="keywordflow">return</span> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#af5304f844b2c0bf266c6b3ee686a4a22" title="The current height of the tree.">height</a>;
<a name="l00720"></a>00720     }
<a name="l00721"></a>00721 
<a name="l00722"></a><a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a2f72c2f7faf51a9bd5a2b5a4c8c81db5">00722</a>     <span class="keyword">private</span> <span class="keywordtype">void</span> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a2f72c2f7faf51a9bd5a2b5a4c8c81db5">cleanUp</a>(<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html">Node</a> currentNode, <span class="keywordtype">int</span> level) {
<a name="l00723"></a>00723         <span class="keywordflow">if</span> (currentNode == null) {
<a name="l00724"></a>00724             <span class="keywordflow">return</span>;
<a name="l00725"></a>00725         }
<a name="l00726"></a>00726 
<a name="l00727"></a>00727         <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html">Entry</a>[] entries = currentNode.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#abb9b9f7152bcbc9df763bb39f92b4968" title="Return an array with references to the children of this node.">getEntries</a>();
<a name="l00728"></a>00728         <span class="keywordflow">if</span> (level == this.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#aabde7ef28bade0a3ee8909603b591813" title="The maximal height of the tree.">maxHeight</a>) {
<a name="l00729"></a>00729             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; entries.length; i++) {
<a name="l00730"></a>00730                 <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html">Entry</a> e = entries[i];
<a name="l00731"></a>00731                 e.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html#adbcdb4fa43878fb812bfb4c7c2dc9b62" title="Setter for the child in this entry.">setChild</a>(null);
<a name="l00732"></a>00732             }
<a name="l00733"></a>00733         } <span class="keywordflow">else</span> {
<a name="l00734"></a>00734             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; entries.length; i++) {
<a name="l00735"></a>00735                 <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html">Entry</a> e = entries[i];
<a name="l00736"></a>00736                 <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a2f72c2f7faf51a9bd5a2b5a4c8c81db5">cleanUp</a>(e.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html#a61f6036ac71f69f1b16546544b8f01ac" title="Return the reference to the child of this Entry to navigate in the tree.">getChild</a>(), level + 1);
<a name="l00737"></a>00737             }
<a name="l00738"></a>00738         }
<a name="l00739"></a>00739     }
<a name="l00740"></a>00740 
<a name="l00745"></a>00745     <span class="comment">//TODO: Microcluster unter dem Threshhold nich zurckgeben (WIe bei outdated entries)</span>
<a name="l00746"></a>00746     @Override
<a name="l00747"></a><a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a42dc872fb34f7714e3c083a266131ee8">00747</a>     <span class="keyword">public</span> <a class="code" href="classmoa_1_1cluster_1_1Clustering.html">Clustering</a> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a42dc872fb34f7714e3c083a266131ee8">getMicroClusteringResult</a>() {
<a name="l00748"></a>00748         <span class="keywordflow">return</span> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a6c824e0f1fcf7f5c40b1ce34c4ee0130">getClustering</a>(<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#ab38af63448db68c547aaad6404c494f0">timestamp</a>, -1);
<a name="l00749"></a>00749     }
<a name="l00750"></a>00750 
<a name="l00751"></a>00751     @Override
<a name="l00752"></a><a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#acb0aa9c7ccf598059ee0c4164c9b1141">00752</a>     <span class="keyword">public</span> <a class="code" href="classmoa_1_1cluster_1_1Clustering.html">Clustering</a> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#acb0aa9c7ccf598059ee0c4164c9b1141">getClusteringResult</a>() {
<a name="l00753"></a>00753         <span class="keywordflow">return</span> null;
<a name="l00754"></a>00754     }
<a name="l00755"></a>00755 
<a name="l00756"></a>00756 
<a name="l00761"></a><a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a6c824e0f1fcf7f5c40b1ce34c4ee0130">00761</a>     <span class="keyword">public</span> <a class="code" href="classmoa_1_1cluster_1_1Clustering.html">Clustering</a> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a6c824e0f1fcf7f5c40b1ce34c4ee0130">getClustering</a>(<span class="keywordtype">long</span> currentTime, <span class="keywordtype">int</span> targetLevel) {
<a name="l00762"></a>00762         <span class="keywordflow">if</span> (<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a7e68f41dd0fecd5934d8eded9438eb6e" title="The root node of the tree.">root</a> == null) {
<a name="l00763"></a>00763             <span class="keywordflow">return</span> null;
<a name="l00764"></a>00764         }
<a name="l00765"></a>00765 
<a name="l00766"></a>00766         <a class="code" href="classmoa_1_1cluster_1_1Clustering.html">Clustering</a> clusters = <span class="keyword">new</span> <a class="code" href="classmoa_1_1cluster_1_1Clustering.html">Clustering</a>();
<a name="l00767"></a>00767         LinkedList&lt;Node&gt; queue = <span class="keyword">new</span> LinkedList&lt;Node&gt;();
<a name="l00768"></a>00768         queue.add(<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a7e68f41dd0fecd5934d8eded9438eb6e" title="The root node of the tree.">root</a>);
<a name="l00769"></a>00769 
<a name="l00770"></a>00770         <span class="keywordflow">while</span> (!queue.isEmpty()) {
<a name="l00771"></a>00771             <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html">Node</a> current = queue.remove();
<a name="l00772"></a>00772            <span class="comment">// if (current == null)</span>
<a name="l00773"></a>00773            <span class="comment">//   continue;</span>
<a name="l00774"></a>00774             <span class="keywordtype">int</span> currentLevel = current.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#ab36efaff1046d04ed76051ac74339697" title="Returns the level at which this node is in the tree.">getLevel</a>(<span class="keyword">this</span>);
<a name="l00775"></a>00775             <span class="keywordtype">boolean</span> isLeaf = (current.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#a6b2452dc6b977cdaf769c3289005cddd" title="Checks if this node is a leaf.">isLeaf</a>() &amp;&amp; currentLevel &lt;= <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#aabde7ef28bade0a3ee8909603b591813" title="The maximal height of the tree.">maxHeight</a>)
<a name="l00776"></a>00776                     || currentLevel == <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#aabde7ef28bade0a3ee8909603b591813" title="The maximal height of the tree.">maxHeight</a>;
<a name="l00777"></a>00777 
<a name="l00778"></a>00778             <span class="keywordflow">if</span> (currentLevel == targetLevel
<a name="l00779"></a>00779                     || (targetLevel == - 1 &amp;&amp; isLeaf)) {
<a name="l00780"></a>00780                 assert (currentLevel &lt;= <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#aabde7ef28bade0a3ee8909603b591813" title="The maximal height of the tree.">maxHeight</a>);
<a name="l00781"></a>00781 
<a name="l00782"></a>00782                 <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html">Entry</a>[] entries = current.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#abb9b9f7152bcbc9df763bb39f92b4968" title="Return an array with references to the children of this node.">getEntries</a>();
<a name="l00783"></a>00783                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; entries.length; i++) {
<a name="l00784"></a>00784                     <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html">Entry</a> entry = entries[i];
<a name="l00785"></a>00785                     <span class="keywordflow">if</span> (entry == null || entry.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html#ad9a372cb27cd0456f5c9e5a5da020b17" title="Check if this Entry is empty or not.">isEmpty</a>()) {
<a name="l00786"></a>00786                         <span class="keywordflow">continue</span>;
<a name="l00787"></a>00787                     }
<a name="l00788"></a>00788                     <span class="comment">// XXX</span>
<a name="l00789"></a>00789                     entry.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html#a5b30006fa5bda7874b56956af357d602" title="Ages this entrie&amp;#39;s data AND buffer according to the given time and aging constant...">makeOlder</a>(currentTime, this.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a01f20064f2f34a61dd81d5bf568473d5" title="Parameter for the weighting function use to weight the entries.">negLambda</a>);
<a name="l00790"></a>00790                     <span class="keywordflow">if</span> (entry.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html#a12c84a14579b32a936879c70bcfe45c6" title="Returns true if this entry is irrelevant with respecto the given threshold.">isIrrelevant</a>(<span class="keyword">this</span>.weightThreshold))
<a name="l00791"></a>00791                         <span class="keywordflow">continue</span>;
<a name="l00792"></a>00792 
<a name="l00793"></a>00793                     <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusKernel.html" title="Representation of an Entry in the tree.">ClusKernel</a> gaussKernel = <span class="keyword">new</span> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusKernel.html" title="Representation of an Entry in the tree.">ClusKernel</a>(entry.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html#a1e49da60f9e130eba1b1500febcf3424" title="Getter for the data.">getData</a>());
<a name="l00794"></a>00794 
<a name="l00795"></a>00795 <span class="comment">//                  long diff = currentTime - entry.getTimestamp();</span>
<a name="l00796"></a>00796 <span class="comment">//                    if (diff &gt; 0) {</span>
<a name="l00797"></a>00797 <span class="comment">//                        gaussKernel.makeOlder(diff, negLambda);</span>
<a name="l00798"></a>00798 <span class="comment">//                    }</span>
<a name="l00799"></a>00799 
<a name="l00800"></a>00800                     clusters.<a class="code" href="classmoa_1_1cluster_1_1Clustering.html#a7b39cc3d6666cb758b8954ecbe0ce2e9" title="add a cluster to the clustering">add</a>(gaussKernel);
<a name="l00801"></a>00801                 }
<a name="l00802"></a>00802             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!current.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#a6b2452dc6b977cdaf769c3289005cddd" title="Checks if this node is a leaf.">isLeaf</a>()) {
<a name="l00803"></a>00803                 <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html">Entry</a>[] entries = current.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Node.html#abb9b9f7152bcbc9df763bb39f92b4968" title="Return an array with references to the children of this node.">getEntries</a>();
<a name="l00804"></a>00804                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; entries.length; i++) {
<a name="l00805"></a>00805                     <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html">Entry</a> entry = entries[i];
<a name="l00806"></a>00806 
<a name="l00807"></a>00807                     <span class="keywordflow">if</span> (entry.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html#ad9a372cb27cd0456f5c9e5a5da020b17" title="Check if this Entry is empty or not.">isEmpty</a>()) {
<a name="l00808"></a>00808                         <span class="keywordflow">continue</span>;
<a name="l00809"></a>00809                     }
<a name="l00810"></a>00810 
<a name="l00811"></a>00811                     <span class="keywordflow">if</span> (entry.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html#a12c84a14579b32a936879c70bcfe45c6" title="Returns true if this entry is irrelevant with respecto the given threshold.">isIrrelevant</a>(<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree.html#a25df486eb6e958fdbc5eaf9c4a54b2c3" title="The threshold for the weighting of an Entry.">weightThreshold</a>)) {
<a name="l00812"></a>00812                         <span class="keywordflow">continue</span>;
<a name="l00813"></a>00813                     }
<a name="l00814"></a>00814 
<a name="l00815"></a>00815                     queue.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html#a100d9d6f99b615cefd1334a820b18a0d" title="Add the data cluster of another entry to the data cluster of this entry.">add</a>(entry.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1Entry.html#a61f6036ac71f69f1b16546544b8f01ac" title="Return the reference to the child of this Entry to navigate in the tree.">getChild</a>());
<a name="l00816"></a>00816                 }
<a name="l00817"></a>00817             }
<a name="l00818"></a>00818         }
<a name="l00819"></a>00819 
<a name="l00820"></a>00820         <span class="keywordflow">return</span> clusters;
<a name="l00821"></a>00821     }
<a name="l00822"></a>00822 
<a name="l00823"></a>00823 
<a name="l00824"></a>00824 
<a name="l00825"></a>00825     <span class="comment">/**************************************************************************</span>
<a name="l00826"></a>00826 <span class="comment">     * LOCAL CLASSES</span>
<a name="l00827"></a>00827 <span class="comment">     **************************************************************************/</span>
<a name="l00832"></a><a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree_1_1BestMergeInNode.html">00832</a>     <span class="keyword">class </span><a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree_1_1BestMergeInNode.html" title="A class to code the return value of searching the smallest merge in a node.">BestMergeInNode</a> {
<a name="l00833"></a>00833 
<a name="l00837"></a><a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree_1_1BestMergeInNode.html#abf9a8266227edcf5ff2e89eca98699ed">00837</a>         <span class="keyword">public</span> <span class="keywordtype">int</span> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree_1_1BestMergeInNode.html#abf9a8266227edcf5ff2e89eca98699ed" title="The position of the first entry in the array of the node.">entryPos1</a>;
<a name="l00841"></a><a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree_1_1BestMergeInNode.html#ab8ad29da72afa6d07091ade64a89b2fc">00841</a>         <span class="keyword">public</span> <span class="keywordtype">int</span> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree_1_1BestMergeInNode.html#ab8ad29da72afa6d07091ade64a89b2fc" title="The position of the second entry in the array of the node.">entryPos2</a>;
<a name="l00845"></a><a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree_1_1BestMergeInNode.html#a2245b52c47a350c8f0ad67a3b017a06a">00845</a>         <span class="keyword">public</span> <span class="keywordtype">double</span> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree_1_1BestMergeInNode.html#a2245b52c47a350c8f0ad67a3b017a06a" title="The distance between the two entries.">distance</a>;
<a name="l00846"></a>00846 
<a name="l00854"></a><a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree_1_1BestMergeInNode.html#ac14c8bf4f42eb982ef062fe86a8556e5">00854</a>         <span class="keyword">public</span> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree_1_1BestMergeInNode.html#ac14c8bf4f42eb982ef062fe86a8556e5" title="The constructor of this return value.">BestMergeInNode</a>(<span class="keywordtype">int</span> pos1, <span class="keywordtype">int</span> pos2,
<a name="l00855"></a>00855                 <span class="keywordtype">double</span> <a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree_1_1BestMergeInNode.html#a2245b52c47a350c8f0ad67a3b017a06a" title="The distance between the two entries.">distance</a>) {
<a name="l00856"></a>00856             assert (pos1 != pos2);
<a name="l00857"></a>00857 
<a name="l00858"></a>00858             this.distance = distance;
<a name="l00859"></a>00859 
<a name="l00860"></a>00860             <span class="keywordflow">if</span> (pos1 &lt; pos2) {
<a name="l00861"></a>00861                 this.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree_1_1BestMergeInNode.html#abf9a8266227edcf5ff2e89eca98699ed" title="The position of the first entry in the array of the node.">entryPos1</a> = pos1;
<a name="l00862"></a>00862                 this.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree_1_1BestMergeInNode.html#ab8ad29da72afa6d07091ade64a89b2fc" title="The position of the second entry in the array of the node.">entryPos2</a> = pos2;
<a name="l00863"></a>00863             } <span class="keywordflow">else</span> {
<a name="l00864"></a>00864                 this.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree_1_1BestMergeInNode.html#abf9a8266227edcf5ff2e89eca98699ed" title="The position of the first entry in the array of the node.">entryPos1</a> = pos2;
<a name="l00865"></a>00865                 this.<a class="code" href="classmoa_1_1clusterers_1_1clustree_1_1ClusTree_1_1BestMergeInNode.html#ab8ad29da72afa6d07091ade64a89b2fc" title="The position of the second entry in the array of the node.">entryPos2</a> = pos1;
<a name="l00866"></a>00866             }
<a name="l00867"></a>00867         }
<a name="l00868"></a>00868     }
<a name="l00869"></a>00869 
<a name="l00870"></a>00870 }
</pre></div></div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Enumerations</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr size="1"/><address style="text-align: right;"><small>Generated on 26 Nov 2014 for MOA by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
